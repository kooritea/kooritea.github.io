{"id":2581,"content":"使用xposed修复fcm在国内网络环境下重连服务器失效的问题\n一个很明显的症状就是\\*\\#\\*\\#426\\#\\*\\#\\*里面`ReconnectManager: next reconnect attempt in `显示一个负数\n\n首先找到ReconnectManager类，虽然被混淆了，但是根据426界面的字符串顺藤摸瓜可以找到`com.google.android.gms`包根目录的abbo类就是ReconnectManager\n其中可以推断出`public final void a(long j)`是设定下次重连时间的方法，传入的长整形参数是多少毫秒后进行重连，并把重连的时间(elapseRealtime)赋值到g属性，当连接成功时g会被置0。\n\n那么xposed的逻辑就是\nhook这个a方法\n在afterHookedMethod中，延迟j+5000毫秒执行，判断属性g是否不等于0且小于SystemClock.elapseRealtime()，小于则证明已经变成负数出问题了，这时候就发送`com.google.android.intent.action.GCM_RECONNECT`广播让他重连。\n\n完整的代码在这里 [https://github.com/kooritea/fcmfix/blob/master/app/src/main/java/com/kooritea/fcmfix/xposed/ReconnectManagerFix.java](https://github.com/kooritea/fcmfix/blob/master/app/src/main/java/com/kooritea/fcmfix/xposed/ReconnectManagerFix.java)","hide":"","time":"2020-09-10T16:45:31.000Z"}