{"id":1782,"content":"用nest的异常过滤器有个问题，一旦异常被过滤器捕获请求生命周期就结束要返回给客户端了，可我需要根据路由在响应前格式化响应内容。\n例如参数验证异常，我需要做到公众号返回xml，普通请求包装成带业务码的固定格式。这样总不能在每个过滤器里面做吧。\n\n然后就把过滤器换成了拦截器，因为拦截器是本质上是可观察对象的管道方法，可以做到捕获异常之后转换为通用错误消息，再交给下一个拦截器处理为对应的格式化响应，最终订阅的nest返回响应。\n然后问题又出来了，nest的响应拦截器顺序是控制器上的再到全局，导致挂在全局的异常拦截器在把异常转换为通用错误消息之前，挂在控制器上的格式转换拦截器已经处理完了。\n现在不知道要怎么把这个控制器上的拦截器执行顺序摆到最后。\n最烂的方法就是把所有全局的拦截器都放在控制器上声明，这样就能控制顺序了。\n\n\n以前不喜欢用可观察对象，现在不得不用。\nu1s1,还挺好用的","hide":"","time":"2020-03-03T18:03:17.000Z"}