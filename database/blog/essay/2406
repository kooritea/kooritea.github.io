{"id":2406,"content":"想写一个能让nest启动后马上执行方法的装饰器，但是又不知道怎么写\n参考了一下nestjs/schedule，发现他也只是遍历所有Provider，检查是否有设置metadata\n\n```typescript\nexport class AppModule implements OnApplicationBootstrap {\n\nconstructor(\n    private readonly discoveryService: DiscoveryService,\n    private readonly metadataScanner: MetadataScanner,\n    private readonly reflector: Reflector\n  ) { }\n\n  onApplicationBootstrap(){\n    const providers: InstanceWrapper[] = this.discoveryService.getProviders();\n    providers.forEach((wrapper: InstanceWrapper) => {\n      const { instance } = wrapper;\n      if (!instance || !Object.getPrototypeOf(instance)) {\n        return;\n      }\n      this.metadataScanner.scanFromPrototype(\n        instance,\n        Object.getPrototypeOf(instance),\n        (key: string) => {\n             const metaData = this.reflector.get(MetaKey, instance[key]);\n             if(metaData){\n               // do something\n             }\n        },\n      );\n    });\n  }\n}\n\n\n```","hide":"","time":"2020-07-27T12:17:16.000Z"}