{"id":612,"content":"```bash\nFri Feb 15 02:53:04 2019 daemon.info pppd[26244]: LCP terminated by peer\nFri Feb 15 02:53:04 2019 daemon.info pppd[26244]: Connect time 2875.0 minutes.\nFri Feb 15 02:53:04 2019 daemon.info pppd[26244]: Sent 778442446 bytes, received 3370130839 bytes.\nFri Feb 15 02:53:05 2019 daemon.notice netifd: Network device 'pppoe-wan' link is down\nFri Feb 15 02:53:05 2019 daemon.notice netifd: Network alias 'pppoe-wan' link is down\nFri Feb 15 02:53:05 2019 daemon.notice netifd: Interface 'wan_6' has link connectivity loss\nFri Feb 15 02:53:05 2019 daemon.notice pppd[26244]: Modem hangup\nFri Feb 15 02:53:05 2019 daemon.notice pppd[26244]: Connection terminated.\n\n```\n这里的电信pppoe连满48小时就会自动断掉\n\npppoe路由器自动重连这倒没什么问题\n问题是chinadns不知道为什么重拨pppoe之后会挂掉，害我整天都半夜突然没网，需要手动restart\n\n因为没有重连pppoe的钩子，这里又到了万能的计划任务了\n\n*/1 * * * *\n\n1分钟检查一次dns\n\n```bash\n#!/bin/sh\nexport PATH=/usr/bin:/usr/sbin:/bin:/sbin:/mnt/sda5/usr/bin:/mnt/sda5/usr/sbin:/mnt/sda5/usr/lib\nexport LD_LIBRARY_PATH=/lib:/usr/lib:/mnt/sda5/usr/lib:/mnt/sda5/lib\ntimeout 10s ping -c 2 -w 2 www.baidu.com\nif [ $? != 0 ];\nthen\n    /etc/init.d/chinadns restart\nfi\n```\n\n这里的内容就是10秒内ping百度两个包没成功就重启chinadns\n\n这两个export是以前碰到的坑\ncron或者service的执行环境是不过/etc/profile的，所以额外的PATH不手动附上的话安装在sda的timeout就会\n```bash\n-ash: timeout: not found\n```\n","hide":"","time":"2019-02-14T19:53:00.000Z"}