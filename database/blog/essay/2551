{"id":2551,"content":"![a9397ba6cbc99d777a1b4e14ce8cd46b](/2020/09/04/a9397ba6cbc99d777a1b4e14ce8cd46b.png)\ntg有两个选项\n如果打开第一个选项(miui需要给自启动)，即使在任务管理器划掉，tg也会在后台启动一个无活动的服务，等待fcm\n如果打开第二个选项，tg就会在后台自己建立长连接接收消息，而不是等待fcm\n\n本来fcm有ack机制，通知也是可靠的。fcm本身是必达的，但是能不能发出通知就得看应用还在不在后台了，而因为安卓系统的特性，特别是国内的魔改rom，除了系统级应用几乎不可能保证100%存活，况且还耗内存。\n\n所以apns和mipush这种集中发送通知才是最完美的推送方案一条长连接一个后台服务就可以推送所有通知，而fcm是一个长连接多个后台服务。\n\n使用我写的fcmfix(实现方法来自绿色守护)可以让非系统级应用也能100%接收fcm发出通知，并且省下每个应用都要常驻后台占用的内存。\n其原理就是通过xposed让fcm广播可以唤醒没有后台的目标应用，让其发出通知，然后再杀掉。这样既不会让应用在后台占用内存，也不会因为应用没有后台而丢失通知。\n绿色守护的最大的缺点就是无法选择fcm可以唤醒哪些应用，导致一打开这个功能，就无法阻止chrome、知乎、opera这些通过fcm倒垃圾唤醒应用，白白浪费电。\n所以fcmfix改进了这个毛病\n![1f554a1f8d4c3704fdb6fd46c211b55f](/2020/09/04/1f554a1f8d4c3704fdb6fd46c211b55f.jpg)\n只有选中的应用才能被fcm唤醒，其他的该干嘛干嘛\n\n现在是一次列出了所有应用，但是刚才发现了一个叫LibChecker的应用，不需要任何权限就能分析出已安装的app是否接入了fcm，明天看一看他怎么做到的，就可以精简这个列表了","hide":"","time":"2020-09-03T19:05:46.000Z"}