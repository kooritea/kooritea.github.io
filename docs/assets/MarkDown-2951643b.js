import{aA as w,o as p,e as g,_ as S,$ as T,r as u,l as M,f as d,a0 as f,V as C,aC as A,S as L,T as D,U as E,W as x,X as V,aV as k,aW as R,x as F,aq as m}from"./vendor-c5239138.js";import{I as B}from"./ImageCon-6d400405.js";import{_ as y,S as O,i as P,w as W,n as H,L as U,o as N}from"./index-5aeaea64.js";import"./highlightjs-b0208cd2.js";const q={components:{ImageCon:B},props:{src:{type:String,default:()=>""},alt:{type:String,default:()=>""},srcPreFix:{type:[Array,String],default:()=>["https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://fastly.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://raw.githubusercontent.com/kooritea/kooritea.github.io/img"]}}},z={class:"md-image"};function Y(s,n,t,e,r,c){const o=w("ImageCon");return p(),g("div",z,[S(o,{ref:"ImageCon",src:t.src,prefix:t.srcPreFix,alt:t.alt||t.src,onClick:n[0]||(n[0]=i=>s.$imagePreview(s.$refs.ImageCon.applySrc)),onDragstart:n[1]||(n[1]=T(()=>{},["prevent"]))},null,8,["src","prefix","alt"])])}const X=y(q,[["render",Y],["__scopeId","data-v-33168729"]]);const Z={components:{SvgIcon:O},props:{content:{type:String,required:!0},lang:{type:String,default:""}},setup(s){const n=u(!1);let t=null;return P(()=>import("./highlightjs-b0208cd2.js").then(e=>e.i),["https://kooritea.moe/assets/highlightjs-b0208cd2.js","https://kooritea.moe/assets/highlightjs-5f5db245.css"],import.meta.url).then(e=>{n.value=!0,t=e.default}),{highlightCode:M(()=>{if(n.value&&t.getLanguage(s.lang.toLowerCase()))return t.highlight(s.content,{language:s.lang.toLowerCase()}).value;{const e=document.createElement("div");return e.innerHTML=s.content,e.innerText}}),lineCount:M(()=>s.content.split(`
`).length-1)}},methods:{writeTextToClipboard(){W(this.content),this.$msgBox.success("复制成功")}}},G={class:"code-block"},J={class:"code-meta"},K={class:"lang"},Q={class:"code"},ee={class:"line-numbers"},te=["innerHTML"];function ne(s,n,t,e,r,c){const o=w("SvgIcon");return p(),g("div",G,[d("div",J,[d("span",K,f(`${t.lang.slice(0,1).toUpperCase()}${t.lang.slice(1)}`),1),d("span",{class:"copy",onClick:n[0]||(n[0]=(...i)=>c.writeTextToClipboard&&c.writeTextToClipboard(...i))},[S(o,{name:"icon-copy"})])]),d("div",Q,[d("div",ee,[(p(!0),g(C,null,A(new Array(e.lineCount).fill(""),(i,_)=>(p(),g("div",{key:_,class:"number"},f(_+1),1))),128))]),d("pre",{innerHTML:e.highlightCode},null,8,te)])])}const oe=y(Z,[["render",ne],["__scopeId","data-v-8f787fc5"]]);const se=String.fromCharCode(8205),re=/\uFE0F/g,ie=(s,n="-")=>{const t=[];let e=0,r=0,c=0;for(;c<s.length;)e=s.charCodeAt(c++),r?(t.push((65536+(r-55296<<10)+(e-56320)).toString(16)),r=0):e>=55296&&e<=56319?r=e:t.push(e.toString(16));return t.join(n)};function ce(s){return ie(s.indexOf(se)<0?s.replace(re,""):s)}const ae={components:{ImageCon:B},props:{emoji:{type:String,default:""}},setup(s){const n=u(!1),e=`/${ce(s.emoji)}.png`;return{showEmojiImg:n,imgSrc:e}}},le={key:0};function de(s,n,t,e,r,c){const o=w("ImageCon");return p(),g(C,null,[L(S(o,{class:"emoji",src:e.imgSrc,prefix:["https://cdn.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://fastly.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://raw.githubusercontent.com/twitter/twemoji/assets/72x72"],alt:t.emoji,onLoad:n[0]||(n[0]=i=>e.showEmojiImg=!0)},null,8,["src","prefix","alt"]),[[D,e.showEmojiImg]]),e.showEmojiImg?E("",!0):(p(),g("span",le,f(t.emoji),1))],64)}const ue=y(ae,[["render",de],["__scopeId","data-v-2dd6e819"]]);const _e={props:{content:{type:String,default:""}},setup(s){const n=s.content.match(/\[bilibili ((av|bv|AV|BV)[a-zA-Z0-9]+)?( p.*?)?\]/),t=n[1],e=((n?n[3]:"")||"").slice(2),r=u(`https://player.bilibili.com/player.html?bvid=${t}${e?"?page="+e:""}`),c=u(`https://www.bilibili.com/video/${t}${e?"?p="+e:""}`),o=u(!0);return{playerSrc:r,webSiteSrc:c,loading:o,id:u(t)}}},pe=["href"],ge=["src"];function me(s,n,t,e,r,c){return p(),g("div",null,[d("p",null,[d("a",{class:"link",href:e.webSiteSrc,target:"_blank"},f(e.id),9,pe)]),d("iframe",{src:e.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:x(["bilibili-player",{loading:e.loading}]),onLoad:n[0]||(n[0]=o=>e.loading=!1)},null,42,ge)])}const he=y(_e,[["render",me],["__scopeId","data-v-c2f21cd0"]]);const fe={props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[youtube (.*?)\]/)[1],e=u(`https://www.youtube.com/embed/${t}`),r=u(`https://www.youtube.com/watch?v=${t}`),c=u(!0);return{playerSrc:e,webSiteSrc:r,loading:c,id:u(t)}}},ye=["href"],ve=["src"];function be(s,n,t,e,r,c){return p(),g("div",null,[d("p",null,[d("a",{class:"link",href:e.webSiteSrc,target:"_blank"},f(e.id),9,ye)]),d("iframe",{src:e.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:x(["youtube-player",{loading:e.loading}]),onLoad:n[0]||(n[0]=o=>e.loading=!1)},null,42,ve)])}const ke=y(fe,[["render",be],["__scopeId","data-v-40b9d9a4"]]);function we(s){return H({url:`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/music/${s}.mp3`,responseType:"arraybuffer"}).then(n=>{const[t,e]=s.split("-");return P(()=>import("./vendor-c5239138.js").then(r=>r.i),["https://kooritea.moe/assets/vendor-c5239138.js","https://kooritea.moe/assets/highlightjs-b0208cd2.js","https://kooritea.moe/assets/highlightjs-5f5db245.css"],import.meta.url).then(r=>{const c=r.default,i=new c(n).ID3V2.findLabel("APIC");return{picUrl:i?URL.createObjectURL(new Blob([i.content.pictureBuffer])):"",name:t,singer:e,id:s,getPlayUrl:async()=>URL.createObjectURL(new Blob([n],{type:"audio/mp3"}))}})})}const $e={components:{LoadingIcon:U},props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[music (.*?)\]/)[1],e=u({}),r=u(!0),c=u("");return(t.startsWith("private")?we(t.slice(8)):N(t)).then(o=>{e.value=o}).catch(o=>{c.value=o.message}).finally(()=>{r.value=!1}),{loading:r,error:c,id:u(t),music:e}},methods:{onClick(){this.loading||this.error||this.music.getPlayUrl().then(s=>{window.open(s,"_blank")})}}},Se={key:1,class:"error-msg"},Ce=["src"],xe={class:"info"},Ie={class:"song-name"},je={class:"singer-name"};function Me(s,n,t,e,r,c){const o=w("LoadingIcon");return p(),g("div",{class:"music-player-simple",onClick:n[0]||(n[0]=(...i)=>c.onClick&&c.onClick(...i))},[e.loading?(p(),V(o,{key:0})):e.error?(p(),g("div",Se,f(e.error),1)):(p(),g(C,{key:2},[d("img",{class:"music-player-simple-pic",src:e.music.picUrl},null,8,Ce),d("div",xe,[d("p",Ie,"🎶"+f(e.music.name),1),d("p",je,f(e.music.singer),1)])],64))])}const Te=y($e,[["render",Me],["__scopeId","data-v-28e6aab9"]]);const Le={components:{LoadingIcon:U},props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[emoji (.*?)\]/)[1],e=u(`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/emoji/${t}.png`),r=u(!0);return{id:u(t),loading:r,imageSrc:e}}},De={class:"md-sticker"},Ee=["src","alt"];function Ve(s,n,t,e,r,c){const o=w("LoadingIcon");return p(),g("div",De,[e.loading?(p(),V(o,{key:0,class:"loading"})):E("",!0),L(d("img",{class:x(["sticker-image",{"sticker-image-loading":e.loading}]),src:e.imageSrc,alt:e.id||s.src,onLoad:n[0]||(n[0]=i=>e.loading=!1),onDragstart:n[1]||(n[1]=T(()=>{},["prevent"]))},null,42,Ee),[[D,!e.loading]])])}const Be=y(Le,[["render",Ve],["__scopeId","data-v-d3b6fa8d"]]),Pe={props:{hashtag:{type:String,default:""}},emits:["hashtag-click"],methods:{onClick(s){this.$emit("hashtag-click",{event:s,hashtag:this.hashtag.slice(1)})}}};function Ue(s,n,t,e,r,c){return p(),g("a",{href:"#",onClick:n[0]||(n[0]=(...o)=>c.onClick&&c.onClick(...o))},f(t.hashtag),1)}const Ae=y(Pe,[["render",Ue]]);function I(s,n){return function(t){const{tokens:e}=t;for(const r of e){if(r.type!=="inline")continue;const c=[],o=[];for(const i of r.children){if(i.type.endsWith("_open")){const _=i.type.slice(0,i.type.indexOf("_open"));o.push(_)}if(i.type.endsWith("_close")&&o.pop(),i.type==="text"&&s.test(i.content)){const _=i.content;let l=0;if(_.replace(new RegExp(s,"g"),function(...a){const[b]=a,h=n(b,o);if(h!==!1){const v=a[a.length-2];if(v>l){const j=new k("text","",0);j.content=_.slice(l,v),c.push(j)}l=v+b.length,c.push(h)}}),l<_.length){const a=new k("text","",0);a.content=_.slice(l),c.push(a)}}else c.push(i)}r.children=c}}}function Re(s){return I(/(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/,t=>{const e=new k("emoji","",0);return e.markup=t,e.content=t,e})}function Fe(s,n){s.core.ruler.after("linkify","emoji",Re())}function Oe(s){const n=/\[((music)|(youtube)|(bilibili)|(emoji)) (.*?)\]/;return I(n,t=>{const e=t.match(n),r=new k("media","",0);return r.markup=t,r.content=t,r.block=!0,r.info=e[1],r})}function We(s,n){s.core.ruler.after("text_join","media",Oe())}function He(s){return I(/#(\S*)/,(t,e)=>{if(e[e.length-1]==="link")return!1;const r=new k("hashtag","",0);return r.markup=t,r.content=t,r})}function Ne(s,n){s.core.ruler.after("linkify","hashtag",He())}const $=new R({breaks:!0});$.use(Fe);$.use(We);$.use(Ne);const qe={props:{modelValue:{type:String,default:()=>""}},emits:["hashtag-click"],setup(s,n){const t=function(c){const o=[],i=[];for(let _=0;_<c.length;_++){const l=c[_];if(l.type.endsWith("_open")){const a=l.type.slice(0,l.type.indexOf("_open"));i.push({type:a,tag:l.tag,block:l.block,content:"",attrs:l.attrs,children:[]});continue}if(l.type.endsWith("_close")){if(i.length>1){const a=i.pop();i[i.length-1].children.push(a)}else o.push(i.pop());continue}if(i.length>0){const a=i[i.length-1];a.content=l.content,l.type==="inline"?a.children.push(...t(l.children)):a.children.push(l)}else o.push(l)}return o},e=function(c){return c.map(o=>{var _,l;const i=((_=o.attrs)==null?void 0:_.reduce((a,b)=>{const[h,v]=b;return a[h]?Array.isArray(a[h])?a[h].push(v):a[h]=[a[h],v]:a[h]=v,a},{}))||{};switch(o.type){case"text":return o.content;case"emoji":return m(ue,{...i,emoji:o.content,key:o.content},"");case"hashtag":return m(n.slots.hashtag??Ae,{...i,hashtag:o.content,key:o.content,onHashtagClick:a=>{n.emit("hashtag-click",a)}},"");case"media":{switch(o.info){case"bilibili":return m(he,{...i,content:o.content,key:o.content},"");case"youtube":return m(ke,{...i,content:o.content,key:o.content},"");case"music":return m(Te,{...i,content:o.content,key:o.content},"");case"emoji":return m(Be,{...i,content:o.content,key:o.content},"")}break}case"link":return m(o.tag,{...i,target:"_blank"},e(o.children));case"image":return m(X,{src:i.src,alt:o.content,key:o.content},"");case"fence":return m(oe,{...i,lang:o.info||"text",content:o.content,key:o.content},"");default:return m(o.tag||"span",i,((l=o.children)==null?void 0:l.length)>0?e(o.children):o.content)}})},r=F(s,"modelValue");return()=>{const c=t($.parse(r.value,{}));return m("div",{class:"markdown-body"},e(c))}}},Ge=y(qe,[["__scopeId","data-v-dd808ed6"]]);export{Ge as M};
