import{_ as E,B as S,L as A,A as N,a as M,D as O,E as L,w as T,F as H}from"./index-f279b7cc.js";import{P as z}from"./PageHeader-91feca81.js";import{h as F,i as R,f as U,g as W}from"./element-plus-2fbd5573.js";import{b2 as C,bM as k,b0 as B,b6 as j,cd as r,aR as f,aS as P,bG as d,bA as c,bz as w,bD as V,a_ as q,bW as J,bE as G,bF as x,aT as D}from"./vendor-5d98ec45.js";import"./highlightjs-4914df6f.js";const K={components:{ButtonBox:S,LoadingIcon:A,AsyncButtom:N,PageHeader:z,ElTable:F,ElTableColumn:R,ElRadioGroup:U,ElRadio:W},setup(){const a=C("/"),l=C("kooritea.github.io"),v=k({}),t=k([{label:"公开库",value:"kooritea.github.io"},{label:"私有库",value:"private-database"},{label:"媒体库",value:"media-database"}]);for(const e of t)v[e.value]={};const s=B(()=>v[l.value]),p=C(!1),u=k([]),{devMode:h}=M(),n=B(()=>({repo:h.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),g=e=>{u.splice(0,u.length),u.push(...e)},m=B(()=>{const e=[...s.value[a.value]||[]];return!p.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),o=(e,i)=>{if(a.value=e,!s.value[e]||i)return s.value[e]=void 0,p.value=!0,O({...n.value,path:e}).then(_=>{_.type==="dir"&&(s.value[e]=[..._.children.filter(y=>y.type==="dir"),..._.children.filter(y=>y.type==="file")])}).finally(()=>{p.value=!1})};o("/"),j(l,()=>{o("/")});const b=e=>L({...n.value,files:e.map(i=>({isDel:!0,path:i.path}))}).then(()=>o(a.value,!0));return{dataBaseList:t,onSelectionChange:g,repoConfig:n,tableData:m,loadPath:o,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>T({title:`[${n.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:i=>H({...n.value,branch:void 0,file:e[0]}).then(({sha:_})=>L({...n.value,files:[{sha:_,path:i.inputValue}]}).then(()=>o(a.value,!0))),inputValidator:i=>!!i,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",disabled:()=>u.length===0,handler:()=>b(u)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in s.value)delete s.value[e];return o("/")}}],deleteItem:b,database:l}},methods:{onCellClick(a,l,v,t){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},Q={class:"page"};function X(a,l,v,t,s,p){const u=r("PageHeader"),h=r("el-radio"),n=r("el-radio-group"),g=r("LoadingIcon"),m=r("el-table-column"),o=r("AsyncButtom"),b=r("el-table"),I=r("ButtonBox");return f(),P("div",Q,[d(u),d(n,{modelValue:t.database,"onUpdate:modelValue":l[0]||(l[0]=e=>t.database=e)},{default:c(()=>[(f(!0),P(q,null,J(t.dataBaseList,e=>(f(),w(h,{key:e.value,value:e.value,size:"large"},{default:c(()=>[G(x(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),d(b,{border:"",data:t.tableData,style:{width:"100%"},onCellClick:p.onCellClick,onSelectionChange:t.onSelectionChange},{empty:c(()=>[D("div",null,[d(g)])]),default:c(()=>[d(m,{type:"selection",selectable:e=>e.type==="file"},null,8,["selectable"]),d(m,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{default:c(e=>[D("span",null,x(e.row.type==="dir"?"📁":"📄")+x(e.row.name),1)]),_:1}),d(m,{label:"操作",width:"120px"},{default:c(e=>[e.row.type==="file"?(f(),w(o,{key:0,type:"danger",size:"mini",onLoadingClick:()=>t.deleteItem([e.row])},{default:c(()=>[G(" 删除 ")]),_:2},1032,["onLoadingClick"])):V("",!0)]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),t.handlers.length>0?(f(),w(I,{key:0,handlers:t.handlers},null,8,["handlers"])):V("",!0)])}const te=E(K,[["render",X],["__scopeId","data-v-2ce92b51"]]);export{te as default};
