import{_ as F,S as W,q as K,a as L,r as E,b as k,d as h,e as y,h as m,F as $,E as O,f as x,w as A,t as I,n as N,fX as Z,fY as G,a2 as q,fZ as Q,Z as V,at as X,a6 as Y,u as J,K as ee,W as te,ah as ae,ai as ne,a9 as oe,c as le,Q as re,cj as se,T as ce,p as b,g as T,f_ as ie,f$ as de}from"./index-9642dfbb.js";import{M as ue}from"./MarkDown-a1ca9487.js";import{I as me}from"./ImageCon-2647d6fb.js";/* empty css                       *//* empty css                     *//* empty css                  */import{E as he}from"./index-3678bb54.js";import{E as fe}from"./index-674e9721.js";const pe={components:{SvgIcon:W,ImageCon:me},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(a,{emit:l}){const{emoteHistory:d}=K(),e=L({name:"history",emote:d.value}),t=L([]),p=E("history"),v=s=>{if(p.value=s.name,s.emote.length===0)return Z(s.name).then(c=>{p.value=s.name,s.emote=c.emote.map(H=>({...H,scope:s.name}))})},f=()=>{t.splice(0,t.length),t.push(e),G().then(s=>{t.push(...s.sort((c,H)=>{const D=d.value.findIndex(M=>M.scope===c.name),S=d.value.findIndex(M=>M.scope===H.name);return(D===-1?1/0:D)-(S===-1?1/0:S)})),t.push({name:"add",emote:[]})})};return f(),{onSelect:s=>{l("select",s),d.value=d.value.filter(c=>!(c.scope===s.scope&&c.name===s.name)),d.value=[s,...d.value].slice(0,30),e.emote=d.value},addEmotePackage:()=>{q({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:s=>Q(s.inputValue).then(()=>{V.success("添加成功"),f()}),inputValidator:s=>/^\d+$/.test(s),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:p,emotePackages:t,selectScope:v}}},ve={class:"emote-selector"},ge={class:"emotes"},_e={class:"scopes"},ye=["onClick"];function we(a,l,d,e,t,p){const v=k("ImageCon"),f=k("SvgIcon");return h(),y("div",ve,[m("div",ge,[(h(!0),y($,null,O((e.emotePackages.find(n=>n.name===e.currentScope)||{}).emote||[],n=>(h(),x(v,{key:n.name,class:"emote",alt:n.name,src:`/kooritea/kooritea.github.io/emoji/${n.scope}/${n.name}.png`,onClick:w=>e.onSelect(n)},{error:A(()=>[m("span",null,I(n.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),m("div",_e,[(h(!0),y($,null,O(e.emotePackages,n=>(h(),y("div",{key:n.name,class:N(["scope",{"selected-scope":e.currentScope===n.name}]),onClick:()=>{n.name==="add"?e.addEmotePackage():e.selectScope(n)}},[n.name==="history"?(h(),x(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(h(),x(f,{key:1,class:"emote history",name:"add"})):(h(),x(v,{key:2,class:"emote",src:`/kooritea/kooritea.github.io/emoji/${n.name}/${n.name}.png`},{error:A(()=>[m("span",null,I(n.name),1)]),_:2},1032,["src"]))],10,ye))),128))])])}const Se=F(pe,[["render",we],["__scopeId","data-v-aba84f95"]]);function ke(a){const l=E(null),d=X(he,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:l.value,"onUpdate:modelValue":e=>{var t;l.value=e,(t=d.component)!=null&&t.props&&(d.component.props.modelValue=e)}});q({title:"选择预约时间",message:d,confirmHandlerPromise:e=>a(l),inputValidator:e=>!!l.value,inputErrorMessage:"请选择预约时间"})}const P={},Ee={components:{SvgIcon:W,Markdown:ue,ButtonBox:Y,EmoteSelector:Se,ElPopover:fe},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(a,{emit:l}){const{darkMode:d}=J(),e=E(!0),{computedModelValue:t}=ee(a,l),p=E(!1),v=E(null);if(a.cache){const o=te();if(P[o.fullPath]&&a.cache===!0)V.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const i="MDEditorCache."+(a.cache===!0?o.fullPath:`${o.fullPath}.${a.cache}`);t.value=localStorage.getItem(i)||a.defaultValue;let r=null;ae(()=>{P[i]=!0,r=setInterval(()=>{p.value=!0,localStorage.setItem(i,t.value||"")},1e3)}),ne(()=>{P[i]=!1,clearInterval(r)}),oe(t,()=>{p.value=!1})}}const f=o=>{const i=v.value.selectionStart,r=t.value.slice(0,i),g=t.value.slice(i);t.value=`${r}${o}${g}`},n=E(t.value),w=({reservationDate:o}={})=>{const i=a.onSubmit(t.value,o==null?void 0:o.value);return i instanceof Promise?i.then(()=>{t.value=a.defaultValue,n.value=a.defaultValue}):(t.value=a.defaultValue,n.value=a.defaultValue),i},s=()=>{t.value=""},c=()=>{t.value=n.value},H=[{name:"提交",type:"primary",handler:w,show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("submit"):a.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{ke(o=>{w({reservationDate:o})})},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reservation"):a.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:s,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("clean"):a.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:c,show:()=>(Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reset"):a.showDefaultHandlers)&&!!n.value,sort:30}],D=le(()=>[...H,...a.exHandlers]),S=o=>{const i=ie(URL.createObjectURL(o),{handlers:[{name:"上传",type:"primary",handler:()=>{const r=new Date().valueOf().toString();f(`![${r}](--------------------)`),de(o,g=>{const _=Math.round(100*event.loaded/event.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${r}]\\((#*?)(-*?)\\)`),`![${r}](${"#".repeat(_)}${"-".repeat(20-_)})`)}).then(g=>{t.value=t.value.replace(new RegExp(`\\!\\[${r}]\\((#*?)(-*?)\\)`),`![${g.keyname}](${g.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${r}]\\((#*?)(-*?)\\)`),"")}),i.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{const r=document.createElement("canvas"),g=r.getContext("2d"),u=new Image;u.onload=async()=>{if(u.height*16===u.width*9)return;const _=u.height*16/9;if(_>u.width){const C=.5625*u.width;r.width=u.width,r.height=C,g.drawImage(u,0,(u.height-C)/2,u.width,C,0,0,u.width,C)}else r.width=_,r.height=u.height,g.drawImage(u,(u.width-_)/2,0,_,u.height,0,0,_,u.height);const U=r.toDataURL(o.type).split(","),z=U[0].match(/:(.*?);/)[1],R=atob(U[1]);let B=R.length;const j=new Uint8Array(B);for(;B--;)j[B]=R.charCodeAt(B);i.callClose(),S(new File([j],o.name,{type:z}))},u.src=URL.createObjectURL(o)}},{name:"取消",type:"default",handler:()=>{i.callClose()}}]})};return{darkMode:d,isEditMode:e,computedModelValue:t,resetCache:n,isSave:p,handlers:D,submitHandler:w,cleanHandler:s,resetHandler:c,previewImageBeforeUpload:S,pasteHandler:o=>{if(!(o.clipboardData&&o.clipboardData.items))return;const i=Array.from(o.clipboardData.items).filter(r=>r.kind==="file");if(i.length>0){o.preventDefault();for(const r of i)if(r.type.startsWith("image/")){S(r.getAsFile());return}else V.warning(`不支持的文件类型: ${r.type}`)}},dropHandler:o=>{for(const i of o.dataTransfer.files)if(o.preventDefault(),i.type.startsWith("image/")){S(i);return}else V.warning(`不支持的文件类型: ${i.type}`)},textarea:v,insertText:f}}},He={class:"md-editor"},be={class:"fill"},xe={key:1,class:"preview"},Ie={class:"bar"},De={class:"bar-left"},Me={class:"title"},Be={class:"uploader"},Ce={class:"bar-right"},Ve={key:0,class:"is-save info"};function Ae(a,l,d,e,t,p){const v=k("Markdown"),f=k("SvgIcon"),n=k("EmoteSelector"),w=k("el-popover"),s=k("ButtonBox");return h(),y($,null,[m("div",He,[e.isEditMode?(h(),y("div",{key:0,class:N(["textarea-box",{"auto-height":d.autoHeight}])},[m("pre",be,I(e.computedModelValue),1),re(m("textarea",{ref:"textarea","onUpdate:modelValue":l[0]||(l[0]=c=>e.computedModelValue=c),class:"textarea",onPaste:l[1]||(l[1]=(...c)=>e.pasteHandler&&e.pasteHandler(...c)),onDragover:l[2]||(l[2]=ce(()=>{},["prevent"])),onDrop:l[3]||(l[3]=(...c)=>e.dropHandler&&e.dropHandler(...c))},null,544),[[se,e.computedModelValue]])],2)):(h(),y("div",xe,[b(v,{"model-value":e.computedModelValue},null,8,["model-value"])])),m("div",Ie,[m("div",De,[m("div",Me,I(d.title),1),m("label",Be,[b(f,{class:"button",name:"14"}),m("input",{type:"file",accept:"image/*",onChange:l[4]||(l[4]=c=>{e.previewImageBeforeUpload(c.srcElement.files[0]),c.srcElement.value=""})},null,32)]),b(w,{width:"auto",trigger:"click",effect:e.darkMode?"dark":"light"},{reference:A(()=>[b(f,{class:"button",name:"biaoqing"})]),default:A(()=>[b(n,{onSelect:l[5]||(l[5]=c=>{e.insertText(`[emoji ${c.scope}/${c.name}]`)})})]),_:1},8,["effect"])]),m("div",Ce,[e.isSave?(h(),y("span",Ve,"已保存")):T("",!0),m("span",{class:"preview-switch button",onClick:l[6]||(l[6]=c=>e.isEditMode=!e.isEditMode)},I(e.isEditMode?"预览":"返回编辑"),1)])])]),e.handlers.length>0?(h(),x(s,{key:0,handlers:e.handlers},null,8,["handlers"])):T("",!0)],64)}const Pe=F(Ee,[["render",Ae],["__scopeId","data-v-7ca63b31"]]),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{Pe as M,Ne as a,ke as u};
