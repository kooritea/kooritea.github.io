import{_ as S,S as b,u as M,a as C,e as w,L as E,f as P,b as L,s as O,c as K,h as V,i as W,j,k as H}from"./index-a60b1809.js";import{P as U}from"./PageHeader-e28ae34c.js";import{N as T}from"./NextButton-baa58fdd.js";import{M as A}from"./MarkDown-6741e6ef.js";import{b8 as f,cg as r,aR as a,aS as c,bp as G,bD as k,bA as I,bs as B,aT as p,bx as x,bC as v,bw as h,d8 as R,bI as q,a_ as z,b_ as F}from"./vendor-a6581121.js";import{b as J}from"./element-plus-5d967f66.js";import"./highlightjs-4914df6f.js";import"./ImageCon-1ea1f6ee.js";const Q={components:{SvgIcon:b},setup(){return{isSimplifty:f(!1)}},mounted(){this.$el.offsetHeight>600&&(this.isSimplifty=!0)}},X={key:0,class:"simplifty-mask"};function Y(e,n,o,t,u,l){const y=r("SvgIcon");return a(),c("div",{class:B(["simplifty-box",{"is-simplifty":t.isSimplifty}])},[G(e.$slots,"default",{},void 0,!0),t.isSimplifty?(a(),c("div",X,[k(y,{name:"zhankai",class:"expend-button",onClick:n[0]||(n[0]=m=>t.isSimplifty=!1)})])):I("",!0)],2)}const Z=S(Q,[["render",Y],["__scopeId","data-v-8a787155"]]);function D(e,n){const{darkMode:o}=M(),{darkModeDecodeKey:t}=C();return o.value&&(e.hide||n)?e.id?w(e.hide,t.value):e.hide:e.content}const $={components:{Markdown:A,SimpliftyBox:Z,LoadingIcon:E,"el-popover":J},props:{essay:{type:Object,required:!0},essayMap:{type:Object,required:!0},inPopover:{type:Boolean,default:!1}},emits:["set-search-key-word","load-essay-by-id"],setup(){const{darkMode:e}=M();return{darkMode:e,formatDate:P,Error}},methods:{getEssayContent:D}},ee={class:"essay"},se=["onClick"],te={class:"hashtag"},ne={key:0,class:"loading-box"},oe={key:1},ae={class:"info"},ie={class:"essay-id"};function le(e,n,o,t,u,l){const y=r("LoadingIcon"),m=r("ChaosItem",!0),g=r("el-popover"),_=r("Markdown"),d=r("SimpliftyBox");return a(),c("div",ee,[p("article",{class:B(["article",{"in-popover":o.inPopover}])},[k(d,null,{default:x(()=>[k(_,{"model-value":l.getEssayContent(o.essay)},{hashtag:x(({hashtag:s})=>[!/^#\d+$/.test(s)||o.inPopover?(a(),c("span",{key:0,class:"hashtag",onClick:i=>e.$emit("set-search-key-word",s)},v(s),9,se)):(a(),h(g,{key:1,width:"",trigger:"click","popper-class":"popper-essay",effect:t.darkMode?"dark":"light",onShow:()=>{o.essayMap[s.slice(1)]||e.$emit("load-essay-by-id",s.slice(1))}},{reference:x(()=>[p("span",te,v(s),1)]),default:x(()=>[!o.essayMap[s.slice(1)]||o.essayMap[s.slice(1)]instanceof t.Error?(a(),c("div",ne,[o.essayMap[s.slice(1)]?(a(),c("span",oe,v(o.essayMap[s.slice(1)].message),1)):(a(),h(y,{key:0}))])):(a(),h(m,{key:1,essay:o.essayMap[s.slice(1)],"essay-map":o.essayMap,"in-popover":!0,onSetSearchKeyWord:n[0]||(n[0]=i=>{e.$emit("set-search-key-word",i)})},null,8,["essay","essay-map"]))]),_:2},1032,["effect","onShow"]))]),_:1},8,["model-value"])]),_:1})],2),p("div",ae,[p("span",ie,"#"+v(o.essay.id||"预约中"),1),p("span",null,v(t.formatDate(o.essay.time,`yyyy-MM-dd HH:mm:ss UTC ${t.darkMode?"NDD":"DD"}`)),1)])])}const re=S($,[["render",le],["__scopeId","data-v-1ed5ce2f"]]);const de={components:{ChaosItem:re,PageHeader:U,NextButton:T,SvgIcon:b,MDEditor:R({loader:()=>H(()=>import("./MDEditor-2810abb8.js").then(e=>e.a),["https://kooritea.moe/assets/MDEditor-2810abb8.js","https://kooritea.moe/assets/vendor-a6581121.js","https://kooritea.moe/assets/highlightjs-4914df6f.js","https://kooritea.moe/assets/vendor-2bc9f95b.css","https://kooritea.moe/assets/index-a60b1809.js","https://kooritea.moe/assets/element-plus-5d967f66.js","https://kooritea.moe/assets/element-plus-22a745f6.css","https://kooritea.moe/assets/index-a818a740.css","https://kooritea.moe/assets/MarkDown-6741e6ef.js","https://kooritea.moe/assets/ImageCon-1ea1f6ee.js","https://kooritea.moe/assets/ImageCon-b92f02bb.css","https://kooritea.moe/assets/MarkDown-863448ad.css","https://kooritea.moe/assets/MDEditor-06264cc7.css"],import.meta.url),loadingComponent:E})},setup(){const e=f({}),{darkMode:n,isGreatOldOne:o}=M(),{offlineMode:t}=C(),u=f(""),l=q([]),y=f(!1),m=f(!1),g=f(null),_=d=>(m.value=!0,j(d).then(s=>{s=s.map(i=>(e.value[i.id]=i,{...i,expend:!1})),y.value=s.length===10,l.push(...s)}).finally(()=>{m.value=!1}));return _(),o.value&&L().then(d=>{d=d.sort((s,i)=>new Date(s.time).valueOf()-new Date(i.time).valueOf());for(const s of d)l.unshift(s)}),{loading:m,searchBlogEssays:_,essays:l,searchKeyWord:u,offlineMode:t,hasNext:y,darkMode:n,essayMap:e,setScorllGotoTop:O,isGreatOldOne:o,editing:g}},methods:{getEssayContent:D,search(e){if(this.essays.splice(0,this.essays.length),this.offlineMode&&e&&!/^#\d+$/.test(e)){this.$msgBox.error("离线模式下仅可以使用id搜索");return}return this.searchBlogEssays({keyword:e})},onNext(){var n;const e=(n=this.essays[this.essays.length-1])==null?void 0:n.id;return this.searchBlogEssays({keyword:this.searchKeyWord,start:e?e-1:void 0})},loadEssayById(e){if(this.essayMap[e]!==null)return this.essayMap[e]=null,K({id:e}).then(n=>{this.essayMap[e]=n}).catch(n=>{this.essayMap[e]=new Error(n)})},onSubmitUpdateEssay(e,n,o,t){if(e.id)return V(e.id,{content:n?void 0:o,hide:n?o||null:void 0}).then(u=>{Object.assign(e,u),this.editing=null});if(e.uuid)return W(e.uuid,{content:n?void 0:o,hide:n?o||null:void 0,time:t}).then(u=>{Object.assign(e,u),this.editing=null})}}},ce={class:"page"};function ue(e,n,o,t,u,l){const y=r("PageHeader"),m=r("ChaosItem"),g=r("MDEditor"),_=r("SvgIcon"),d=r("NextButton");return a(),c("div",ce,[k(y,{modelValue:t.searchKeyWord,"onUpdate:modelValue":n[0]||(n[0]=s=>t.searchKeyWord=s),"show-search-input":!0,"on-input":l.search},null,8,["modelValue","on-input"]),p("ul",null,[(a(!0),c(z,null,F(t.essays,s=>(a(),c("li",{key:s.id,class:"essay-box"},[t.editing!==s?(a(),h(m,{key:0,essay:s,"essay-map":t.essayMap,onSetSearchKeyWord:n[1]||(n[1]=i=>{t.searchKeyWord=i,t.setScorllGotoTop()}),onLoadEssayById:l.loadEssayById},null,8,["essay","essay-map","onLoadEssayById"])):(a(),h(g,{key:1,"model-value":l.getEssayContent(s,!0),cache:!1,"ex-handlers":[{name:"取消",handler:()=>{t.editing=null}}],"on-submit":(i,N)=>l.onSubmitUpdateEssay(s,t.darkMode,i,N)},null,8,["model-value","ex-handlers","on-submit"])),t.isGreatOldOne&&t.editing!==s?(a(),h(_,{key:2,name:"bianji",onClick:i=>t.editing=s},null,8,["onClick"])):I("",!0)]))),128))]),k(d,{hasNext:t.hasNext,"onUpdate:hasNext":n[2]||(n[2]=s=>t.hasNext=s),loading:t.loading,"onUpdate:loading":n[3]||(n[3]=s=>t.loading=s),onLoadingClick:l.onNext},null,8,["hasNext","loading","onLoadingClick"])])}const ke=S(de,[["render",ue],["__scopeId","data-v-404cc5a1"]]);export{ke as default};
