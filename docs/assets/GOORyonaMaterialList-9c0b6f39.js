import{n as w,o as S}from"./element-plus-40a28a03.js";import{P as V}from"./PageHeader-3693671b.js";import{_ as g,u as y,Z as D,M as I,w as x,$ as M,a0 as T,a1 as C}from"./index-dc36599c.js";import{f as m}from"./float-7d62ecbe.js";import{cg as n,aR as c,bw as v,bx as b,bD as u,aT as P,aS as _,b_ as G,bC as h,a_ as F,bB as E}from"./vendor-cce75f21.js";import"./highlightjs-4914df6f.js";const O={setup(){const{mobileMode:e}=y();return{mobileMode:e}},data(){return{float:m,dialogVisible:!1,formConfig:{labelPosition:"top"},materials:[],formData:{},fields:[{type:"slot",slotName:"materialsInfo",prop:"materialIds",label:"包含切片",required:!0,formProps:{multiple:!0}},{type:"input",prop:"title",label:"标题",required:!0,options:()=>Array.from(new Set(this.materials.map(e=>{var t;return(t=e.bangumi)==null?void 0:t.nname})))},{type:"select",prop:"thumbnail",label:"封面",required:!0,options:()=>this.materials.map((e,t)=>{if(e.thumbnail===null)return null;const o=e.thumbnail,a=this.materials.slice(0,t).reduce((r,l)=>m.add(r,m.subtract(l.end,l.start)),0);return m.add(o,a)}).filter(e=>e!==null).map(e=>({label:e,value:String(e)}))},{type:"switch",prop:"publish",label:"立即发布",defaultValue:()=>!0}],buttons:[{label:"提交",type:"primary",handler:e=>e.formInstance.submitForm().then(t=>D(t).then(()=>{I.success("提交成功"),e.formInstance.resetFormData(),this.dialogVisible=!1}))}]}},methods:{open({materials:e}){this.materials=e,this.formData={materialIds:e.map(t=>t.id)},this.dialogVisible=!0}}},B={class:"materials-info"};function R(e,t,o,a,r,l){const i=n("EasyForm"),p=n("el-dialog");return c(),v(p,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=s=>r.dialogVisible=s),title:"创建切片集合",width:a.mobileMode?"95%":"80vw"},{default:b(()=>[u(i,{ref:"EasyForm",modelValue:r.formData,"onUpdate:modelValue":t[0]||(t[0]=s=>r.formData=s),fields:r.fields,buttons:r.buttons,"form-config":r.formConfig},{materialsInfo:b(()=>[P("div",B,[(c(!0),_(F,null,G(r.materials,(s,d)=>(c(),_("div",{key:s.id,class:"material"},h(d+1)+"、["+h(r.float.subtract(s.end,s.start))+"s]"+h(s.filepath),1))),128))])]),_:1},8,["modelValue","fields","buttons","form-config"])]),_:1},8,["modelValue","width"])}const L=g(O,[["render",R],["__scopeId","data-v-d348dae2"]]);const k={components:{PageHeader:V,GPPRyonaCreateGroupDialog:L},setup(){const{mobileMode:e}=y();return{mobileMode:e}},data(){return{isExSearch:!1,bangumiOptions:[],tableData:[],selected:[],tableProp:{indexWidth:"80px",tableConfig:{showPagination:!0,selection:!0,tableProps:{stripe:!0,border:!0},publicTableProps:{showOverflowTooltip:!0}},emitLoadOnCreate:!0,buttons:[{type:"text",label:"删除",handler:(e,t)=>{x({title:"提示",message:`确认删除${t.row.filepath}`,type:"warning",confirmHandlerPromise:o=>M(t.row.id).then(()=>{this.$refs.EditTable.search()})})}}]},searchFormProp:{formConfig:{labelWidth:"100px",labelPosition:"right",gutter:32}},fields:[{type:"select",label:"ID",prop:"id",span:this.mobileMode?24:12,tableProps:{width:60},showInForm:!1},{type:"select",prop:"bid",label:"Bangumi",formProps:{remote:!0,filterable:!0,remoteMethod:e=>{e&&T(e).then(t=>{this.bangumiOptions=t.map(o=>({label:o.name||o.nname,subLabel:o.nname,value:o.subject}))})}},tableProps:{width:250,formatter:(e,t,o)=>{var a,r;return((a=e.bangumi)==null?void 0:a.name)||((r=e.bangumi)==null?void 0:r.nname)}},showInForm:!1,options:()=>this.bangumiOptions,span:this.mobileMode?24:12},{type:"number",prop:"ep",label:"集数",formProps:{min:0},showInForm:!1,tableProps:{width:80}},{type:"date-picker",prop:"start",label:"开始时间",showInForm:!1,tableProps:{width:120,formatter:(e,t,o)=>this.secondsToTimeString(o)}},{type:"date-picker",prop:"end",label:"结束时间",showInForm:!1,tableProps:{width:120,formatter:(e,t,o)=>this.secondsToTimeString(o)}},{type:"select",prop:"tag",valueSplitChar:",",formProps:{multiple:!0,filterable:!0},span:this.mobileMode?24:12,optionsBaseCode:"VIDEO_TAG",label:"标签"},{type:"buttons",showInTable:!1,hiddenLabel:!0,label:"搜索操作",prop:"搜索操作",span:6,formItemProp:{labelWidth:"0px"},buttons:[{label:e=>this.isExSearch?"收起":"展开",leftIcon:e=>this.isExSearch?w:S,type:"primary",buttonProps:{link:!0},handler:e=>{this.isExSearch=!this.isExSearch}},{label:"查询",type:"primary",handler:e=>{const{meta:t}=e,{_editTable:o}=t,{editTableInstance:a}=o;a.search()}},{label:"重置",type:"primary",buttonProps:{plain:!0},handler:e=>{const{meta:t}=e,{_editTable:o}=t,{editTableInstance:a}=o;a.search({reset:!0})}}]}]}},methods:{onLoad(e,t){return C({size:e.size,page:e.current}).then(o=>({tableData:o.records,total:o.total}))},secondsToTimeString(e){e=Math.max(0,e);const t=Math.floor(e%1*1e3),o=Math.floor(e),a=Math.floor(o/3600),r=Math.floor(o%3600/60),l=o%60,i=String(a).padStart(2,"0"),p=String(r).padStart(2,"0"),s=String(l).padStart(2,"0"),d=t>0?"."+String(t).padStart(3,"0"):"";return`${i}:${p}:${s}${d}`}}},H={class:"page"},A={class:"table-top"};function N(e,t,o,a,r,l){const i=n("PageHeader"),p=n("el-button"),s=n("edit-table"),d=n("GPPRyonaCreateGroupDialog");return c(),_("div",H,[u(i),u(s,{ref:"EditTable",modelValue:r.tableData,"onUpdate:modelValue":t[1]||(t[1]=f=>r.tableData=f),selected:r.selected,"onUpdate:selected":t[2]||(t[2]=f=>r.selected=f),"show-search-form":!0,fields:r.fields,"table-prop":r.tableProp,"search-form-prop":r.searchFormProp,"search-loader":l.onLoad},{"table-top":b(()=>[P("div",A,[u(p,{disabled:r.selected.length<2,type:"primary",onClick:t[0]||(t[0]=()=>{e.$refs.GPPRyonaCreateGroupDialog.open({materials:r.selected})})},{default:b(()=>[E(" 生成集合 ")]),_:1},8,["disabled"])])]),_:1},8,["modelValue","selected","fields","table-prop","search-form-prop","search-loader"]),u(d,{ref:"GPPRyonaCreateGroupDialog"},null,512)])}const J=g(k,[["render",N],["__scopeId","data-v-7ec96597"]]);export{J as default};
