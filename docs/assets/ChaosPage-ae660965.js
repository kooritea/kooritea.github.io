import{_ as S,S as I,L as B,u as E,a as C,f as P,e as N,s as H,b as L,c as K,h as O}from"./index-4ba0857e.js";import{P as W,u as V}from"./GreatOldOne-b84ab02c.js";import{N as U}from"./NextButton-1d5f8655.js";import{M as j}from"./MarkDown-a7d589e1.js";import{a_ as m,cd as d,aL as t,aM as r,ba as G,bk as g,bw as D,bh as w,aN as u,bq as b,bv as v,br as p,cs as T,bl as q,bW as A}from"./vendor-181cef01.js";import{a as z}from"./element-plus-c9c19afe.js";import"./highlightjs-4914df6f.js";import"./ImageCon-503956e8.js";const F={components:{SvgIcon:I},setup(){return{isSimplifty:m(!1)}},mounted(){this.$el.offsetHeight>600&&(this.isSimplifty=!0)}},R={key:0,class:"simplifty-mask"};function J(o,a,n,e,k,l){const c=d("SvgIcon");return t(),r("div",{class:w(["simplifty-box",{"is-simplifty":e.isSimplifty}])},[G(o.$slots,"default",{},void 0,!0),e.isSimplifty?(t(),r("div",R,[g(c,{name:"icon-zhankai",class:"expend-button",onClick:a[0]||(a[0]=y=>e.isSimplifty=!1)})])):D("",!0)],2)}const Q=S(F,[["render",J],["__scopeId","data-v-72bf6d9a"]]);const X={components:{Markdown:j,SimpliftyBox:Q,LoadingIcon:B,"el-popover":z},props:{essay:{type:Object,required:!0},essayMap:{type:Object,required:!0},inPopover:{type:Boolean,default:!1}},emits:["set-search-key-word","load-essay-by-id"],setup(){const{darkMode:o}=E(),{darkModeDecodeKey:a}=C();return{darkMode:o,decodeHide:e=>N(e,a.value),formatDate:P,Error}}},Y={class:"essay"},Z=["onClick"],$={class:"hashtag"},ee={key:0,class:"loading-box"},se={key:1},oe={class:"info"},ae={class:"essay-id"};function ne(o,a,n,e,k,l){const c=d("LoadingIcon"),y=d("ChaosItem",!0),_=d("el-popover"),f=d("Markdown"),h=d("SimpliftyBox");return t(),r("div",Y,[u("article",{class:w(["article",{"in-popover":n.inPopover}])},[g(h,null,{default:b(()=>[g(f,{"model-value":e.darkMode&&n.essay.hide?e.decodeHide(n.essay.hide):n.essay.content},{hashtag:b(({hashtag:s})=>[!/^#\d+$/.test(s)||n.inPopover?(t(),r("span",{key:0,class:"hashtag",onClick:i=>o.$emit("set-search-key-word",s)},v(s),9,Z)):(t(),p(_,{key:1,width:"",trigger:"click","popper-class":"popper-essay",effect:e.darkMode?"dark":"light",onShow:()=>{n.essayMap[s.slice(1)]||o.$emit("load-essay-by-id",s.slice(1))}},{reference:b(()=>[u("span",$,v(s),1)]),default:b(()=>[!n.essayMap[s.slice(1)]||n.essayMap[s.slice(1)]instanceof e.Error?(t(),r("div",ee,[n.essayMap[s.slice(1)]?(t(),r("span",se,v(n.essayMap[s.slice(1)].message),1)):(t(),p(c,{key:0}))])):(t(),p(y,{key:1,essay:n.essayMap[s.slice(1)],"essay-map":n.essayMap,"in-popover":!0,onSetSearchKeyWord:a[0]||(a[0]=i=>{o.$emit("set-search-key-word",i)})},null,8,["essay","essay-map"]))]),_:2},1032,["effect","onShow"]))]),_:1},8,["model-value"])]),_:1})],2),u("div",oe,[u("span",ae,"#"+v(n.essay.id),1),u("span",null,v(e.formatDate(n.essay.time,`yyyy-MM-dd HH:mm:ss UTC ${e.darkMode?"NDD":"DD"}`)),1)])])}const te=S(X,[["render",ne],["__scopeId","data-v-4ba51001"]]);const ie={components:{ChaosItem:te,PageHeader:W,NextButton:U,SvgIcon:I,MDEditor:T({loader:()=>O(()=>import("./MDEditor-c0237fbf.js"),["https://kooritea.moe/assets/MDEditor-c0237fbf.js","https://kooritea.moe/assets/vendor-181cef01.js","https://kooritea.moe/assets/highlightjs-4914df6f.js","https://kooritea.moe/assets/index-4ba0857e.js","https://kooritea.moe/assets/element-plus-c9c19afe.js","https://kooritea.moe/assets/element-plus-3ea72c3d.css","https://kooritea.moe/assets/index-36e204dc.css","https://kooritea.moe/assets/MarkDown-a7d589e1.js","https://kooritea.moe/assets/ImageCon-503956e8.js","https://kooritea.moe/assets/ImageCon-7200ecbe.css","https://kooritea.moe/assets/MarkDown-93588ea4.css","https://kooritea.moe/assets/GreatOldOne-b84ab02c.js","https://kooritea.moe/assets/GreatOldOne-3c104762.css","https://kooritea.moe/assets/MDEditor-65f66bbd.css"],import.meta.url),loadingComponent:B})},setup(){const o=m({}),{darkMode:a,isGreatOldOne:n}=E(),{offlineMode:e,darkModeDecodeKey:k}=C(),l=m(""),c=m([]),y=m(!1),_=m(!1),f=m(null),h=i=>N(i,k.value),s=i=>(_.value=!0,K(i).then(M=>{M=M.map(x=>(o.value[x.id]=x,{...x,expend:!1})),y.value=M.length===10,c.value.push(...M)}).finally(()=>{_.value=!1}));return s(),{loading:_,searchBlogEssays:s,essays:c,searchKeyWord:l,offlineMode:e,hasNext:y,darkMode:a,essayMap:o,setScorllGotoTop:H,isGreatOldOne:n,editing:f,decodeHide:h}},methods:{search(o){if(this.essays=[],this.offlineMode&&o&&!/^#\d+$/.test(o)){this.$msgBox.error("离线模式下仅可以使用id搜索");return}return this.searchBlogEssays({keyword:o})},onNext(){var a;const o=(a=this.essays[this.essays.length-1])==null?void 0:a.id;return this.searchBlogEssays({keyword:this.searchKeyWord,start:o?o-1:void 0})},loadEssayById(o){if(this.essayMap[o]!==null)return this.essayMap[o]=null,L({id:o}).then(a=>{this.essayMap[o]=a}).catch(a=>{this.essayMap[o]=new Error(a)})},onSubmitUpdateEssay(o,a,n){return V(o.id,{content:a?void 0:n,hide:a?n:void 0}).then(e=>{Object.assign(o,e),this.editing=null})}}},de={class:"page"};function re(o,a,n,e,k,l){const c=d("PageHeader"),y=d("ChaosItem"),_=d("MDEditor"),f=d("SvgIcon"),h=d("NextButton");return t(),r("div",de,[g(c,{modelValue:e.searchKeyWord,"onUpdate:modelValue":a[0]||(a[0]=s=>e.searchKeyWord=s),"show-search-input":!0,"on-input":l.search},null,8,["modelValue","on-input"]),u("ul",null,[(t(!0),r(q,null,A(e.essays,s=>(t(),r("li",{key:s.id,class:"essay-box"},[e.editing!==s?(t(),p(y,{key:0,essay:s,"essay-map":e.essayMap,onSetSearchKeyWord:a[1]||(a[1]=i=>{e.searchKeyWord=i,e.setScorllGotoTop()}),onLoadEssayById:l.loadEssayById},null,8,["essay","essay-map","onLoadEssayById"])):(t(),p(_,{key:1,"model-value":e.darkMode?e.decodeHide(s.hide):s.content,cache:!1,"ex-handlers":[{name:"取消",handler:()=>{e.editing=null}}],"on-submit":i=>l.onSubmitUpdateEssay(s,e.darkMode,i)},null,8,["model-value","ex-handlers","on-submit"])),e.isGreatOldOne&&e.editing!==s?(t(),p(f,{key:2,name:"icon-bianji",onClick:i=>e.editing=s},null,8,["onClick"])):D("",!0)]))),128))]),g(h,{hasNext:e.hasNext,"onUpdate:hasNext":a[2]||(a[2]=s=>e.hasNext=s),loading:e.loading,"onUpdate:loading":a[3]||(a[3]=s=>e.loading=s),"on-click":l.onNext},null,8,["hasNext","loading","on-click"])])}const he=S(ie,[["render",re],["__scopeId","data-v-ea313bb0"]]);export{he as default};
