import{cg as w,aR as u,aS as p,bD as j,bR as I,aT as _,b8 as g,b0 as C,cB as O,bC as y,a_ as v,b_ as B,by as E,bs as $,bE as N,bA as T,bw as V,bt as z,bB as L,bx as W,bI as K,cY as Y,cZ as Z,db as x,dc as q,bG as G,bf as h}from"./vendor-a6581121.js";import{I as U}from"./ImageCon-3042c954.js";import{_ as f,S as X,V as J,u as Q,k as H,W as ee,X as te,L as F,Y as ne,A as oe}from"./index-1b08418c.js";const se={components:{ImageCon:U},props:{src:{type:String,default:()=>""},alt:{type:String,default:()=>""},srcPreFix:{type:[Array,String],default:()=>["https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://fastly.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://raw.githubusercontent.com/kooritea/kooritea.github.io/img"]}}},re={class:"md-image"};function ce(o,e,n,t,s,i){const r=w("ImageCon");return u(),p("div",re,[j(r,{ref:"ImageCon",src:n.src,prefix:n.srcPreFix,alt:n.alt||n.src,onClick:e[0]||(e[0]=a=>o.$imagePreview(o.$refs.ImageCon.applySrc,{fileName:n.alt})),onDragstart:e[1]||(e[1]=I(()=>{},["prevent"]))},null,8,["src","prefix","alt"])])}const ie=f(se,[["render",ce],["__scopeId","data-v-4c648a8d"]]);const ae={props:{content:{type:String,default:""}},setup(o){return{src:o.content.match(/\[video (.*?)\]/)[1]}}},le={class:"md-video"},ue=["src"];function de(o,e,n,t,s,i){return u(),p("div",le,[_("video",{class:"video",controls:"",preload:"none",src:t.src},null,8,ue)])}const pe=f(ae,[["render",de],["__scopeId","data-v-464e0edf"]]);const _e={components:{SvgIcon:X},directives:{"safe-html":J},props:{content:{type:String,required:!0},lang:{type:String,default:""}},setup(o){const{darkMode:e}=Q(),n=g(!1);let t=null;return H(()=>import("./highlightjs-4914df6f.js").then(s=>s.i),[],import.meta.url).then(s=>{n.value=!0,t=s.default}),{darkMode:e,highlightCode:C(()=>{if(n.value&&t.getLanguage(o.lang.toLowerCase()))return t.highlight(o.content,{language:o.lang.toLowerCase()}).value;{const s=document.createElement("div");return s.innerHTML=o.content,s.innerText}}),lineCount:C(()=>o.content.split(`
`).length-1)}},methods:{writeTextToClipboard(){ee(this.content),this.$msgBox.success("复制成功")}}},me={class:"code-block"},ge={class:"code-meta"},he={class:"lang"},fe={class:"code"},ye={class:"line-numbers"};function ke(o,e,n,t,s,i){const r=w("SvgIcon"),a=O("safe-html");return u(),p("div",me,[_("div",ge,[_("span",he,y(`${n.lang.slice(0,1).toUpperCase()}${n.lang.slice(1)}`),1),_("span",{class:"copy",onClick:e[0]||(e[0]=(...d)=>i.writeTextToClipboard&&i.writeTextToClipboard(...d))},[j(r,{name:"copy"})])]),_("div",fe,[_("div",ye,[(u(!0),p(v,null,B(new Array(t.lineCount).fill(""),(d,c)=>(u(),p("div",{key:c,class:"number"},y(c+1),1))),128))]),E(_("pre",{class:$(["hljs",{dark:t.darkMode,light:!t.darkMode}])},null,2),[[a,t.highlightCode]])])])}const be=f(_e,[["render",ke],["__scopeId","data-v-c2ba251c"]]);const ve=String.fromCharCode(8205),we=/\uFE0F/g,xe=(o,e="-")=>{const n=[];let t=0,s=0,i=0;for(;i<o.length;)t=o.charCodeAt(i++),s?(n.push((65536+(s-55296<<10)+(t-56320)).toString(16)),s=0):t>=55296&&t<=56319?s=t:n.push(t.toString(16));return n.join(e)};function Ie(o){return xe(o.indexOf(ve)<0?o.replace(we,""):o)}const $e={components:{ImageCon:U},props:{emoji:{type:String,default:""}},setup(o){const e=g(!1),t=`/${Ie(o.emoji)}.png`;return{showEmojiImg:e,imgSrc:t}}},Se={key:0};function Ce(o,e,n,t,s,i){const r=w("ImageCon");return u(),p(v,null,[E(j(r,{class:"emoji",src:t.imgSrc,prefix:["https://cdn.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://fastly.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://raw.githubusercontent.com/twitter/twemoji/assets/72x72"],alt:n.emoji,onLoad:e[0]||(e[0]=a=>t.showEmojiImg=!0)},null,8,["src","prefix","alt"]),[[N,t.showEmojiImg]]),t.showEmojiImg?T("",!0):(u(),p("span",Se,y(n.emoji),1))],64)}const Te=f($e,[["render",Ce],["__scopeId","data-v-2dd6e819"]]);const je={props:{content:{type:String,default:""}},setup(o){const e=o.content.match(/\[bilibili ((av|bv|AV|BV)[a-zA-Z0-9]+)?( p.*?)?\]/),n=e[1],t=((e?e[3]:"")||"").slice(2),s=g(`https://player.bilibili.com/player.html?bvid=${n}${t?"?page="+t:""}`),i=g(`https://www.bilibili.com/video/${n}${t?"?p="+t:""}`),r=g(!0);return{playerSrc:s,webSiteSrc:i,loading:r,id:g(n)}}},Me=["href"],De=["src"];function Le(o,e,n,t,s,i){return u(),p("div",null,[_("p",null,[_("a",{class:"link",href:t.webSiteSrc,target:"_blank"},y(t.id),9,Me)]),_("iframe",{src:t.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:$(["bilibili-player",{loading:t.loading}]),onLoad:e[0]||(e[0]=r=>t.loading=!1)},null,42,De)])}const Be=f(je,[["render",Le],["__scopeId","data-v-81ebfb8f"]]);const Ae={props:{content:{type:String,default:""}},setup(o){const n=o.content.match(/\[youtube (.*?)\]/)[1],t=g(`https://www.youtube.com/embed/${n}`),s=g(`https://www.youtube.com/watch?v=${n}`),i=g(!0);return{playerSrc:t,webSiteSrc:s,loading:i,id:g(n)}}},Ee=["href"],Ve=["src"];function Re(o,e,n,t,s,i){return u(),p("div",null,[_("p",null,[_("a",{class:"link",href:t.webSiteSrc,target:"_blank"},y(t.id),9,Ee)]),_("iframe",{src:t.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:$(["youtube-player",{loading:t.loading}]),onLoad:e[0]||(e[0]=r=>t.loading=!1)},null,42,Ve)])}const Pe=f(Ae,[["render",Re],["__scopeId","data-v-c83eea6c"]]);function Ne(o){return te({url:`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/music/${o}.mp3`,responseType:"arraybuffer"}).then(e=>{const[n,t]=o.split("-");return H(()=>import("./vendor-a6581121.js").then(s=>s.i),["https://kooritea.moe/assets/vendor-a6581121.js","https://kooritea.moe/assets/highlightjs-4914df6f.js","https://kooritea.moe/assets/vendor-2bc9f95b.css"],import.meta.url).then(s=>{const i=s.default,a=new i(e).ID3V2.findLabel("APIC");return{picUrl:a?URL.createObjectURL(new Blob([a.content.pictureBuffer])):"",name:n,singer:t,id:o,getPlayUrl:async()=>URL.createObjectURL(new Blob([e],{type:"audio/mp3"}))}})})}const Ue={components:{LoadingIcon:F},props:{content:{type:String,default:""}},setup(o){const n=o.content.match(/\[music (.*?)\]/)[1],t=g({}),s=g(!0),i=g("");return(n.startsWith("private")?Ne(n.slice(8)):ne(n)).then(r=>{t.value=r}).catch(r=>{i.value=r.message}).finally(()=>{s.value=!1}),{loading:s,error:i,id:g(n),music:t}},methods:{onClick(){this.loading||this.error||this.music.getPlayUrl().then(o=>{window.open(o,"_blank")})}}},He={key:1,class:"error-msg"},Fe=["src"],Oe={class:"info"},ze=["title"],We=["title"];function Ke(o,e,n,t,s,i){const r=w("LoadingIcon");return u(),p("div",{class:"music-player-simple",onClick:e[0]||(e[0]=(...a)=>i.onClick&&i.onClick(...a))},[t.loading?(u(),V(r,{key:0})):t.error?(u(),p("div",He,y(t.error),1)):(u(),p(v,{key:2},[_("img",{class:"music-player-simple-pic",src:t.music.picUrl},null,8,Fe),_("div",Oe,[_("p",{class:"song-name",title:t.music.name}," 🎶"+y(t.music.name),9,ze),_("p",{class:"singer-name",title:t.music.singer},y(t.music.singer),9,We)])],64))])}const Ye=f(Ue,[["render",Ke],["__scopeId","data-v-4c1539b2"]]);const Ze={components:{LoadingIcon:F},props:{content:{type:String,default:""}},setup(o){const n=o.content.match(/\[emoji (.*?)\]/)[1],t=g(`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/emoji/${n}.png`),s=g(!0);return{id:g(n),loading:s,imageSrc:t}}},qe={class:"md-sticker"},Ge=["src","alt"];function Xe(o,e,n,t,s,i){const r=w("LoadingIcon");return u(),p("div",qe,[t.loading?(u(),V(r,{key:0,class:"loading"})):T("",!0),E(_("img",{class:$(["sticker-image",{"sticker-image-loading":t.loading}]),src:t.imageSrc,alt:t.id||o.src,onLoad:e[0]||(e[0]=a=>t.loading=!1),onDragstart:e[1]||(e[1]=I(()=>{},["prevent"]))},null,42,Ge),[[N,!t.loading]])])}const Je=f(Ze,[["render",Xe],["__scopeId","data-v-1901fc7e"]]),Qe={props:{hashtag:{type:String,default:""}},emits:["hashtag-click"],methods:{onClick(o){this.$emit("hashtag-click",{event:o,hashtag:this.hashtag.slice(1)})}}};function et(o,e,n,t,s,i){return u(),p("a",{href:"#",onClick:e[0]||(e[0]=(...r)=>i.onClick&&i.onClick(...r))},y(n.hashtag),1)}const tt=f(Qe,[["render",et]]);class M{constructor(e,n){this.x=e,this.y=n,this.key=String(Math.random())}}class P extends M{constructor(e,n){super(e,n),this.itemType="kabe"}}class A extends M{constructor(e,n){super(e,n),this.itemType="box"}}class nt extends M{constructor(e,n){super(e,n),this.itemType="target"}}class ot extends M{constructor(e,n){super(e,n),this.itemType="neko"}}class st{constructor(e){this.instance=[],this.neko=null,this.boxs=[],this.targets=[];for(let n=0;n<e.length;n++){const t=e[n],s=[];this.instance.push(s);for(let i=0;i<t.length;i++){const r=t[i];let a=null;for(const d of r.split(""))switch(d){case"k":{a=new P(i,n);break}case"x":{const c=new A(i,n);this.boxs.push(c),a=c;break}case"o":{this.targets.push(new nt(i,n));break}case"s":{const c=new ot(i,n);this.neko=c,a=c;break}}s.push(a)}}}getItem({x:e,y:n}){var t;return(t=this.instance[n])==null?void 0:t[e]}getDirectionCoordinate({x:e,y:n},t){switch(t){case"2":{n=n+1;break}case"4":{e=e-1;break}case"6":{e=e+1;break}case"8":{n=n-1;break}}return{x:e,y:n}}getNextItem({x:e,y:n},t){const s=this.getItem(this.getDirectionCoordinate({x:e,y:n},t));return s===void 0||s instanceof P?!1:s}moveItem({x:e,y:n},t){const s=this.getItem({x:e,y:n}),i=this.getDirectionCoordinate({x:e,y:n},t);s.x=i.x,s.y=i.y,this.instance[n][e]=null,this.instance[i.y][i.x]=s}}let rt=class{constructor(e){this.map=new st(e)}get neko(){return this.map.neko}operate(e){const n=this.map.getNextItem(this.neko,e);if(n===!1)return!1;if(n===null&&this.map.moveItem(this.neko,e),n instanceof A){if(this.map.getNextItem(n,e)!==null)return!1;this.map.moveItem(n,e)}}check(){return!this.map.targets.some(e=>!(this.map.getItem(e)instanceof A))}};const ct={components:{AsyncButtom:oe},props:{map:{type:String,default:()=>""}},setup(o){const e=g(null),n=g(50),t=g(!1),s=function(){let c=[];const l=[];for(const m of o.map.split(","))m==="n"?(l.push(c),c=[]):c.push(m);e.value=K(new rt(l)),t.value=!1};s();const i=function(c){c.preventDefault();const l={38:"8",104:"8",39:"6",102:"6",37:"4",100:"4",40:"2",98:"2"}[String(c.keyCode)];e.value.operate(l),t.value=e.value.check()},r=function(c,l){const m=e.value.neko;c-m.x===0&&l-m.y===1&&e.value.operate("2"),c-m.x===0&&l-m.y===-1&&e.value.operate("8"),c-m.x===1&&l-m.y===0&&e.value.operate("6"),c-m.x===-1&&l-m.y===0&&e.value.operate("4"),t.value=e.value.check()},a=C(()=>{var c,l;return((l=(c=e.value)==null?void 0:c.map)==null?void 0:l.targets)||[]}),d=function(c,l){return a.value.some(m=>m.x===c&&m.y===l)};return{mapInstance:C(()=>{var c,l;return((l=(c=e.value)==null?void 0:c.map)==null?void 0:l.instance)||[]}),isTarget:d,size:n,reset:s,congratulations:t,keyupHandler:i,touchMove:r}}},it=o=>(Y("data-v-3a079840"),o=o(),Z(),o),at={class:"sokoban-box"},lt=["onClick"],ut={key:0,class:"congratulations"},dt=it(()=>_("div",{class:"mask"}," 点击开始 ",-1)),pt={class:"buttons"};function _t(o,e,n,t,s,i){const r=w("AsyncButtom");return u(),p("div",at,[_("div",{class:"sokoban",tabIndex:"-1",onKeydown:e[0]||(e[0]=I(a=>{a.preventDefault()},["stop"])),onKeypress:e[1]||(e[1]=I(a=>{a.preventDefault()},["stop"])),onKeyup:e[2]||(e[2]=I((...a)=>t.keyupHandler&&t.keyupHandler(...a),["stop"]))},[(u(!0),p(v,null,B(t.mapInstance,(a,d)=>(u(),p("div",{key:d,class:"row"},[(u(!0),p(v,null,B(a,(c,l)=>(u(),p("div",{key:(c==null?void 0:c.key)||l+d,class:$(["col",{[(c==null?void 0:c.itemType)||"empty"]:!0,target:t.isTarget(l,d)}]),style:z({width:`${t.size}px`,height:`${t.size}px`}),onClick:()=>{t.touchMove(l,d)}},[(c==null?void 0:c.itemType)==="neko"?(u(),p(v,{key:0},[L(" 😾 ")],64)):(c==null?void 0:c.itemType)==="box"?(u(),p(v,{key:1},[L(" 📦 ")],64)):T("",!0)],14,lt))),128))]))),128)),t.congratulations?(u(),p("div",ut," 通关 ")):T("",!0),dt],32),_("div",pt,[j(r,{type:"primary",onLoadingClick:t.reset},{default:W(()=>[L(" 重置 ")]),_:1},8,["onLoadingClick"])])])}const mt=f(ct,[["render",_t],["__scopeId","data-v-3a079840"]]),gt={components:{Sokoban:mt},props:{content:{type:Array,default:()=>[]}}},ht={key:1};function ft(o,e,n,t,s,i){const r=w("Sokoban");return u(),p("div",null,[n.content[0]==="sokoban"?(u(),V(r,{key:0,map:n.content[1]},null,8,["map"])):(u(),p("span",ht,"[component "+y(n.content)+" not found]",1))])}const yt=f(gt,[["render",ft]]);function D(o,e){return function(n){const{tokens:t}=n;for(const s of t){if(s.type!=="inline")continue;const i=[],r=[];for(const a of s.children){if(a.type.endsWith("_open")){const d=a.type.slice(0,a.type.indexOf("_open"));r.push(d)}if(a.type.endsWith("_close")&&r.pop(),a.type==="text"&&o.test(a.content)){const d=a.content;let c=0;if(d.replace(new RegExp(o,"g"),function(...l){const[m]=l,k=e(m,r);if(k!==!1){const b=l[l.length-2];if(b>c){const R=new x("text","",0);R.content=d.slice(c,b),i.push(R)}c=b+m.length,i.push(k)}}),c<d.length){const l=new x("text","",0);l.content=d.slice(c),i.push(l)}}else i.push(a)}s.children=i}}}function kt(o){return D(/(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/,n=>{const t=new x("emoji","",0);return t.markup=n,t.content=n,t})}function bt(o,e){o.core.ruler.after("linkify","emoji",kt())}function vt(o){const e=/\[((music)|(youtube)|(bilibili)|(emoji)|(video)) (.*?)\]/;return D(e,n=>{const t=n.match(e),s=new x("media","",0);return s.markup=n,s.content=n,s.block=!0,s.info=t[1],s})}function wt(o,e){o.core.ruler.after("text_join","media",vt())}function xt(o){return D(/#(\S*)/,(n,t)=>{if(t[t.length-1]==="link")return!1;const s=new x("hashtag","",0);return s.markup=n,s.content=n,s})}function It(o,e){o.core.ruler.after("linkify","hashtag",xt())}function $t(o){const e=/\[component (.*?) (.*?)\]/;return D(e,n=>{const t=n.match(e),s=new x("component","",0);return s.markup=n,s.content=n,s.block=!0,s.info=t.slice(1),s})}function St(o,e){o.core.ruler.after("text_join","component",$t())}const S=new q({breaks:!0});S.use(bt);S.use(wt);S.use(It);S.use(St);const Ct={props:{modelValue:{type:String,default:()=>""}},emits:["hashtag-click"],setup(o,e){const n=function(i){const r=[],a=[];for(let d=0;d<i.length;d++){const c=i[d];if(c.type.endsWith("_open")){const l=c.type.slice(0,c.type.indexOf("_open"));a.push({type:l,tag:c.tag,block:c.block,content:"",attrs:c.attrs,children:[]});continue}if(c.type.endsWith("_close")){if(a.length>1){const l=a.pop();a[a.length-1].children.push(l)}else r.push(a.pop());continue}if(a.length>0){const l=a[a.length-1];l.content=c.content,c.type==="inline"?l.children.push(...n(c.children)):l.children.push(c)}else r.push(c)}return r},t=function(i){return i.map(r=>{var d,c;const a=((d=r.attrs)==null?void 0:d.reduce((l,m)=>{const[k,b]=m;return l[k]?Array.isArray(l[k])?l[k].push(b):l[k]=[l[k],b]:l[k]=b,l},{}))||{};switch(r.type){case"text":return r.content;case"emoji":return h(Te,{...a,emoji:r.content,key:r.content},"");case"hashtag":return h(e.slots.hashtag??tt,{...a,hashtag:r.content,key:r.content,onHashtagClick:l=>{e.emit("hashtag-click",l)}},"");case"media":{switch(r.info){case"bilibili":return h(Be,{...a,content:r.content,key:r.content},"");case"youtube":return h(Pe,{...a,content:r.content,key:r.content},"");case"music":return h(Ye,{...a,content:r.content,key:r.content},"");case"emoji":return h(Je,{...a,content:r.content,key:r.content},"");case"video":return h(pe,{...a,content:r.content,key:r.content},"")}break}case"link":return h(r.tag,{...a,target:"_blank"},t(r.children));case"image":return h(ie,{src:a.src,alt:r.content,key:r.content},"");case"fence":return h(be,{...a,lang:r.info||"text",content:r.content,key:r.content},"");case"component":return h(yt,{...a,content:r.info,key:r.content},"");default:return h(r.tag||"span",a,((c=r.children)==null?void 0:c.length)>0?t(r.children):r.content)}})},s=G(o,"modelValue");return()=>{const i=n(S.parse(s.value,{}));return h("div",{class:"markdown-body"},t(i))}}},Lt=f(Ct,[["__scopeId","data-v-7c5dcb4f"]]);export{Lt as M};
