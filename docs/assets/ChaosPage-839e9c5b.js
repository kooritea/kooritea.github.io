import{_ as M,S as b,u as S,a as E,e as w,L as I,f as P,s as O,b as L,c as K,h as V}from"./index-b8f81596.js";import{P as W}from"./PageHeader-96d21acd.js";import{N as H}from"./NextButton-5d1a965d.js";import{M as U}from"./MarkDown-dcb64ae6.js";import{aY as f,ch as l,aP as a,aQ as c,bg as j,bv as k,bp as B,br as C,aR as p,bt as x,bx as g,bs as h,cA as T,bB as A,bq as G,bT as R}from"./vendor-3ff22302.js";import{a as q}from"./element-plus-659ac695.js";import{g as z,u as F,a as Q}from"./GreatOldOne-3554bc83.js";import"./highlightjs-4914df6f.js";import"./ImageCon-bfacf5ca.js";const Y={components:{SvgIcon:b},setup(){return{isSimplifty:f(!1)}},mounted(){this.$el.offsetHeight>600&&(this.isSimplifty=!0)}},J={key:0,class:"simplifty-mask"};function X(e,t,n,o,m,r){const u=l("SvgIcon");return a(),c("div",{class:C(["simplifty-box",{"is-simplifty":o.isSimplifty}])},[j(e.$slots,"default",{},void 0,!0),o.isSimplifty?(a(),c("div",J,[k(u,{name:"zhankai",class:"expend-button",onClick:t[0]||(t[0]=y=>o.isSimplifty=!1)})])):B("",!0)],2)}const Z=M(Y,[["render",X],["__scopeId","data-v-8a787155"]]);function N(e){const{darkMode:t}=S(),{darkModeDecodeKey:n}=E();return t.value&&e.hide?e.id?w(e.hide,n.value):e.hide:e.content}const $={components:{Markdown:U,SimpliftyBox:Z,LoadingIcon:I,"el-popover":q},props:{essay:{type:Object,required:!0},essayMap:{type:Object,required:!0},inPopover:{type:Boolean,default:!1}},emits:["set-search-key-word","load-essay-by-id"],setup(){const{darkMode:e}=S();return{darkMode:e,formatDate:P,Error}},methods:{getEssayContent:N}},ee={class:"essay"},se=["onClick"],te={class:"hashtag"},oe={key:0,class:"loading-box"},ne={key:1},ae={class:"info"},ie={class:"essay-id"};function re(e,t,n,o,m,r){const u=l("LoadingIcon"),y=l("ChaosItem",!0),v=l("el-popover"),_=l("Markdown"),d=l("SimpliftyBox");return a(),c("div",ee,[p("article",{class:C(["article",{"in-popover":n.inPopover}])},[k(d,null,{default:x(()=>[k(_,{"model-value":r.getEssayContent(n.essay)},{hashtag:x(({hashtag:s})=>[!/^#\d+$/.test(s)||n.inPopover?(a(),c("span",{key:0,class:"hashtag",onClick:i=>e.$emit("set-search-key-word",s)},g(s),9,se)):(a(),h(v,{key:1,width:"",trigger:"click","popper-class":"popper-essay",effect:o.darkMode?"dark":"light",onShow:()=>{n.essayMap[s.slice(1)]||e.$emit("load-essay-by-id",s.slice(1))}},{reference:x(()=>[p("span",te,g(s),1)]),default:x(()=>[!n.essayMap[s.slice(1)]||n.essayMap[s.slice(1)]instanceof o.Error?(a(),c("div",oe,[n.essayMap[s.slice(1)]?(a(),c("span",ne,g(n.essayMap[s.slice(1)].message),1)):(a(),h(u,{key:0}))])):(a(),h(y,{key:1,essay:n.essayMap[s.slice(1)],"essay-map":n.essayMap,"in-popover":!0,onSetSearchKeyWord:t[0]||(t[0]=i=>{e.$emit("set-search-key-word",i)})},null,8,["essay","essay-map"]))]),_:2},1032,["effect","onShow"]))]),_:1},8,["model-value"])]),_:1})],2),p("div",ae,[p("span",ie,"#"+g(n.essay.id||"预约中"),1),p("span",null,g(o.formatDate(n.essay.time,`yyyy-MM-dd HH:mm:ss UTC ${o.darkMode?"NDD":"DD"}`)),1)])])}const le=M($,[["render",re],["__scopeId","data-v-0d11384c"]]);const de={components:{ChaosItem:le,PageHeader:W,NextButton:H,SvgIcon:b,MDEditor:T({loader:()=>V(()=>import("./MDEditor-d7dd553e.js").then(e=>e.a),["https://kooritea.moe/assets/MDEditor-d7dd553e.js","https://kooritea.moe/assets/vendor-3ff22302.js","https://kooritea.moe/assets/highlightjs-4914df6f.js","https://kooritea.moe/assets/index-b8f81596.js","https://kooritea.moe/assets/element-plus-659ac695.js","https://kooritea.moe/assets/element-plus-4af7b3b2.css","https://kooritea.moe/assets/index-a8f6aae2.css","https://kooritea.moe/assets/MarkDown-dcb64ae6.js","https://kooritea.moe/assets/ImageCon-bfacf5ca.js","https://kooritea.moe/assets/ImageCon-7200ecbe.css","https://kooritea.moe/assets/MarkDown-729f0d46.css","https://kooritea.moe/assets/GreatOldOne-3554bc83.js","https://kooritea.moe/assets/MDEditor-da6b6d53.css"],import.meta.url),loadingComponent:I})},setup(){const e=f({}),{darkMode:t,isGreatOldOne:n}=S(),{offlineMode:o}=E(),m=f(""),r=A([]),u=f(!1),y=f(!1),v=f(null),_=d=>(y.value=!0,K(d).then(s=>{s=s.map(i=>(e.value[i.id]=i,{...i,expend:!1})),u.value=s.length===10,r.push(...s)}).finally(()=>{y.value=!1}));return _(),n.value&&z().then(d=>{d=d.sort((s,i)=>new Date(s.time).valueOf()-new Date(i.time).valueOf());for(const s of d)r.unshift(s)}),{loading:y,searchBlogEssays:_,essays:r,searchKeyWord:m,offlineMode:o,hasNext:u,darkMode:t,essayMap:e,setScorllGotoTop:O,isGreatOldOne:n,editing:v}},methods:{getEssayContent:N,search(e){if(this.essays.splice(0,this.essays.length),this.offlineMode&&e&&!/^#\d+$/.test(e)){this.$msgBox.error("离线模式下仅可以使用id搜索");return}return this.searchBlogEssays({keyword:e})},onNext(){var t;const e=(t=this.essays[this.essays.length-1])==null?void 0:t.id;return this.searchBlogEssays({keyword:this.searchKeyWord,start:e?e-1:void 0})},loadEssayById(e){if(this.essayMap[e]!==null)return this.essayMap[e]=null,L({id:e}).then(t=>{this.essayMap[e]=t}).catch(t=>{this.essayMap[e]=new Error(t)})},onSubmitUpdateEssay(e,t,n,o){if(e.id)return F(e.id,{content:t?void 0:n,hide:t?n:void 0}).then(m=>{Object.assign(e,m),this.editing=null});if(e.uuid)return Q(e.uuid,{content:t?void 0:n,hide:t?n:void 0,time:o}).then(m=>{Object.assign(e,m),this.editing=null})}}},ce={class:"page"};function me(e,t,n,o,m,r){const u=l("PageHeader"),y=l("ChaosItem"),v=l("MDEditor"),_=l("SvgIcon"),d=l("NextButton");return a(),c("div",ce,[k(u,{modelValue:o.searchKeyWord,"onUpdate:modelValue":t[0]||(t[0]=s=>o.searchKeyWord=s),"show-search-input":!0,"on-input":r.search},null,8,["modelValue","on-input"]),p("ul",null,[(a(!0),c(G,null,R(o.essays,s=>(a(),c("li",{key:s.id,class:"essay-box"},[o.editing!==s?(a(),h(y,{key:0,essay:s,"essay-map":o.essayMap,onSetSearchKeyWord:t[1]||(t[1]=i=>{o.searchKeyWord=i,o.setScorllGotoTop()}),onLoadEssayById:r.loadEssayById},null,8,["essay","essay-map","onLoadEssayById"])):(a(),h(v,{key:1,"model-value":r.getEssayContent(s),cache:!1,"ex-handlers":[{name:"取消",handler:()=>{o.editing=null}}],"on-submit":(i,D)=>r.onSubmitUpdateEssay(s,o.darkMode,i,D)},null,8,["model-value","ex-handlers","on-submit"])),o.isGreatOldOne&&o.editing!==s?(a(),h(_,{key:2,name:"bianji",onClick:i=>o.editing=s},null,8,["onClick"])):B("",!0)]))),128))]),k(d,{hasNext:o.hasNext,"onUpdate:hasNext":t[2]||(t[2]=s=>o.hasNext=s),loading:o.loading,"onUpdate:loading":t[3]||(t[3]=s=>o.loading=s),"on-click":r.onNext},null,8,["hasNext","loading","on-click"])])}const xe=M(de,[["render",me],["__scopeId","data-v-fe178ba9"]]);export{xe as default};
