import{P as $}from"./PageHeader-4a3be313.js";import{b8 as C,cg as f,cB as A,aR as s,aS as c,by as S,aT as d,bD as L,bC as m,bw as b,bA as p,bx as E,bB as w,bI as D,b0 as O,a_ as y,b_ as v,bs as B,bR as k}from"./vendor-cce75f21.js";import{_ as V,l as N,A as P,m as U,n as K,u as W,o as x,p as j,q as G}from"./index-10604cd2.js";import{I as H}from"./ImageCon-06f48c48.js";import"./highlightjs-4914df6f.js";import"./element-plus-f8e054a6.js";const M={components:{ImageCon:H,AsyncSwitch:N,AsyncButtom:P},directives:{mask:U},props:{bangumi:{type:Object,required:!0}},setup(r,{emit:i}){const{computedBangumi:_}=K(r,i),{mobileMode:e,isGreatOldOne:g}=W(),u=C(!1);return{cancel:()=>{e.value&&!u.value&&(_.value=null)},computedBangumi:_,isGreatOldOne:g,globalLoading:u}},methods:{onSwitchBangumiState(r,i){return x(r.id,{state:i})},onUpdateBangumiInfo(r){return j(r.subject).then(i=>{const _={...r,...i};return delete _.deletedAt,delete _.id,x(r.id,_).then(e=>{Object.assign(r,e)})})}}},R={class:"bangumi-viewer-container"},q={class:"preview"},F={class:"name"},T={class:"nname"},z={class:"switch-time-episode"},Y={class:"time-episode"},J={key:0};function Q(r,i,_,e,g,u){const a=f("ImageCon"),l=f("AsyncSwitch"),n=f("AsyncButtom"),t=A("mask");return s(),c("div",{class:"bangumi-viewer",onClick:i[2]||(i[2]=(...o)=>e.cancel&&e.cancel(...o))},[S((s(),c("div",R,[d("div",q,[L(a,{src:e.computedBangumi.img,prefix:["https://lain.bgm.tv/pic/cover/l"]},null,8,["src","prefix"])]),d("div",F,m(e.computedBangumi.name),1),d("div",T,m(e.computedBangumi.nname),1),d("div",z,[e.isGreatOldOne?(s(),b(l,{key:0,modelValue:e.computedBangumi.state,"onUpdate:modelValue":i[0]||(i[0]=o=>e.computedBangumi.state=o),loading:e.globalLoading,"onUpdate:loading":i[1]||(i[1]=o=>e.globalLoading=o),onLoadingClick:o=>u.onSwitchBangumiState(e.computedBangumi,o)},null,8,["modelValue","loading","onLoadingClick"])):p("",!0),e.isGreatOldOne?(s(),b(n,{key:1,type:"primary",onLoadingClick:()=>u.onUpdateBangumiInfo(e.computedBangumi)},{default:E(()=>[w(" 更新信息 ")]),_:1},8,["onLoadingClick"])):p("",!0),d("span",Y,[e.computedBangumi.episode?(s(),c("span",J," ("+m(e.computedBangumi.episode)+"话) ",1)):p("",!0),w(" "+m(e.computedBangumi.time),1)])])])),[[t,!0]])])}const X=V(M,[["render",Q],["__scopeId","data-v-19bdefce"]]);const Z={components:{PageHeader:$,BangumiViewer:X},setup(){const r=C(""),i=D([]),_=C(null),e=D({notExistDate:[],year:[]});e.notExistDate.open=!1,G().then(u=>{const a={};for(const l of u)if(!l.time)e.notExistDate.push(l);else{const n=new Date(l.time),t=n.getFullYear(),o=n.getMonth()+1;a[t]||(a[t]=[],a[t].year=t,a[t].open=!1,a[t].total=0,a[t].complete=0,e.year.push(a[t])),a[`${t}-${o}`]||(a[`${t}-${o}`]=[],a[`${t}-${o}`].month=`${t}-${o}`,a[`${t}-${o}`].monthNum=o,a[`${t}-${o}`].open=!1,a[`${t}-${o}`].total=0,a[`${t}-${o}`].complete=0,a[t].push(a[`${t}-${o}`])),a[t].total++,a[`${t}-${o}`].total++,l.state&&(a[t].complete++,a[`${t}-${o}`].complete++),a[`${t}-${o}`].push(l)}e.year=e.year.sort((l,n)=>n.year-l.year);for(const l in e.year){e.year[l]=e.year[l].sort((n,t)=>n.monthNum-t.monthNum);for(const n in e.year[l])Array.isArray(e.year[l][n])&&(e.year[l][n]=e.year[l][n].sort((t,o)=>new Date(t.time)-new Date(o.time)))}i.value=u});const g=O(()=>r.value?i.value.filter(u=>{var a,l,n,t,o,h;return((n=(a=u.name)==null?void 0:a.toLowerCase())==null?void 0:n.includes((l=r.value)==null?void 0:l.toLowerCase()))||((h=(t=u.nname)==null?void 0:t.toLowerCase())==null?void 0:h.includes((o=r.value)==null?void 0:o.toLowerCase()))}):[]);return{selectedBangumi:_,bangumiDateList:e,bangumiSearchList:g,searchKeyWord:r}},methods:{}},I={class:"page"},ee={class:"container"},te={key:0,class:"list"},ne={key:0},oe=["title","onClick"],ae=["onClick"],se={class:"item-info"},ie={key:0},le=["onClick"],ce={class:"item-info"},re={key:0},de=["title","onClick"],me={key:1,class:"list search-list"},ue=["title","onClick"];function _e(r,i,_,e,g,u){const a=f("PageHeader"),l=f("BangumiViewer");return s(),c("div",I,[L(a,{modelValue:e.searchKeyWord,"onUpdate:modelValue":i[0]||(i[0]=n=>e.searchKeyWord=n),"show-search-input":!0},null,8,["modelValue"]),d("div",ee,[e.searchKeyWord?(s(),c("div",me,[d("ul",null,[(s(!0),c(y,null,v(e.bangumiSearchList,n=>(s(),c("li",{key:n.id,class:B(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:t=>e.selectedBangumi=n},m(n.name),11,ue))),128))])])):(s(),c("div",te,[d("ul",null,[e.bangumiDateList.notExistDate.length>0?(s(),c("li",{key:0,class:"year-item",onClick:i[1]||(i[1]=n=>e.bangumiDateList.notExistDate.open=!e.bangumiDateList.notExistDate.open)},[w(" 放送时间未确认 "),e.bangumiDateList.notExistDate.open?(s(),c("ul",ne,[(s(!0),c(y,null,v(e.bangumiDateList.notExistDate,n=>(s(),c("li",{key:n.id,class:B(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:k(t=>e.selectedBangumi=n,["stop"])},m(n.name||n.nname),11,oe))),128))])):p("",!0)])):p("",!0),(s(!0),c(y,null,v(e.bangumiDateList.year,n=>(s(),c("li",{key:n.year,class:"year-item",onClick:t=>n.open=!n.open},[d("div",se,[d("span",null,m(n.year),1),d("span",null,m(n.complete)+"/"+m(n.total),1)]),n.open?(s(),c("ul",ie,[(s(!0),c(y,null,v(n,t=>(s(),c("li",{key:t.month,class:"month-item",onClick:k(o=>t.open=!t.open,["stop"])},[d("div",ce,[d("span",null,m(t.month),1),d("span",null,m(t.complete)+"/"+m(t.total),1)]),t.open?(s(),c("ul",re,[(s(!0),c(y,null,v(t,o=>(s(),c("li",{key:o.id,class:B(["bangumi-item",{complete:o.state}]),title:o.nname,onClick:k(h=>e.selectedBangumi=o,["stop"])},m(o.name||o.nname),11,de))),128))])):p("",!0)],8,le))),128))])):p("",!0)],8,ae))),128))])])),e.selectedBangumi?(s(),b(l,{key:2,bangumi:e.selectedBangumi,"onUpdate:bangumi":i[2]||(i[2]=n=>e.selectedBangumi=n)},null,8,["bangumi"])):p("",!0)])])}const Be=V(Z,[["render",_e],["__scopeId","data-v-b0672f9c"]]);export{Be as default};
