import{_ as D,B as E,L as N,A as S,a as L,n as M}from"./index-cae3c4a1.js";import{P as O}from"./PageHeader-db60d42b.js";import{g as z,h as H,e as T,f as R}from"./element-plus-61f8c1b5.js";import{i as j,j as x,k as Q}from"./GreatOldOne-bdd90959.js";import{b2 as y,bj as C,aW as k,aY as U,ch as s,aP as B,aQ as W,bo as n,bu as u,bv as V,bA as G,by as P,aR as I,bz as A}from"./vendor-b07f99b0.js";import"./highlightjs-4914df6f.js";const Y={components:{ButtonBox:E,LoadingIcon:N,AsyncButtom:S,PageHeader:O,ElTable:z,ElTableColumn:H,ElRadioGroup:T,ElRadio:R},setup(){const a=y("/"),l=y("kooritea.github.io"),b=C({}),t=C({}),i=k(()=>l.value==="kooritea.github.io"?b:t),p=y(!1),c=C([]),{devMode:_}=L(),o=k(()=>({repo:_.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),v=e=>{c.splice(0,c.length),c.push(...e)},m=k(()=>{const e=[...i.value[a.value]||[]];return!p.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),r=(e,d)=>{if(a.value=e,!i.value[e]||d)return i.value[e]=void 0,p.value=!0,j({...o.value,path:e}).then(f=>{f.type==="dir"&&(i.value[e]=[...f.children.filter(g=>g.type==="dir"),...f.children.filter(g=>g.type==="file")])}).finally(()=>{p.value=!1})};r("/"),U(l,()=>{r("/")});const h=e=>x({...o.value,files:e.map(d=>({isDel:!0,path:d.path}))}).then(()=>r(a.value,!0));return{onSelectionChange:v,repoConfig:o,tableData:m,loadPath:r,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>M({title:`[${o.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:d=>Q({...o.value,branch:void 0,file:e[0]}).then(({sha:f})=>x({...o.value,files:[{sha:f,path:d.inputValue}]}).then(()=>r(a.value,!0))),inputValidator:d=>!!d,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",disabled:()=>c.length===0,handler:()=>h(c)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in i.value)delete i.value[e];return r("/")}}],deleteItem:h,database:l}},methods:{onCellClick(a,l,b,t){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},q={class:"page"};function F(a,l,b,t,i,p){const c=s("PageHeader"),_=s("el-radio"),o=s("el-radio-group"),v=s("LoadingIcon"),m=s("el-table-column"),r=s("AsyncButtom"),h=s("el-table"),w=s("ButtonBox");return B(),W("div",q,[n(c),n(o,{modelValue:t.database,"onUpdate:modelValue":l[0]||(l[0]=e=>t.database=e)},{default:u(()=>[n(_,{label:"kooritea.github.io",size:"large"},{default:u(()=>[P(" 公开库 ")]),_:1}),n(_,{label:"private-database",size:"large"},{default:u(()=>[P(" 私有库 ")]),_:1})]),_:1},8,["modelValue"]),n(h,{border:"",data:t.tableData,style:{width:"100%"},onCellClick:p.onCellClick,onSelectionChange:t.onSelectionChange},{empty:u(()=>[I("div",null,[n(v)])]),default:u(()=>[n(m,{type:"selection",selectable:e=>e.type==="file"},null,8,["selectable"]),n(m,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{default:u(e=>[I("span",null,A(e.row.type==="dir"?"📁":"📄")+A(e.row.name),1)]),_:1}),n(m,{label:"操作",width:"120px"},{default:u(e=>[e.row.type==="file"?(B(),V(r,{key:0,type:"danger",size:"mini","on-click":()=>t.deleteItem([e.row])},{default:u(()=>[P(" 删除 ")]),_:2},1032,["on-click"])):G("",!0)]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),t.handlers.length>0?(B(),V(w,{key:0,handlers:t.handlers},null,8,["handlers"])):G("",!0)])}const ae=D(Y,[["render",F],["__scopeId","data-v-5d544f36"]]);export{ae as default};
