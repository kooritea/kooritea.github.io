import{_ as R,S as P,as as F,r as H,p as L,aq as O,al as M,y as q,z as N,q as W,c as j,b as B,d as f,e as D,h as d,t as S,B as E,g as A,n as z,v as T,at as G,x as K,f as $,F as J,au as Q}from"./index-8a906519.js";import{M as X}from"./MarkDown-1782fa00.js";import{b as Y}from"./GreatOldOne-92bb74d0.js";import"./ImageCon-c10fd61c.js";const I={},Z={components:{SvgIcon:P,Markdown:X,ButtonBox:F},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(l,{emit:s}){const v=H(!0),{computedModelValue:e}=L(l,s),g=H(!1),x=H(null);if(l.cache){const t=O();if(I[t.fullPath]&&l.cache===!0)M.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const o="MDEditorCache."+(l.cache===!0?t.fullPath:`${t.fullPath}.${l.cache}`);e.value=localStorage.getItem(o);let n=null;q(()=>{I[o]=!0,n=setInterval(()=>{g.value=!0,localStorage.setItem(o,e.value||"")},1e3)}),N(()=>{I[o]=!1,clearInterval(n)}),W(e,()=>{g.value=!1})}}const i=H(e.value),w=()=>{const t=l.onSubmit(e.value);return t instanceof Promise?t.then(()=>{e.value="",i.value=""}):(e.value="",i.value=""),t},p=()=>{e.value=""},r=()=>{e.value=i.value},U=[{name:"提交",type:"primary",handler:w,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("submit"):l.showDefaultHandlers},{name:"清除",type:"danger",handler:p,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("clean"):l.showDefaultHandlers},{name:"重置",type:"default",handler:r,show:()=>(Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reset"):l.showDefaultHandlers)&&!!i.value}],V=j(()=>[...U,...l.exHandlers]),y=t=>{const o=Q(URL.createObjectURL(t),{handlers:[{name:"上传",type:"primary",handler:()=>{const n=x.value.selectionStart,c=new Date().valueOf().toString(),a=e.value.slice(0,n),u=e.value.slice(n);e.value=`${a}![${c}](--------------------)${u}`,Y(t,h=>{const m=Math.round(100*event.loaded/event.total)/10*2;e.value=e.value.replace(new RegExp(`\\!\\[${c}]\\((#*?)(-*?)\\)`),`![${c}](${"#".repeat(m)}${"-".repeat(20-m)})`)}).then(h=>{e.value=e.value.replace(new RegExp(`\\!\\[${c}]\\((#*?)(-*?)\\)`),`![${h.keyname}](${h.local})`)}).catch(()=>{e.value=e.value.replace(new RegExp(`\\!\\[${c}]\\((#*?)(-*?)\\)`),"")}),o.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{const n=document.createElement("canvas"),c=n.getContext("2d"),a=new Image;a.onload=async()=>{if(a.height*16===a.width*9)return;const u=a.height*16/9;if(u>a.width){const b=.5625*a.width;n.width=a.width,n.height=b,c.drawImage(a,0,(a.height-b)/2,a.width,b,0,0,a.width,b)}else n.width=u,n.height=a.height,c.drawImage(a,(a.width-u)/2,0,u,a.height,0,0,u,a.height);const h=n.toDataURL(t.type).split(","),C=h[0].match(/:(.*?);/)[1],m=atob(h[1]);let _=m.length;const k=new Uint8Array(_);for(;_--;)k[_]=m.charCodeAt(_);o.callClose(),y(new File([k],t.name,{type:C}))},a.src=URL.createObjectURL(t)}},{name:"取消",type:"default",handler:()=>{o.callClose()}}]})};return{isEditMode:v,computedModelValue:e,resetCache:i,isSave:g,handlers:V,submitHandler:w,cleanHandler:p,resetHandler:r,previewImageBeforeUpload:y,pasteHandler:t=>{if(!(t.clipboardData&&t.clipboardData.items))return;const o=Array.from(t.clipboardData.items).filter(n=>n.kind==="file");if(o.length>0){t.preventDefault();for(const n of o)if(n.type.startsWith("image/")){y(n.getAsFile());return}else M.warning(`不支持的文件类型: ${n.type}`)}},dropHandler:t=>{for(const o of t.dataTransfer.files)if(t.preventDefault(),o.type.startsWith("image/")){y(o);return}else M.warning(`不支持的文件类型: ${o.type}`)},textarea:x}}},ee={class:"md-editor"},te={class:"bar"},ae={class:"bar-left"},ne={class:"title"},le={class:"uploader"},oe={class:"bar-right"},se={key:0,class:"is-save info"},re={class:"fill"},de={key:1,class:"preview"};function ie(l,s,v,e,g,x){const i=B("SvgIcon"),w=B("Markdown"),p=B("ButtonBox");return f(),D(J,null,[d("div",ee,[d("div",te,[d("div",ae,[d("div",ne,S(v.title),1),d("label",le,[E(i,{class:"button",name:"icon-14"}),d("input",{type:"file",accept:"image/*",onChange:s[0]||(s[0]=r=>{e.previewImageBeforeUpload(r.srcElement.files[0]),r.srcElement.value=""})},null,32)]),E(i,{class:"button",name:"icon-biaoqing"})]),d("div",oe,[e.isSave?(f(),D("span",se,"已保存")):A("",!0),d("span",{class:"preview-switch button",onClick:s[1]||(s[1]=r=>e.isEditMode=!e.isEditMode)},S(e.isEditMode?"预览":"返回编辑"),1)])]),e.isEditMode?(f(),D("div",{key:0,class:z(["textarea-box",{"auto-height":v.autoHeight}])},[d("pre",re,S(e.computedModelValue),1),T(d("textarea",{ref:"textarea","onUpdate:modelValue":s[2]||(s[2]=r=>e.computedModelValue=r),class:"textarea",onPaste:s[3]||(s[3]=(...r)=>e.pasteHandler&&e.pasteHandler(...r)),onDragover:s[4]||(s[4]=K(()=>{},["prevent"])),onDrop:s[5]||(s[5]=(...r)=>e.dropHandler&&e.dropHandler(...r))},null,544),[[G,e.computedModelValue]])],2)):(f(),D("div",de,[E(w,{"model-value":e.computedModelValue},null,8,["model-value"])]))]),e.handlers.length>0?(f(),$(p,{key:0,handlers:e.handlers},null,8,["handlers"])):A("",!0)],64)}const ge=R(Z,[["render",ie],["__scopeId","data-v-5dbc00db"]]);export{ge as default};
