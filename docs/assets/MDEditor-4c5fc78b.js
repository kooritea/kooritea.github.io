import{bH as L,b7 as k,cf as S,aQ as h,aR as y,aS as m,aZ as $,bZ as O,bv as E,bw as A,bB as I,br as F,be as Z,c_ as q,b3 as G,bd as K,b1 as J,a$ as X,bx as Y,ck as ee,bQ as te,bC as x,bz as T}from"./vendor-23d2f8cc.js";import{_ as z,S as N,a as ae,ae as ne,af as oe,x as W,ag as le,M as V,B as se,u as re,n as ce,ah as ie,ai as de}from"./index-6dfeff5e.js";import{M as ue}from"./MarkDown-0f09752a.js";import{I as me}from"./ImageCon-7fd1f245.js";import{j as he,b as fe}from"./element-plus-88343e01.js";const ve={components:{SvgIcon:N,ImageCon:me},props:{init:{type:Boolean,default:!0}},emits:["select"],setup(a,{emit:l}){const{emoteHistory:d}=ae(),e=L({name:"history",emote:d.value}),t=L([]),v=k("history"),g=r=>{if(v.value=r.name,r.emote.length===0)return ne(r.name).then(c=>{v.value=r.name,r.emote=c.emote.map(H=>({...H,scope:r.name}))})},f=()=>{t.splice(0,t.length),t.push(e),oe().then(r=>{t.push(...r.sort((c,H)=>{const M=d.value.findIndex(D=>D.scope===c.name),b=d.value.findIndex(D=>D.scope===H.name);return(M===-1?1/0:M)-(b===-1?1/0:b)})),t.push({name:"add",emote:[]})})};return f(),{onSelect:r=>{l("select",r),d.value=d.value.filter(c=>!(c.scope===r.scope&&c.name===r.name)),d.value=[r,...d.value].slice(0,30),e.emote=d.value},addEmotePackage:()=>{W({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:r=>le(r.inputValue).then(()=>{V.success("添加成功"),f()}),inputValidator:r=>/^\d+$/.test(r),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:v,emotePackages:t,selectScope:g}}},ge={class:"emote-selector"},pe={class:"emotes"},_e={class:"scopes"},ye=["onClick"];function we(a,l,d,e,t,v){const g=S("ImageCon"),f=S("SvgIcon");return h(),y("div",ge,[m("div",pe,[(h(!0),y($,null,O((e.emotePackages.find(n=>n.name===e.currentScope)||{}).emote||[],n=>(h(),E(g,{key:n.name,class:"emote",alt:n.name,src:`/kooritea/kooritea.github.io/emoji/${n.scope}/${n.name}.png`,onClick:w=>e.onSelect(n)},{error:A(()=>[m("span",null,I(n.name),1)]),_:2},1032,["alt","src","onClick"]))),128))]),m("div",_e,[(h(!0),y($,null,O(e.emotePackages,n=>(h(),y("div",{key:n.name,class:F(["scope",{"selected-scope":e.currentScope===n.name}]),onClick:()=>{n.name==="add"?e.addEmotePackage():e.selectScope(n)}},[n.name==="history"?(h(),E(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(h(),E(f,{key:1,class:"emote history",name:"add"})):(h(),E(g,{key:2,class:"emote",src:`/kooritea/kooritea.github.io/emoji/${n.name}/${n.name}.png`},{error:A(()=>[m("span",null,I(n.name),1)]),_:2},1032,["src"]))],10,ye))),128))])])}const be=z(ve,[["render",we],["__scopeId","data-v-aba84f95"]]);function Se(a){const l=k(null),d=Z(he,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:l.value,"onUpdate:modelValue":e=>{var t;l.value=e,(t=d.component)!=null&&t.props&&(d.component.props.modelValue=e)}});W({title:"选择预约时间",message:d,confirmHandlerPromise:e=>a(l),inputValidator:e=>!!l.value,inputErrorMessage:"请选择预约时间"})}const P={},ke={components:{SvgIcon:N,Markdown:ue,ButtonBox:se,EmoteSelector:be,ElPopover:fe},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(a,{emit:l}){const{darkMode:d}=re(),e=k(!0),{computedModelValue:t}=ce(a,l),v=k(!1),g=k(null);if(a.cache){const o=q();if(P[o.fullPath]&&a.cache===!0)V.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const i="MDEditorCache."+(a.cache===!0?o.fullPath:`${o.fullPath}.${a.cache}`);t.value=localStorage.getItem(i)||a.defaultValue;let s=null;G(()=>{P[i]=!0,s=setInterval(()=>{v.value=!0,localStorage.setItem(i,t.value||"")},1e3)}),K(()=>{P[i]=!1,clearInterval(s)}),J(t,()=>{v.value=!1})}}const f=o=>{const i=g.value.selectionStart,s=t.value.slice(0,i),p=t.value.slice(i);t.value=`${s}${o}${p}`},n=k(t.value),w=({reservationDate:o}={})=>{const i=a.onSubmit(t.value,o==null?void 0:o.value);return i instanceof Promise?i.then(()=>{t.value=a.defaultValue,n.value=a.defaultValue}):(t.value=a.defaultValue,n.value=a.defaultValue),i},r=()=>{t.value=""},c=()=>{t.value=n.value},H=[{name:"提交",type:"primary",handler:w,show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("submit"):a.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{Se(o=>{w({reservationDate:o})})},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reservation"):a.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:r,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("clean"):a.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:c,show:()=>(Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reset"):a.showDefaultHandlers)&&!!n.value,sort:30}],M=X(()=>[...H,...a.exHandlers]),b=o=>{const i=ie(URL.createObjectURL(o),{handlers:[{name:"上传",type:"primary",handler:()=>{const s=new Date().valueOf().toString();f(`![${s}](--------------------)`),de(o,p=>{const _=Math.round(100*event.loaded/event.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${s}]\\((#*?)(-*?)\\)`),`![${s}](${"#".repeat(_)}${"-".repeat(20-_)})`)}).then(p=>{t.value=t.value.replace(new RegExp(`\\!\\[${s}]\\((#*?)(-*?)\\)`),`![${p.keyname}](${p.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${s}]\\((#*?)(-*?)\\)`),"")}),i.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{const s=document.createElement("canvas"),p=s.getContext("2d"),u=new Image;u.onload=async()=>{if(u.height*16===u.width*9)return;const _=u.height*16/9;if(_>u.width){const C=.5625*u.width;s.width=u.width,s.height=C,p.drawImage(u,0,(u.height-C)/2,u.width,C,0,0,u.width,C)}else s.width=_,s.height=u.height,p.drawImage(u,(u.width-_)/2,0,_,u.height,0,0,_,u.height);const U=s.toDataURL(o.type).split(","),Q=U[0].match(/:(.*?);/)[1],R=atob(U[1]);let B=R.length;const j=new Uint8Array(B);for(;B--;)j[B]=R.charCodeAt(B);i.callClose(),b(new File([j],o.name,{type:Q}))},u.src=URL.createObjectURL(o)}},{name:"取消",type:"default",handler:()=>{i.callClose()}}]})};return{darkMode:d,isEditMode:e,computedModelValue:t,resetCache:n,isSave:v,handlers:M,submitHandler:w,cleanHandler:r,resetHandler:c,previewImageBeforeUpload:b,pasteHandler:o=>{if(!(o.clipboardData&&o.clipboardData.items))return;const i=Array.from(o.clipboardData.items).filter(s=>s.kind==="file");if(i.length>0){o.preventDefault();for(const s of i)if(s.type.startsWith("image/")){b(s.getAsFile());return}else V.warning(`不支持的文件类型: ${s.type}`)}},dropHandler:o=>{for(const i of o.dataTransfer.files)if(o.preventDefault(),i.type.startsWith("image/")){b(i);return}else V.warning(`不支持的文件类型: ${i.type}`)},textarea:g,insertText:f}}},He={class:"md-editor"},xe={class:"fill"},Ee={key:1,class:"preview"},Ie={class:"bar"},Me={class:"bar-left"},De={class:"title"},Be={class:"uploader"},Ce={class:"bar-right"},Ve={key:0,class:"is-save info"};function Ae(a,l,d,e,t,v){const g=S("Markdown"),f=S("SvgIcon"),n=S("EmoteSelector"),w=S("el-popover"),r=S("ButtonBox");return h(),y($,null,[m("div",He,[e.isEditMode?(h(),y("div",{key:0,class:F(["textarea-box",{"auto-height":d.autoHeight}])},[m("pre",xe,I(e.computedModelValue),1),Y(m("textarea",{ref:"textarea","onUpdate:modelValue":l[0]||(l[0]=c=>e.computedModelValue=c),class:"textarea",onPaste:l[1]||(l[1]=(...c)=>e.pasteHandler&&e.pasteHandler(...c)),onDragover:l[2]||(l[2]=te(()=>{},["prevent"])),onDrop:l[3]||(l[3]=(...c)=>e.dropHandler&&e.dropHandler(...c))},null,544),[[ee,e.computedModelValue]])],2)):(h(),y("div",Ee,[x(g,{"model-value":e.computedModelValue},null,8,["model-value"])])),m("div",Ie,[m("div",Me,[m("div",De,I(d.title),1),m("label",Be,[x(f,{class:"button",name:"14"}),m("input",{type:"file",accept:"image/*",onChange:l[4]||(l[4]=c=>{e.previewImageBeforeUpload(c.srcElement.files[0]),c.srcElement.value=""})},null,32)]),x(w,{width:"auto",trigger:"click",effect:e.darkMode?"dark":"light"},{reference:A(()=>[x(f,{class:"button",name:"biaoqing"})]),default:A(()=>[x(n,{onSelect:l[5]||(l[5]=c=>{e.insertText(`[emoji ${c.scope}/${c.name}]`)})})]),_:1},8,["effect"])]),m("div",Ce,[e.isSave?(h(),y("span",Ve,"已保存")):T("",!0),m("span",{class:"preview-switch button",onClick:l[6]||(l[6]=c=>e.isEditMode=!e.isEditMode)},I(e.isEditMode?"预览":"返回编辑"),1)])])]),e.handlers.length>0?(h(),E(r,{key:0,handlers:e.handlers},null,8,["handlers"])):T("",!0)],64)}const Pe=z(ke,[["render",Ae],["__scopeId","data-v-7ca63b31"]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{Pe as M,Te as a,Se as u};
