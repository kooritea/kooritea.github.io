import{P as L}from"./PageHeader-63338c97.js";import{b2 as k,ch as h,ci as $,aP as i,aQ as c,bF as A,aR as d,bo as C,bz as m,bv as b,bA as p,bu as S,by as D,bj as w,aW as E,bp as y,b_ as v,bl as f,bH as B}from"./vendor-b07f99b0.js";import{_ as V,i as O,A as P,m as N,j as U,u as j,k as W}from"./index-9ceaad3b.js";import{I as H}from"./ImageCon-c4830200.js";import{b as x,c as K}from"./GreatOldOne-5bd7a4e2.js";import"./highlightjs-4914df6f.js";import"./element-plus-61f8c1b5.js";const F={components:{ImageCon:H,AsyncSwitch:O,AsyncButtom:P},directives:{mask:N},props:{bangumi:{type:Object,required:!0}},setup(r,{emit:s}){const{computedBangumi:_}=U(r,s),{mobileMode:e,isGreatOldOne:g}=j(),u=k(!1);return{cancel:()=>{e.value&&!u.value&&(_.value=null)},computedBangumi:_,isGreatOldOne:g,globalLoading:u}},methods:{onSwitchBangumiState(r,s){return x(r.id,{state:s})},onUpdateBangumiInfo(r){return K(r.subject).then(s=>{const _={...r,...s};return delete _.deletedAt,delete _.id,x(r.id,_).then(e=>{Object.assign(r,e)})})}}},G={class:"bangumi-viewer-container"},M={class:"preview"},z={class:"name"},R={class:"nname"},q={class:"switch-time-episode"},Q={class:"time-episode"},T={key:0};function Y(r,s,_,e,g,u){const a=h("ImageCon"),l=h("AsyncSwitch"),n=h("AsyncButtom"),t=$("mask");return i(),c("div",{class:"bangumi-viewer",onClick:s[2]||(s[2]=(...o)=>e.cancel&&e.cancel(...o))},[A((i(),c("div",G,[d("div",M,[C(a,{src:e.computedBangumi.img,prefix:["https://lain.bgm.tv/pic/cover/l"]},null,8,["src","prefix"])]),d("div",z,m(e.computedBangumi.name),1),d("div",R,m(e.computedBangumi.nname),1),d("div",q,[e.isGreatOldOne?(i(),b(l,{key:0,modelValue:e.computedBangumi.state,"onUpdate:modelValue":s[0]||(s[0]=o=>e.computedBangumi.state=o),loading:e.globalLoading,"onUpdate:loading":s[1]||(s[1]=o=>e.globalLoading=o),"on-click":o=>u.onSwitchBangumiState(e.computedBangumi,o)},null,8,["modelValue","loading","on-click"])):p("",!0),e.isGreatOldOne?(i(),b(n,{key:1,type:"primary","on-click":()=>u.onUpdateBangumiInfo(e.computedBangumi)},{default:S(()=>[D(" 更新信息 ")]),_:1},8,["on-click"])):p("",!0),d("span",Q,[e.computedBangumi.episode?(i(),c("span",T," ("+m(e.computedBangumi.episode)+"话) ",1)):p("",!0),D(" "+m(e.computedBangumi.time),1)])])])),[[t,!0]])])}const J=V(F,[["render",Y],["__scopeId","data-v-15edc4a4"]]);const X={components:{PageHeader:L,BangumiViewer:J},setup(){const r=k(""),s=w([]),_=k(null),e=w({notExistDate:[],year:[]});e.notExistDate.open=!1,W().then(u=>{const a={};for(const l of u)if(!l.time)e.notExistDate.push(l);else{const n=new Date(l.time),t=n.getFullYear(),o=n.getMonth()+1;a[t]||(a[t]=[],a[t].year=t,a[t].open=!1,a[t].total=0,a[t].complete=0,e.year.push(a[t])),a[`${t}-${o}`]||(a[`${t}-${o}`]=[],a[`${t}-${o}`].month=`${t}-${o}`,a[`${t}-${o}`].monthNum=o,a[`${t}-${o}`].open=!1,a[`${t}-${o}`].total=0,a[`${t}-${o}`].complete=0,a[t].push(a[`${t}-${o}`])),a[t].total++,a[`${t}-${o}`].total++,l.state&&(a[t].complete++,a[`${t}-${o}`].complete++),a[`${t}-${o}`].push(l)}e.year=e.year.sort((l,n)=>n.year-l.year);for(const l in e.year){e.year[l]=e.year[l].sort((n,t)=>n.monthNum-t.monthNum);for(const n in e.year[l])Array.isArray(e.year[l][n])&&(e.year[l][n]=e.year[l][n].sort((t,o)=>new Date(t.time)-new Date(o.time)))}s.value=u});const g=E(()=>r.value?s.value.filter(u=>{var a,l;return((a=u.name)==null?void 0:a.includes(r.value))||((l=u.nname)==null?void 0:l.includes(r.value))}):[]);return{selectedBangumi:_,bangumiDateList:e,bangumiSearchList:g,searchKeyWord:r}},methods:{}},Z={class:"page"},I={class:"container"},ee={key:0,class:"list"},te={key:0},ne=["title"],oe=["onClick"],ae={class:"item-info"},se={key:0},ie=["onClick"],le={class:"item-info"},ce={key:0},re=["title","onClick"],de={key:1,class:"list search-list"},me=["title","onClick"];function ue(r,s,_,e,g,u){const a=h("PageHeader"),l=h("BangumiViewer");return i(),c("div",Z,[C(a,{modelValue:e.searchKeyWord,"onUpdate:modelValue":s[0]||(s[0]=n=>e.searchKeyWord=n),"show-search-input":!0},null,8,["modelValue"]),d("div",I,[e.searchKeyWord?(i(),c("div",de,[d("ul",null,[(i(!0),c(y,null,v(e.bangumiSearchList,n=>(i(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:t=>e.selectedBangumi=n},m(n.name),11,me))),128))])])):(i(),c("div",ee,[d("ul",null,[e.bangumiDateList.notExistDate.length>0?(i(),c("li",{key:0,class:"year-item",onClick:s[2]||(s[2]=n=>e.bangumiDateList.notExistDate.open=!e.bangumiDateList.notExistDate.open)},[D(" 放送时间未确认 "),e.bangumiDateList.notExistDate.open?(i(),c("ul",te,[(i(!0),c(y,null,v(e.bangumiDateList.notExistDate,n=>(i(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:s[1]||(s[1]=B(()=>{},["stop"]))},m(n.name),11,ne))),128))])):p("",!0)])):p("",!0),(i(!0),c(y,null,v(e.bangumiDateList.year,n=>(i(),c("li",{key:n.year,class:"year-item",onClick:t=>n.open=!n.open},[d("div",ae,[d("span",null,m(n.year),1),d("span",null,m(n.complete)+"/"+m(n.total),1)]),n.open?(i(),c("ul",se,[(i(!0),c(y,null,v(n,t=>(i(),c("li",{key:t.month,class:"month-item",onClick:B(o=>t.open=!t.open,["stop"])},[d("div",le,[d("span",null,m(t.month),1),d("span",null,m(t.complete)+"/"+m(t.total),1)]),t.open?(i(),c("ul",ce,[(i(!0),c(y,null,v(t,o=>(i(),c("li",{key:o.id,class:f(["bangumi-item",{complete:o.state}]),title:o.nname,onClick:B(_e=>e.selectedBangumi=o,["stop"])},m(o.name),11,re))),128))])):p("",!0)],8,ie))),128))])):p("",!0)],8,oe))),128))])])),e.selectedBangumi?(i(),b(l,{key:2,bangumi:e.selectedBangumi,"onUpdate:bangumi":s[3]||(s[3]=n=>e.selectedBangumi=n)},null,8,["bangumi"])):p("",!0)])])}const ke=V(X,[["render",ue],["__scopeId","data-v-8e7c6d1c"]]);export{ke as default};
