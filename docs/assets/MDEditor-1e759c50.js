import{r as _,aI as P,q as L,y as W,p as F,l as O,az as b,o as m,e as H,f as i,a0 as M,_ as x,U as A,W as N,S as T,aW as $,$ as j,X as q,V as z}from"./vendor-dfc99adc.js";import{_ as G,S as K,B as X,a as J,M as S,l as Q,I as Y}from"./index-4d518520.js";import{M as Z}from"./MarkDown-52a834cd.js";import{e as ee}from"./GreatOldOne-c94e437d.js";import"./highlightjs-b0208cd2.js";import"./element-plus-addd02c2.js";import"./ImageCon-9c4ff435.js";const B={},te={components:{SvgIcon:K,Markdown:Z,ButtonBox:X},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(o,{emit:r}){const f=_(!0),{computedModelValue:e}=J(o,r),v=_(!1),D=_(null);if(o.cache){const t=P();if(B[t.fullPath]&&o.cache===!0)S.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const n="MDEditorCache."+(o.cache===!0?t.fullPath:`${t.fullPath}.${o.cache}`);e.value=localStorage.getItem(n);let a=null;L(()=>{B[n]=!0,a=setInterval(()=>{v.value=!0,localStorage.setItem(n,e.value||"")},1e3)}),W(()=>{B[n]=!1,clearInterval(a)}),F(e,()=>{v.value=!1})}}const h=t=>{const n=D.value.selectionStart,a=e.value.slice(0,n),d=e.value.slice(n);e.value=`${a}${t}${d}`},u=_(e.value),g=()=>{const t=o.onSubmit(e.value);return t instanceof Promise?t.then(()=>{e.value="",u.value=""}):(e.value="",u.value=""),t},s=()=>Q({title:"提示",message:"确认清空内容?",type:"warning",confirmHandlerPromise:()=>{e.value=""}}),I=()=>{e.value=u.value},U=[{name:"提交",type:"primary",handler:g,show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("submit"):o.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:s,show:()=>Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("clean"):o.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:I,show:()=>(Array.isArray(o.showDefaultHandlers)?o.showDefaultHandlers.includes("reset"):o.showDefaultHandlers)&&!!u.value,sort:30}],V=O(()=>[...U,...o.exHandlers]),p=t=>{const n=Y(URL.createObjectURL(t),{handlers:[{name:"上传",type:"primary",handler:()=>{const a=new Date().valueOf().toString();h(`![${a}](--------------------)`),ee(t,d=>{const c=Math.round(100*event.loaded/event.total)/10*2;e.value=e.value.replace(new RegExp(`\\!\\[${a}]\\((#*?)(-*?)\\)`),`![${a}](${"#".repeat(c)}${"-".repeat(20-c)})`)}).then(d=>{e.value=e.value.replace(new RegExp(`\\!\\[${a}]\\((#*?)(-*?)\\)`),`![${d.keyname}](${d.local})`)}).catch(()=>{e.value=e.value.replace(new RegExp(`\\!\\[${a}]\\((#*?)(-*?)\\)`),"")}),n.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{const a=document.createElement("canvas"),d=a.getContext("2d"),l=new Image;l.onload=async()=>{if(l.height*16===l.width*9)return;const c=l.height*16/9;if(c>l.width){const y=.5625*l.width;a.width=l.width,a.height=y,d.drawImage(l,0,(l.height-y)/2,l.width,y,0,0,l.width,y)}else a.width=c,a.height=l.height,d.drawImage(l,(l.width-c)/2,0,c,l.height,0,0,c,l.height);const E=a.toDataURL(t.type).split(","),R=E[0].match(/:(.*?);/)[1],C=atob(E[1]);let w=C.length;const k=new Uint8Array(w);for(;w--;)k[w]=C.charCodeAt(w);n.callClose(),p(new File([k],t.name,{type:R}))},l.src=URL.createObjectURL(t)}},{name:"取消",type:"default",handler:()=>{n.callClose()}}]})};return{isEditMode:f,computedModelValue:e,resetCache:u,isSave:v,handlers:V,submitHandler:g,cleanHandler:s,resetHandler:I,previewImageBeforeUpload:p,pasteHandler:t=>{if(!(t.clipboardData&&t.clipboardData.items))return;const n=Array.from(t.clipboardData.items).filter(a=>a.kind==="file");if(n.length>0){t.preventDefault();for(const a of n)if(a.type.startsWith("image/")){p(a.getAsFile());return}else S.warning(`不支持的文件类型: ${a.type}`)}},dropHandler:t=>{for(const n of t.dataTransfer.files)if(t.preventDefault(),n.type.startsWith("image/")){p(n);return}else S.warning(`不支持的文件类型: ${n.type}`)},textarea:D,insertText:h}}},ae={class:"md-editor"},ne={class:"bar"},le={class:"bar-left"},oe={class:"title"},re={class:"uploader"},se={class:"bar-right"},ie={key:0,class:"is-save info"},de={class:"fill"},ce={key:1,class:"preview"};function ue(o,r,f,e,v,D){const h=b("SvgIcon"),u=b("Markdown"),g=b("ButtonBox");return m(),H(z,null,[i("div",ae,[i("div",ne,[i("div",le,[i("div",oe,M(f.title),1),i("label",re,[x(h,{class:"button",name:"icon-14"}),i("input",{type:"file",accept:"image/*",onChange:r[0]||(r[0]=s=>{e.previewImageBeforeUpload(s.srcElement.files[0]),s.srcElement.value=""})},null,32)]),x(h,{class:"button",name:"icon-biaoqing"})]),i("div",se,[e.isSave?(m(),H("span",ie,"已保存")):A("",!0),i("span",{class:"preview-switch button",onClick:r[1]||(r[1]=s=>e.isEditMode=!e.isEditMode)},M(e.isEditMode?"预览":"返回编辑"),1)])]),e.isEditMode?(m(),H("div",{key:0,class:N(["textarea-box",{"auto-height":f.autoHeight}])},[i("pre",de,M(e.computedModelValue),1),T(i("textarea",{ref:"textarea","onUpdate:modelValue":r[2]||(r[2]=s=>e.computedModelValue=s),class:"textarea",onPaste:r[3]||(r[3]=(...s)=>e.pasteHandler&&e.pasteHandler(...s)),onDragover:r[4]||(r[4]=j(()=>{},["prevent"])),onDrop:r[5]||(r[5]=(...s)=>e.dropHandler&&e.dropHandler(...s))},null,544),[[$,e.computedModelValue]])],2)):(m(),H("div",ce,[x(u,{"model-value":e.computedModelValue},null,8,["model-value"])]))]),e.handlers.length>0?(m(),q(g,{key:0,handlers:e.handlers},null,8,["handlers"])):A("",!0)],64)}const He=G(te,[["render",ue],["__scopeId","data-v-0b3b0ca8"]]);export{He as default};
