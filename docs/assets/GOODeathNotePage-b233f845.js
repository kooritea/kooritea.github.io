import{_ as E,B as H,L as A,A as N,a as O,E as T,x as B,F as I,G as M,H as R}from"./index-a0f9b44e.js";import{P as z}from"./PageHeader-74e99c1a.js";import{h as F,i as U,f as $,g as j}from"./element-plus-5d967f66.js";import{b8 as k,bI as x,b0 as w,b2 as q,cg as s,aR as b,aS as G,bD as i,bx as p,bw as L,bA as J,a_ as K,b_ as Q,bB as V,bC as P,aT as S}from"./vendor-a6581121.js";import"./highlightjs-4914df6f.js";const W={components:{ButtonBox:H,LoadingIcon:A,AsyncButtom:N,PageHeader:z,ElTable:F,ElTableColumn:U,ElRadioGroup:$,ElRadio:j},setup(){const a=k("/"),l=k("kooritea.github.io"),v=x({}),n=x([{label:"公开库",value:"kooritea.github.io"},{label:"私有库",value:"private-database"},{label:"媒体库",value:"media-database"}]);for(const e of n)v[e.value]={};const u=w(()=>v[l.value]),f=k(!1),d=x([]),{devMode:g}=O(),o=w(()=>({repo:g.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),y=e=>{d.splice(0,d.length),d.push(...e)},_=w(()=>{const e=[...u.value[a.value]||[]];return!f.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),r=(e,c)=>{if(a.value=e,!u.value[e]||c)return u.value[e]=void 0,f.value=!0,T({...o.value,path:e}).then(m=>{m.type==="dir"&&(u.value[e]=[...m.children.filter(C=>C.type==="dir"),...m.children.filter(C=>C.type==="file")])}).finally(()=>{f.value=!1})};r("/"),q(l,()=>{r("/")});const h=e=>{B({title:"提示",message:`确认删除${e.length>1?`选中的${e.length}个文件`:e[0].name}`,type:"warning",confirmHandlerPromise:c=>I({...o.value,files:e.map(m=>({isDel:!0,path:m.path}))}).then(()=>r(a.value,!0))})};return{dataBaseList:n,onSelectionChange:y,repoConfig:o,tableData:_,loadPath:r,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>B({title:`[${o.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:c=>R({...o.value,branch:void 0,file:e[0]}).then(({sha:m})=>I({...o.value,files:[{sha:m,path:c.inputValue}]}).then(()=>r(a.value,!0))),inputValidator:c=>!!c,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",confirm:!1,disabled:()=>d.length===0,handler:()=>h(d)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in u.value)delete u.value[e];return r("/")}}],deleteItem:h,deleteDir:e=>{B({title:"提示",message:`确认删除${e}`,type:"warning",confirmHandlerPromise:c=>M({...o.value,dir:e}).then(()=>r(a.value,!0))})},database:l}},methods:{onCellClick(a,l,v,n){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},X={class:"page"};function Y(a,l,v,n,u,f){const d=s("PageHeader"),g=s("el-radio"),o=s("el-radio-group"),y=s("LoadingIcon"),_=s("el-table-column"),r=s("AsyncButtom"),h=s("el-table"),D=s("ButtonBox");return b(),G("div",X,[i(d),i(o,{modelValue:n.database,"onUpdate:modelValue":l[0]||(l[0]=t=>n.database=t)},{default:p(()=>[(b(!0),G(K,null,Q(n.dataBaseList,t=>(b(),L(g,{key:t.value,value:t.value,size:"large"},{default:p(()=>[V(P(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(h,{border:"",data:n.tableData,style:{width:"100%"},onCellClick:f.onCellClick,onSelectionChange:n.onSelectionChange},{empty:p(()=>[S("div",null,[i(y)])]),default:p(()=>[i(_,{type:"selection",selectable:t=>t.type==="file"},null,8,["selectable"]),i(_,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{default:p(t=>[S("span",null,P(t.row.type==="dir"?"📁":"📄")+P(t.row.name),1)]),_:1}),i(_,{label:"操作",width:"120px"},{default:p(t=>[i(r,{type:"danger",size:"mini",confirm:!1,onLoadingClick:()=>t.row.type==="dir"?n.deleteDir(t.row.path):n.deleteItem([t.row])},{default:p(()=>[V(" 删除 ")]),_:2},1032,["onLoadingClick"])]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),n.handlers.length>0?(b(),L(D,{key:0,handlers:n.handlers},null,8,["handlers"])):J("",!0)])}const le=E(W,[["render",Y],["__scopeId","data-v-6d252e1f"]]);export{le as default};
