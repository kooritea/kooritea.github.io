import{_ as b,S as I,L as B,u as E,a as C,f as w,e as N,s as H,b as K,c as L,h as O}from"./index-ebcb88b8.js";import{P as V}from"./PageHeader-708fbe02.js";import{N as W}from"./NextButton-55b920d9.js";import{M as U}from"./MarkDown-3806b5db.js";import{b2 as m,ch as d,aP as a,aQ as r,be as j,bo as g,bA as D,bl as P,aR as u,bu as x,bz as v,bv as p,cB as A,bp as G,b_ as T}from"./vendor-b07f99b0.js";import{a as z}from"./element-plus-20d21a73.js";import{u as q}from"./GreatOldOne-7203e76e.js";import"./highlightjs-4914df6f.js";import"./ImageCon-92ce0650.js";const R={components:{SvgIcon:I},setup(){return{isSimplifty:m(!1)}},mounted(){this.$el.offsetHeight>600&&(this.isSimplifty=!0)}},F={key:0,class:"simplifty-mask"};function Q(o,n,t,e,k,l){const c=d("SvgIcon");return a(),r("div",{class:P(["simplifty-box",{"is-simplifty":e.isSimplifty}])},[j(o.$slots,"default",{},void 0,!0),e.isSimplifty?(a(),r("div",F,[g(c,{name:"zhankai",class:"expend-button",onClick:n[0]||(n[0]=y=>e.isSimplifty=!1)})])):D("",!0)],2)}const J=b(R,[["render",Q],["__scopeId","data-v-8a787155"]]);const X={components:{Markdown:U,SimpliftyBox:J,LoadingIcon:B,"el-popover":z},props:{essay:{type:Object,required:!0},essayMap:{type:Object,required:!0},inPopover:{type:Boolean,default:!1}},emits:["set-search-key-word","load-essay-by-id"],setup(){const{darkMode:o}=E(),{darkModeDecodeKey:n}=C();return{darkMode:o,decodeHide:e=>N(e,n.value),formatDate:w,Error}}},Y={class:"essay"},Z=["onClick"],$={class:"hashtag"},ee={key:0,class:"loading-box"},se={key:1},oe={class:"info"},ne={class:"essay-id"};function te(o,n,t,e,k,l){const c=d("LoadingIcon"),y=d("ChaosItem",!0),_=d("el-popover"),f=d("Markdown"),h=d("SimpliftyBox");return a(),r("div",Y,[u("article",{class:P(["article",{"in-popover":t.inPopover}])},[g(h,null,{default:x(()=>[g(f,{"model-value":e.darkMode&&t.essay.hide?e.decodeHide(t.essay.hide):t.essay.content},{hashtag:x(({hashtag:s})=>[!/^#\d+$/.test(s)||t.inPopover?(a(),r("span",{key:0,class:"hashtag",onClick:i=>o.$emit("set-search-key-word",s)},v(s),9,Z)):(a(),p(_,{key:1,width:"",trigger:"click","popper-class":"popper-essay",effect:e.darkMode?"dark":"light",onShow:()=>{t.essayMap[s.slice(1)]||o.$emit("load-essay-by-id",s.slice(1))}},{reference:x(()=>[u("span",$,v(s),1)]),default:x(()=>[!t.essayMap[s.slice(1)]||t.essayMap[s.slice(1)]instanceof e.Error?(a(),r("div",ee,[t.essayMap[s.slice(1)]?(a(),r("span",se,v(t.essayMap[s.slice(1)].message),1)):(a(),p(c,{key:0}))])):(a(),p(y,{key:1,essay:t.essayMap[s.slice(1)],"essay-map":t.essayMap,"in-popover":!0,onSetSearchKeyWord:n[0]||(n[0]=i=>{o.$emit("set-search-key-word",i)})},null,8,["essay","essay-map"]))]),_:2},1032,["effect","onShow"]))]),_:1},8,["model-value"])]),_:1})],2),u("div",oe,[u("span",ne,"#"+v(t.essay.id),1),u("span",null,v(e.formatDate(t.essay.time,`yyyy-MM-dd HH:mm:ss UTC ${e.darkMode?"NDD":"DD"}`)),1)])])}const ae=b(X,[["render",te],["__scopeId","data-v-84c45bc1"]]);const ie={components:{ChaosItem:ae,PageHeader:V,NextButton:W,SvgIcon:I,MDEditor:A({loader:()=>O(()=>import("./MDEditor-1da4126f.js"),["https://kooritea.moe/assets/MDEditor-1da4126f.js","https://kooritea.moe/assets/vendor-b07f99b0.js","https://kooritea.moe/assets/highlightjs-4914df6f.js","https://kooritea.moe/assets/index-ebcb88b8.js","https://kooritea.moe/assets/element-plus-20d21a73.js","https://kooritea.moe/assets/element-plus-f81739cd.css","https://kooritea.moe/assets/index-a8f6aae2.css","https://kooritea.moe/assets/MarkDown-3806b5db.js","https://kooritea.moe/assets/ImageCon-92ce0650.js","https://kooritea.moe/assets/ImageCon-7200ecbe.css","https://kooritea.moe/assets/MarkDown-d142a19e.css","https://kooritea.moe/assets/GreatOldOne-7203e76e.js","https://kooritea.moe/assets/MDEditor-97ba8300.css"],import.meta.url),loadingComponent:B})},setup(){const o=m({}),{darkMode:n,isGreatOldOne:t}=E(),{offlineMode:e,darkModeDecodeKey:k}=C(),l=m(""),c=m([]),y=m(!1),_=m(!1),f=m(null),h=i=>N(i,k.value),s=i=>(_.value=!0,L(i).then(M=>{M=M.map(S=>(o.value[S.id]=S,{...S,expend:!1})),y.value=M.length===10,c.value.push(...M)}).finally(()=>{_.value=!1}));return s(),{loading:_,searchBlogEssays:s,essays:c,searchKeyWord:l,offlineMode:e,hasNext:y,darkMode:n,essayMap:o,setScorllGotoTop:H,isGreatOldOne:t,editing:f,decodeHide:h}},methods:{search(o){if(this.essays=[],this.offlineMode&&o&&!/^#\d+$/.test(o)){this.$msgBox.error("离线模式下仅可以使用id搜索");return}return this.searchBlogEssays({keyword:o})},onNext(){var n;const o=(n=this.essays[this.essays.length-1])==null?void 0:n.id;return this.searchBlogEssays({keyword:this.searchKeyWord,start:o?o-1:void 0})},loadEssayById(o){if(this.essayMap[o]!==null)return this.essayMap[o]=null,K({id:o}).then(n=>{this.essayMap[o]=n}).catch(n=>{this.essayMap[o]=new Error(n)})},onSubmitUpdateEssay(o,n,t){return q(o.id,{content:n?void 0:t,hide:n?t:void 0}).then(e=>{Object.assign(o,e),this.editing=null})}}},de={class:"page"};function re(o,n,t,e,k,l){const c=d("PageHeader"),y=d("ChaosItem"),_=d("MDEditor"),f=d("SvgIcon"),h=d("NextButton");return a(),r("div",de,[g(c,{modelValue:e.searchKeyWord,"onUpdate:modelValue":n[0]||(n[0]=s=>e.searchKeyWord=s),"show-search-input":!0,"on-input":l.search},null,8,["modelValue","on-input"]),u("ul",null,[(a(!0),r(G,null,T(e.essays,s=>(a(),r("li",{key:s.id,class:"essay-box"},[e.editing!==s?(a(),p(y,{key:0,essay:s,"essay-map":e.essayMap,onSetSearchKeyWord:n[1]||(n[1]=i=>{e.searchKeyWord=i,e.setScorllGotoTop()}),onLoadEssayById:l.loadEssayById},null,8,["essay","essay-map","onLoadEssayById"])):(a(),p(_,{key:1,"model-value":e.darkMode?e.decodeHide(s.hide):s.content,cache:!1,"ex-handlers":[{name:"取消",handler:()=>{e.editing=null}}],"on-submit":i=>l.onSubmitUpdateEssay(s,e.darkMode,i)},null,8,["model-value","ex-handlers","on-submit"])),e.isGreatOldOne&&e.editing!==s?(a(),p(f,{key:2,name:"bianji",onClick:i=>e.editing=s},null,8,["onClick"])):D("",!0)]))),128))]),g(h,{hasNext:e.hasNext,"onUpdate:hasNext":n[2]||(n[2]=s=>e.hasNext=s),loading:e.loading,"onUpdate:loading":n[3]||(n[3]=s=>e.loading=s),"on-click":l.onNext},null,8,["hasNext","loading","on-click"])])}const ve=b(ie,[["render",re],["__scopeId","data-v-c1204414"]]);export{ve as default};
