import{bI as L,b8 as x,cg as S,aR as h,aS as _,aT as m,a_ as R,b_ as O,bw as I,bx as A,bC as D,bs as F,bf as G,c$ as K,b4 as J,be as Q,b2 as X,b0 as Y,by as Z,cl as ee,bR as te,bD as k,bA as T}from"./vendor-a6581121.js";import{_ as N,S as W,a as ae,ae as ne,af as oe,x as z,ag as le,M as V,B as re,u as se,n as ce,ah as ie,ai as de}from"./index-7a629878.js";import{M as ue}from"./MarkDown-b38619ef.js";import{I as me}from"./ImageCon-648eed75.js";import{j as he,b as fe}from"./element-plus-5d967f66.js";const pe={components:{SvgIcon:W,ImageCon:me},props:{init:{type:Boolean,default:!0},prefix:{type:[String,Array],default:"https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/emoji/"}},emits:["select"],setup(a,{emit:l}){const{emoteHistory:d}=ae(),e=L({name:"history",emote:d.value}),t=L([]),p=x("history"),g=s=>{if(p.value=s.name,s.emote.length===0)return ne(s.name).then(c=>{p.value=s.name,s.emote=c.emote.map(H=>({...H,scope:s.name}))})},f=()=>{t.splice(0,t.length),t.push(e),oe().then(s=>{t.push(...s.sort((c,H)=>{const E=d.value.findIndex(M=>M.scope===c.name),b=d.value.findIndex(M=>M.scope===H.name);return(E===-1?1/0:E)-(b===-1?1/0:b)})),t.push({name:"add",emote:[]})})};return f(),{onSelect:s=>{l("select",s),d.value=d.value.filter(c=>!(c.scope===s.scope&&c.name===s.name)),d.value=[s,...d.value].slice(0,30),e.emote=d.value},addEmotePackage:()=>{z({title:"导入表情包",message:"输入要添加的B站表情包ID",type:"info",confirmHandlerPromise:s=>le(s.inputValue).then(()=>{V.success("添加成功"),f()}),inputValidator:s=>/^\d+$/.test(s),showInput:!0,inputErrorMessage:"请输入数字"})},currentScope:p,emotePackages:t,selectScope:g}}},ge={class:"emote-selector"},ve={class:"emotes"},ye={class:"scopes"},_e=["onClick"];function we(a,l,d,e,t,p){const g=S("ImageCon"),f=S("SvgIcon");return h(),_("div",ge,[m("div",ve,[(h(!0),_(R,null,O((e.emotePackages.find(n=>n.name===e.currentScope)||{}).emote||[],n=>(h(),I(g,{key:n.name,class:"emote",alt:n.name,src:`${n.scope}/${n.name}.png`,prefix:d.prefix,onClick:w=>e.onSelect(n)},{error:A(()=>[m("span",null,D(n.name),1)]),_:2},1032,["alt","src","prefix","onClick"]))),128))]),m("div",ye,[(h(!0),_(R,null,O(e.emotePackages,n=>(h(),_("div",{key:n.name,class:F(["scope",{"selected-scope":e.currentScope===n.name}]),onClick:()=>{n.name==="add"?e.addEmotePackage():e.selectScope(n)}},[n.name==="history"?(h(),I(f,{key:0,class:"emote history",name:"icon-time"})):n.name==="add"?(h(),I(f,{key:1,class:"emote history",name:"add"})):(h(),I(g,{key:2,class:"emote",src:`${n.name}/${n.name}.png`,prefix:d.prefix},{error:A(()=>[m("span",null,D(n.name),1)]),_:2},1032,["src","prefix"]))],10,_e))),128))])])}const be=N(pe,[["render",we],["__scopeId","data-v-db974307"]]);function Se(a){const l=x(null),d=G(he,{style:{width:"100%"},placeholder:"预约时间",type:"datetime",modelValue:l.value,"onUpdate:modelValue":e=>{var t;l.value=e,(t=d.component)!=null&&t.props&&(d.component.props.modelValue=e)}});z({title:"选择预约时间",message:d,confirmHandlerPromise:e=>a(l),inputValidator:e=>!!l.value,inputErrorMessage:"请选择预约时间"})}const P={},xe={components:{SvgIcon:W,Markdown:ue,ButtonBox:re,EmoteSelector:be,ElPopover:fe},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},defaultValue:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(a,{emit:l}){const{darkMode:d}=se(),e=x(!0),{computedModelValue:t}=ce(a,l),p=x(!1),g=x(null);if(a.cache){const o=K();if(P[o.fullPath]&&a.cache===!0)V.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const i="MDEditorCache."+(a.cache===!0?o.fullPath:`${o.fullPath}.${a.cache}`);t.value=localStorage.getItem(i)||a.defaultValue;let r=null;J(()=>{P[i]=!0,r=setInterval(()=>{p.value=!0,localStorage.setItem(i,t.value||"")},1e3)}),Q(()=>{P[i]=!1,clearInterval(r)}),X(t,()=>{p.value=!1})}}const f=o=>{const i=g.value.selectionStart,r=t.value.slice(0,i),v=t.value.slice(i);t.value=`${r}${o}${v}`},n=x(t.value),w=({reservationDate:o}={})=>{const i=a.onSubmit(t.value,o==null?void 0:o.value);return i instanceof Promise?i.then(()=>{t.value=a.defaultValue,n.value=a.defaultValue}):(t.value=a.defaultValue,n.value=a.defaultValue),i},s=()=>{t.value=""},c=()=>{t.value=n.value},H=[{name:"提交",type:"primary",handler:w,show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("submit"):a.showDefaultHandlers,sort:10},{name:"预约",type:"primary",handler:()=>{Se(o=>{w({reservationDate:o})})},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reservation"):a.showDefaultHandlers,sort:10},{name:"清除",type:"danger",handler:s,confirm:{message:"确认清空内容?"},show:()=>Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("clean"):a.showDefaultHandlers,sort:20},{name:"重置",type:"default",handler:c,show:()=>(Array.isArray(a.showDefaultHandlers)?a.showDefaultHandlers.includes("reset"):a.showDefaultHandlers)&&!!n.value,sort:30}],E=Y(()=>[...H,...a.exHandlers]),b=o=>{const i=ie(URL.createObjectURL(o),{handlers:[{name:"上传",type:"primary",handler:()=>{const r=new Date().valueOf().toString();f(`![${r}](--------------------)`),de(o,v=>{const y=Math.round(100*event.loaded/event.total)/10*2;t.value=t.value.replace(new RegExp(`\\!\\[${r}]\\((#*?)(-*?)\\)`),`![${r}](${"#".repeat(y)}${"-".repeat(20-y)})`)}).then(v=>{t.value=t.value.replace(new RegExp(`\\!\\[${r}]\\((#*?)(-*?)\\)`),`![${v.keyname}](${v.local})`)}).catch(()=>{t.value=t.value.replace(new RegExp(`\\!\\[${r}]\\((#*?)(-*?)\\)`),"")}),i.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{const r=document.createElement("canvas"),v=r.getContext("2d"),u=new Image;u.onload=async()=>{if(u.height*16===u.width*9)return;const y=u.height*16/9;if(y>u.width){const C=.5625*u.width;r.width=u.width,r.height=C,v.drawImage(u,0,(u.height-C)/2,u.width,C,0,0,u.width,C)}else r.width=y,r.height=u.height,v.drawImage(u,(u.width-y)/2,0,y,u.height,0,0,y,u.height);const U=r.toDataURL(o.type).split(","),q=U[0].match(/:(.*?);/)[1],$=atob(U[1]);let B=$.length;const j=new Uint8Array(B);for(;B--;)j[B]=$.charCodeAt(B);i.callClose(),b(new File([j],o.name,{type:q}))},u.src=URL.createObjectURL(o)}},{name:"取消",type:"default",handler:()=>{i.callClose()}}]})};return{darkMode:d,isEditMode:e,computedModelValue:t,resetCache:n,isSave:p,handlers:E,submitHandler:w,cleanHandler:s,resetHandler:c,previewImageBeforeUpload:b,pasteHandler:o=>{if(!(o.clipboardData&&o.clipboardData.items))return;const i=Array.from(o.clipboardData.items).filter(r=>r.kind==="file");if(i.length>0){o.preventDefault();for(const r of i)if(r.type.startsWith("image/")){b(r.getAsFile());return}else V.warning(`不支持的文件类型: ${r.type}`)}},dropHandler:o=>{for(const i of o.dataTransfer.files)if(o.preventDefault(),i.type.startsWith("image/")){b(i);return}else V.warning(`不支持的文件类型: ${i.type}`)},textarea:g,insertText:f}}},He={class:"md-editor"},ke={class:"fill"},Ie={key:1,class:"preview"},De={class:"bar"},Ee={class:"bar-left"},Me={class:"title"},Be={class:"uploader"},Ce={class:"bar-right"},Ve={key:0,class:"is-save info"};function Ae(a,l,d,e,t,p){const g=S("Markdown"),f=S("SvgIcon"),n=S("EmoteSelector"),w=S("el-popover"),s=S("ButtonBox");return h(),_(R,null,[m("div",He,[e.isEditMode?(h(),_("div",{key:0,class:F(["textarea-box",{"auto-height":d.autoHeight}])},[m("pre",ke,D(e.computedModelValue),1),Z(m("textarea",{ref:"textarea","onUpdate:modelValue":l[0]||(l[0]=c=>e.computedModelValue=c),class:"textarea",onPaste:l[1]||(l[1]=(...c)=>e.pasteHandler&&e.pasteHandler(...c)),onDragover:l[2]||(l[2]=te(()=>{},["prevent"])),onDrop:l[3]||(l[3]=(...c)=>e.dropHandler&&e.dropHandler(...c))},null,544),[[ee,e.computedModelValue]])],2)):(h(),_("div",Ie,[k(g,{"model-value":e.computedModelValue},null,8,["model-value"])])),m("div",De,[m("div",Ee,[m("div",Me,D(d.title),1),m("label",Be,[k(f,{class:"button",name:"14"}),m("input",{type:"file",accept:"image/*",onChange:l[4]||(l[4]=c=>{e.previewImageBeforeUpload(c.srcElement.files[0]),c.srcElement.value=""})},null,32)]),k(w,{width:"auto",trigger:"click",effect:e.darkMode?"dark":"light"},{reference:A(()=>[k(f,{class:"button",name:"biaoqing"})]),default:A(()=>[k(n,{onSelect:l[5]||(l[5]=c=>{e.insertText(`[emoji ${c.scope}/${c.name}]`)})})]),_:1},8,["effect"])]),m("div",Ce,[e.isSave?(h(),_("span",Ve,"已保存")):T("",!0),m("span",{class:"preview-switch button",onClick:l[6]||(l[6]=c=>e.isEditMode=!e.isEditMode)},D(e.isEditMode?"预览":"返回编辑"),1)])])]),e.handlers.length>0?(h(),I(s,{key:0,handlers:e.handlers},null,8,["handlers"])):T("",!0)],64)}const Pe=N(xe,[["render",Ae],["__scopeId","data-v-7ca63b31"]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{Pe as M,Te as a,Se as u};
