import{_ as b,A as w,ab as V,a4 as x,a9 as L,L as P,ac as B}from"./index-91fa13a0.js";import{cg as c,aR as r,aS as g,bD as d,bx as o,bB as _,aT as f,a_ as F,b_ as D,bw as h,bC as y,bA as p,c0 as T}from"./vendor-a6581121.js";const I={components:{AsyncButtom:w},props:{modelValue:{type:String,default:()=>"00:00:00"},sourcePath:{type:String,default:()=>""}},emits:["update:modelValue"],data(){return{imageSrc:"",timeControllers:[{label:"-1m",value:-60},{label:"-10s",value:-10},{label:"-1s",value:-1},{label:"+1s",value:1},{label:"+10s",value:10},{label:"+1m",value:60}]}},methods:{updateTimestring(e){this.$emit("update:modelValue",`${V(x(this.modelValue.split(".")[0])+e)}.${this.modelValue.split(".")[1]}`)},getScreenshots(e){if(!this.sourcePath){this.$msgBox.warning("请先选择视频源");return}return L(this.sourcePath,this.modelValue,e).then(t=>{this.imageSrc&&URL.revokeObjectURL(this.imageSrc),this.imageSrc=URL.createObjectURL(t)})}}},A={class:"preview-screenshots"},M={class:"screenshots-box"},N={class:"btn-box"},O=["src"];function R(e,t,a,u,l,s){const m=c("AsyncButtom");return r(),g("div",A,[d(m,{type:"primary",size:"mini",onLoadingClick:()=>s.getScreenshots("jpg")},{default:o(()=>[_(" 获取截图 ")]),_:1},8,["onLoadingClick"]),d(m,{type:"primary",size:"mini",onLoadingClick:()=>s.getScreenshots("png")},{default:o(()=>[_(" 获取无压缩截图 ")]),_:1},8,["onLoadingClick"]),f("div",M,[f("div",N,[(r(!0),g(F,null,D(l.timeControllers,i=>(r(),h(m,{key:i.label,size:"mini",onLoadingClick:()=>{s.updateTimestring(i.value)}},{default:o(()=>[_(y(i.label),1)]),_:2},1032,["onLoadingClick"]))),128))]),l.imageSrc?(r(),g("img",{key:0,class:"image",src:l.imageSrc,onClick:t[0]||(t[0]=i=>e.$imagePreview(l.imageSrc,{fileName:a.sourcePath.slice(a.sourcePath.lastIndexOf("/")+1).split(".")[0]}))},null,8,O)):p("",!0)])])}const H=b(I,[["render",R],["__scopeId","data-v-7964d85d"]]),U={components:{LoadingIcon:P},props:{modelValue:{type:[String,Array],default:void 0},checkMode:{type:String,default:()=>""}},emits:["update:modelValue"],data(){return{loading:!1,useFileFilter:!0,tableData:[],currentPath:"/"}},computed:{filterTableData(){return this.tableData.filter(e=>this.fileFilter&&this.useFileFilter&&e.type==="file"?this.fileFilter(e):!0)}},watch:{modelValue:{immediate:!0,handler(e){if(e){const t=e.slice(0,e.lastIndexOf("/"))||"/";this.currentPath!==t&&this.load(t)}}}},created(){this.load(this.currentPath)},methods:{onCellClick(e,t,a,u){t.property==="name"&&(e.type==="dir"?this.load(e.path):e.type==="file"&&this.$emit("update:modelValue",e.path))},onSelectionChange(){},load(e){this.loading=!0,this.loader(e).then(t=>{this.tableData=[...t].sort((a,u)=>{const l=a.type.localeCompare(u.type);return l!==0?l:a.name.localeCompare(u.name)}),e!=="/"&&this.tableData.unshift({type:"dir",name:"..",path:e.slice(0,e.slice(0,e.length-1).lastIndexOf("/"))||"/"}),this.currentPath=e}).finally(()=>{this.loading=!1})},loader(){throw new Error("loader需实现")}}};function j(e,t,a,u,l,s){const m=c("LoadingIcon"),i=c("el-table-column"),v=c("el-radio"),S=c("el-radio-group"),C=c("el-switch"),k=c("el-table");return r(),h(k,{border:"",data:s.filterTableData,style:{width:"100%"},onCellClick:s.onCellClick,onSelectionChange:s.onSelectionChange},T({default:o(()=>[a.checkMode==="multiple"?(r(),h(i,{key:0,type:"selection",selectable:n=>n.type==="file"},null,8,["selectable"])):p("",!0),a.checkMode==="single"?(r(),h(i,{key:1,width:"40px"},{default:o(n=>[n.row.path===a.modelValue?(r(),h(S,{key:0,"model-value":n.row.path},{default:o(()=>[d(v,{value:n.row.path},null,8,["value"])]),_:2},1032,["model-value"])):p("",!0)]),_:1})):p("",!0),d(i,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{header:o(()=>[_(" 文件名 "),d(C,{modelValue:l.useFileFilter,"onUpdate:modelValue":t[0]||(t[0]=n=>l.useFileFilter=n),"active-text":"打开文件过滤"},null,8,["modelValue"])]),default:o(n=>[f("span",null,y(n.row.type==="dir"?"📁":"📄")+y(n.row.name),1)]),_:1})]),_:2},[l.loading?{name:"empty",fn:o(()=>[f("div",null,[d(m)])]),key:"0"}:void 0]),1032,["data","onCellClick","onSelectionChange"])}const z=b(U,[["render",j]]);const E={extends:z,methods:{loader(e){return B(e).then(t=>t.children)},fileFilter(e){return["mkv","mp4","mov"].includes(e.extname)}}},J=b(E,[["__scopeId","data-v-fbd94c47"]]);export{J as M,H as P};
