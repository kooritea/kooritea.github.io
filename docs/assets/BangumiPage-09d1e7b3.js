import{P as S}from"./PageHeader-f8782a7b.js";import{b8 as b,cg as B,cB as E,aR as s,aS as l,by as $,aT as u,bD as A,bC as m,bw as v,bA as p,bx as L,bB as k,bI as x,b0 as N,a_ as h,b_ as f,bs as C,bR as D}from"./vendor-a6581121.js";import{_ as O,l as P,A as U,m as j,n as G,u as K,o as V,p as W,q as z,r as H}from"./index-9eb66e63.js";import{I as M}from"./ImageCon-a73481d0.js";import"./highlightjs-4914df6f.js";import"./element-plus-5d967f66.js";const R={components:{ImageCon:M,AsyncSwitch:P,AsyncButtom:U},directives:{mask:j},props:{bangumi:{type:Object,required:!0}},setup(c,{emit:i}){const{computedBangumi:d}=G(c,i),{mobileMode:e,isGreatOldOne:y}=K(),g=b(!1);return{cancel:()=>{e.value&&!g.value&&(d.value=null)},computedBangumi:d,isGreatOldOne:y,globalLoading:g}},methods:{onSwitchBangumiState(c,i){return V(c.id,{state:i})},onUpdateBangumiInfo(c){return W(c.subject).then(i=>{const d={...c,...i};return delete d.deletedAt,delete d.id,V(c.id,d).then(e=>{Object.assign(c,e)})})},deleteBangumi(c){return z(c.id).then(()=>{Object.assign(c,{isDel:!0})})}}},q={class:"bangumi-viewer-container"},F={class:"preview"},T={class:"name"},Y={class:"nname"},J={class:"switch-time-episode"},Q={class:"time-episode"},X={key:0};function Z(c,i,d,e,y,g){const _=B("ImageCon"),o=B("AsyncSwitch"),t=B("AsyncButtom"),a=E("mask");return s(),l("div",{class:"bangumi-viewer",onClick:i[2]||(i[2]=(...n)=>e.cancel&&e.cancel(...n))},[$((s(),l("div",q,[u("div",F,[A(_,{src:e.computedBangumi.img,prefix:["https://lain.bgm.tv/pic/cover/l"]},null,8,["src","prefix"])]),u("div",T,m(e.computedBangumi.name),1),u("div",Y,m(e.computedBangumi.nname),1),u("div",J,[e.isGreatOldOne?(s(),v(o,{key:0,modelValue:e.computedBangumi.state,"onUpdate:modelValue":i[0]||(i[0]=n=>e.computedBangumi.state=n),loading:e.globalLoading,"onUpdate:loading":i[1]||(i[1]=n=>e.globalLoading=n),onLoadingClick:n=>g.onSwitchBangumiState(e.computedBangumi,n)},null,8,["modelValue","loading","onLoadingClick"])):p("",!0),e.isGreatOldOne?(s(),v(t,{key:1,type:"primary",size:"mini",onLoadingClick:()=>g.onUpdateBangumiInfo(e.computedBangumi)},{default:L(()=>[k(" 更新信息 ")]),_:1},8,["onLoadingClick"])):p("",!0),e.isGreatOldOne&&!d.bangumi.isDel?(s(),v(t,{key:2,type:"danger",size:"mini",confirm:{message:`确认删除${d.bangumi.name||d.bangumi.nname}`},onLoadingClick:()=>g.deleteBangumi(e.computedBangumi)},{default:L(()=>[k(" 删除 ")]),_:1},8,["confirm","onLoadingClick"])):p("",!0),u("span",Q,[e.computedBangumi.episode?(s(),l("span",X," ("+m(e.computedBangumi.episode)+"话) ",1)):p("",!0),k(" "+m(e.computedBangumi.time),1)])])])),[[a,!0]])])}const I=O(R,[["render",Z],["__scopeId","data-v-88988f09"]]);const ee={components:{PageHeader:S,BangumiViewer:I},setup(){const c=b(""),i=x([]),d=b(null),e=x({notExistDate:[],year:[]});e.notExistDate.open=!1;const y=()=>{i.splice(0,i.length),d.value=null,e.notExistDate=[],e.year=[],H().then(_=>{const o={};for(const t of _)if(!t.time)e.notExistDate.push(t);else{const a=new Date(t.time),n=a.getFullYear(),r=a.getMonth()+1;o[n]||(o[n]=[],o[n].year=n,o[n].open=!1,o[n].total=0,o[n].complete=0,e.year.push(o[n])),o[`${n}-${r}`]||(o[`${n}-${r}`]=[],o[`${n}-${r}`].month=`${n}-${r}`,o[`${n}-${r}`].monthNum=r,o[`${n}-${r}`].open=!1,o[`${n}-${r}`].total=0,o[`${n}-${r}`].complete=0,o[n].push(o[`${n}-${r}`])),o[n].total++,o[`${n}-${r}`].total++,t.state&&(o[n].complete++,o[`${n}-${r}`].complete++),o[`${n}-${r}`].push(t)}e.year=e.year.sort((t,a)=>a.year-t.year);for(const t in e.year){e.year[t]=e.year[t].sort((a,n)=>a.monthNum-n.monthNum);for(const a in e.year[t])Array.isArray(e.year[t][a])&&(e.year[t][a]=e.year[t][a].sort((n,r)=>new Date(n.time)-new Date(r.time)))}i.push(..._)})};y();const g=N(()=>c.value?i.filter(_=>{var o,t,a,n,r,w;return((a=(o=_.name)==null?void 0:o.toLowerCase())==null?void 0:a.includes((t=c.value)==null?void 0:t.toLowerCase()))||((w=(n=_.nname)==null?void 0:n.toLowerCase())==null?void 0:w.includes((r=c.value)==null?void 0:r.toLowerCase()))}):[]);return{selectedBangumi:d,bangumiDateList:e,bangumiSearchList:g,searchKeyWord:c,refreshList:y}},methods:{}},te={class:"page"},ne={class:"container"},oe={key:0,class:"list"},ae={key:0},ie=["title","onClick"],se=["onClick"],le={class:"item-info"},re={key:0},ce=["onClick"],de={class:"item-info"},me={key:0},ue=["title","onClick"],_e={key:1,class:"list search-list"},ge=["title","onClick"];function pe(c,i,d,e,y,g){const _=B("PageHeader"),o=B("BangumiViewer");return s(),l("div",te,[A(_,{modelValue:e.searchKeyWord,"onUpdate:modelValue":i[0]||(i[0]=t=>e.searchKeyWord=t),"show-search-input":!0},null,8,["modelValue"]),u("div",ne,[e.searchKeyWord?(s(),l("div",_e,[u("ul",null,[(s(!0),l(h,null,f(e.bangumiSearchList,t=>(s(),l("li",{key:t.id,class:C(["bangumi-item",{complete:t.state}]),title:t.nname,onClick:a=>e.selectedBangumi=t},m(t.name),11,ge))),128))])])):(s(),l("div",oe,[u("ul",null,[e.bangumiDateList.notExistDate.length>0?(s(),l("li",{key:0,class:"year-item",onClick:i[1]||(i[1]=t=>e.bangumiDateList.notExistDate.open=!e.bangumiDateList.notExistDate.open)},[k(" 放送时间未确认 "),e.bangumiDateList.notExistDate.open?(s(),l("ul",ae,[(s(!0),l(h,null,f(e.bangumiDateList.notExistDate,t=>(s(),l("li",{key:t.id,class:C(["bangumi-item",{complete:t.state}]),title:t.nname,onClick:D(a=>e.selectedBangumi=t,["stop"])},m(t.name||t.nname),11,ie))),128))])):p("",!0)])):p("",!0),(s(!0),l(h,null,f(e.bangumiDateList.year,t=>(s(),l("li",{key:t.year,class:"year-item",onClick:a=>t.open=!t.open},[u("div",le,[u("span",null,m(t.year),1),u("span",null,m(t.complete)+"/"+m(t.total),1)]),t.open?(s(),l("ul",re,[(s(!0),l(h,null,f(t,a=>(s(),l("li",{key:a.month,class:"month-item",onClick:D(n=>a.open=!a.open,["stop"])},[u("div",de,[u("span",null,m(a.month),1),u("span",null,m(a.complete)+"/"+m(a.total),1)]),a.open?(s(),l("ul",me,[(s(!0),l(h,null,f(a,n=>(s(),l("li",{key:n.id,class:C(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:D(r=>e.selectedBangumi=n,["stop"])},m(n.name||n.nname)+m(n.isDel?"[已删除]":""),11,ue))),128))])):p("",!0)],8,ce))),128))])):p("",!0)],8,se))),128))])])),e.selectedBangumi?(s(),v(o,{key:2,bangumi:e.selectedBangumi,"onUpdate:bangumi":i[2]||(i[2]=t=>e.selectedBangumi=t)},null,8,["bangumi"])):p("",!0)])])}const Ce=O(ee,[["render",pe],["__scopeId","data-v-a3255d72"]]);export{Ce as default};
