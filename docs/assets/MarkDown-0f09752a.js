import{cf as w,aQ as u,aR as _,bC as T,bQ as $,aS as m,b7 as g,a$ as M,cA as U,bB as y,aZ as v,bZ as A,bx as E,br as S,bD as z,bz as I,bv as V,bs as W,bA as L,bw as K,bH as O,cX as Y,cY as Z,da as x,db as Q,bF as X,be as f}from"./vendor-23d2f8cc.js";import{I as F}from"./ImageCon-7fd1f245.js";import{_ as h,S as q,V as J,u as G,k as ee,W as te,X as P,L as R,Y as ne,A as oe}from"./index-6dfeff5e.js";const se={components:{ImageCon:F},props:{src:{type:String,default:()=>""},alt:{type:String,default:()=>""}}},ce={class:"md-image"};function re(o,e,n,t,s,a){const c=w("ImageCon");return u(),_("div",ce,[T(c,{ref:"ImageCon",src:`/kooritea/kooritea.github.io/img${n.src}`,alt:n.alt||n.src,onClick:e[0]||(e[0]=i=>o.$imagePreview(o.$refs.ImageCon.applySrc,{fileName:n.alt})),onDragstart:e[1]||(e[1]=$(()=>{},["prevent"]))},null,8,["src","alt"])])}const ae=h(se,[["render",re],["__scopeId","data-v-cb9ee7ef"]]);const ie={props:{content:{type:String,default:""}},setup(o){return{src:o.content.match(/\[video (.*?)\]/)[1]}}},le={class:"md-video"},ue=["src"];function de(o,e,n,t,s,a){return u(),_("div",le,[m("video",{class:"video",controls:"",preload:"none",src:t.src},null,8,ue)])}const _e=h(ie,[["render",de],["__scopeId","data-v-464e0edf"]]);const pe={components:{SvgIcon:q},directives:{"safe-html":J},props:{content:{type:String,required:!0},lang:{type:String,default:""}},setup(o){const{darkMode:e}=G(),n=g(!1);let t=null;return ee(()=>import("./highlightjs-4914df6f.js").then(s=>s.i),[],import.meta.url).then(s=>{n.value=!0,t=s.default}),{darkMode:e,highlightCode:M(()=>{if(n.value&&t.getLanguage(o.lang.toLowerCase()))return t.highlight(o.content,{language:o.lang.toLowerCase()}).value;{const s=document.createElement("div");return s.innerHTML=o.content,s.innerText}}),lineCount:M(()=>o.content.split(`
`).length-1)}},methods:{writeTextToClipboard(){te(this.content),this.$msgBox.success("复制成功")}}},me={class:"code-block"},ge={class:"code-meta"},fe={class:"lang"},he={class:"code"},ye={class:"line-numbers"};function be(o,e,n,t,s,a){const c=w("SvgIcon"),i=U("safe-html");return u(),_("div",me,[m("div",ge,[m("span",fe,y(`${n.lang.slice(0,1).toUpperCase()}${n.lang.slice(1)}`),1),m("span",{class:"copy",onClick:e[0]||(e[0]=(...d)=>a.writeTextToClipboard&&a.writeTextToClipboard(...d))},[T(c,{name:"copy"})])]),m("div",he,[m("div",ye,[(u(!0),_(v,null,A(new Array(t.lineCount).fill(""),(d,r)=>(u(),_("div",{key:r,class:"number"},y(r+1),1))),128))]),E(m("pre",{class:S(["hljs",{dark:t.darkMode,light:!t.darkMode}])},null,2),[[i,t.highlightCode]])])])}const ke=h(pe,[["render",be],["__scopeId","data-v-c2ba251c"]]);const ve=String.fromCharCode(8205),we=/\uFE0F/g,xe=(o,e="-")=>{const n=[];let t=0,s=0,a=0;for(;a<o.length;)t=o.charCodeAt(a++),s?(n.push((65536+(s-55296<<10)+(t-56320)).toString(16)),s=0):t>=55296&&t<=56319?s=t:n.push(t.toString(16));return n.join(e)};function $e(o){return xe(o.indexOf(ve)<0?o.replace(we,""):o)}const Ie={components:{ImageCon:F},props:{emoji:{type:String,default:""}},setup(o){const e=g(!1),t=`/twitter/twemoji/assets/72x72/${$e(o.emoji)}.png`;return{showEmojiImg:e,imgSrc:t}}},Se={key:0};function Ce(o,e,n,t,s,a){const c=w("ImageCon");return u(),_(v,null,[E(T(c,{class:"emoji",src:t.imgSrc,alt:n.emoji,onLoad:e[0]||(e[0]=i=>t.showEmojiImg=!0)},null,8,["src","alt"]),[[z,t.showEmojiImg]]),t.showEmojiImg?I("",!0):(u(),_("span",Se,y(n.emoji),1))],64)}const Me=h(Ie,[["render",Ce],["__scopeId","data-v-b3b7c2a5"]]);const Te={props:{content:{type:String,default:""}},setup(o){const e=o.content.match(/\[bilibili ((av|bv|AV|BV)[a-zA-Z0-9]+)?( p.*?)?\]/),n=e[1],t=((e?e[3]:"")||"").slice(2),s=g(`https://player.bilibili.com/player.html?bvid=${n}${t?"?page="+t:""}`),a=g(`https://www.bilibili.com/video/${n}${t?"?p="+t:""}`),c=g(!0);return{playerSrc:s,webSiteSrc:a,loading:c,id:g(n)}}},De=["href"],je=["src"];function Le(o,e,n,t,s,a){return u(),_("div",null,[m("p",null,[m("a",{class:"link",href:t.webSiteSrc,target:"_blank"},y(t.id),9,De)]),m("iframe",{src:t.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:S(["bilibili-player",{loading:t.loading}]),onLoad:e[0]||(e[0]=c=>t.loading=!1)},null,42,je)])}const Ae=h(Te,[["render",Le],["__scopeId","data-v-81ebfb8f"]]);const Be={props:{content:{type:String,default:""}},setup(o){const n=o.content.match(/\[youtube (.*?)\]/)[1],t=g(`https://www.youtube.com/embed/${n}`),s=g(`https://www.youtube.com/watch?v=${n}`),a=g(!0);return{playerSrc:t,webSiteSrc:s,loading:a,id:g(n)}}},Ee=["href"],Ve=["src"];function Ne(o,e,n,t,s,a){return u(),_("div",null,[m("p",null,[m("a",{class:"link",href:t.webSiteSrc,target:"_blank"},y(t.id),9,Ee)]),m("iframe",{src:t.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:S(["youtube-player",{loading:t.loading}]),onLoad:e[0]||(e[0]=c=>t.loading=!1)},null,42,Ve)])}const He=h(Be,[["render",Ne],["__scopeId","data-v-c83eea6c"]]);function ze(o){return P()}const Fe={components:{LoadingIcon:R},props:{content:{type:String,default:""}},setup(o){const n=o.content.match(/\[music (.*?)\]/)[1],t=g({}),s=g(!0),a=g("");return(n.startsWith("private")?ze(n.slice(8)):ne(n)).then(c=>{t.value=c}).catch(c=>{a.value=c.message}).finally(()=>{s.value=!1}),{loading:s,error:a,id:g(n),music:t}},methods:{onClick(){this.loading||this.error||this.music.getPlayUrl().then(o=>{window.open(o,"_blank")})}}},Pe={key:1,class:"error-msg"},Re=["src"],Ue={class:"info"},We=["title"],Ke=["title"];function Oe(o,e,n,t,s,a){const c=w("LoadingIcon");return u(),_("div",{class:"music-player-simple",onClick:e[0]||(e[0]=(...i)=>a.onClick&&a.onClick(...i))},[t.loading?(u(),V(c,{key:0})):t.error?(u(),_("div",Pe,y(t.error),1)):(u(),_(v,{key:2},[m("img",{class:"music-player-simple-pic",src:t.music.picUrl},null,8,Re),m("div",Ue,[m("p",{class:"song-name",title:t.music.name}," 🎶"+y(t.music.name),9,We),m("p",{class:"singer-name",title:t.music.singer},y(t.music.singer),9,Ke)])],64))])}const Ye=h(Fe,[["render",Oe],["__scopeId","data-v-4c1539b2"]]);const Ze={components:{LoadingIcon:R},props:{content:{type:String,default:""}},setup(o){const n=o.content.match(/\[emoji (.*?)\]/)[1],t=g(""),s=g(!0);return P().then(a=>{t.value=`${a}/kooritea/kooritea.github.io/emoji/${n}.png`}),{id:g(n),loading:s,imageSrc:t}}},Qe={class:"md-sticker"},Xe=["src","alt"];function qe(o,e,n,t,s,a){const c=w("LoadingIcon");return u(),_("div",Qe,[t.loading?(u(),V(c,{key:0,class:"loading"})):I("",!0),t.imageSrc?E((u(),_("img",{key:1,class:S(["sticker-image",{"sticker-image-loading":t.loading}]),src:t.imageSrc,alt:t.id||o.src,onLoad:e[0]||(e[0]=i=>t.loading=!1),onDragstart:e[1]||(e[1]=$(()=>{},["prevent"]))},null,42,Xe)),[[z,!t.loading]]):I("",!0)])}const Je=h(Ze,[["render",qe],["__scopeId","data-v-d9bfb22d"]]),Ge={props:{hashtag:{type:String,default:""}},emits:["hashtag-click"],methods:{onClick(o){this.$emit("hashtag-click",{event:o,hashtag:this.hashtag.slice(1)})}}};function et(o,e,n,t,s,a){return u(),_("a",{href:"#",onClick:e[0]||(e[0]=(...c)=>a.onClick&&a.onClick(...c))},y(n.hashtag),1)}const tt=h(Ge,[["render",et]]);class D{constructor(e,n){this.x=e,this.y=n,this.key=String(Math.random())}}class H extends D{constructor(e,n){super(e,n),this.itemType="kabe"}}class B extends D{constructor(e,n){super(e,n),this.itemType="box"}}class nt extends D{constructor(e,n){super(e,n),this.itemType="target"}}class ot extends D{constructor(e,n){super(e,n),this.itemType="neko"}}class st{constructor(e){this.instance=[],this.neko=null,this.boxs=[],this.targets=[];for(let n=0;n<e.length;n++){const t=e[n],s=[];this.instance.push(s);for(let a=0;a<t.length;a++){const c=t[a];let i=null;for(const d of c.split(""))switch(d){case"k":{i=new H(a,n);break}case"x":{const r=new B(a,n);this.boxs.push(r),i=r;break}case"o":{this.targets.push(new nt(a,n));break}case"s":{const r=new ot(a,n);this.neko=r,i=r;break}}s.push(i)}}}getItem({x:e,y:n}){var t;return(t=this.instance[n])==null?void 0:t[e]}getDirectionCoordinate({x:e,y:n},t){switch(t){case"2":{n=n+1;break}case"4":{e=e-1;break}case"6":{e=e+1;break}case"8":{n=n-1;break}}return{x:e,y:n}}getNextItem({x:e,y:n},t){const s=this.getItem(this.getDirectionCoordinate({x:e,y:n},t));return s===void 0||s instanceof H?!1:s}moveItem({x:e,y:n},t){const s=this.getItem({x:e,y:n}),a=this.getDirectionCoordinate({x:e,y:n},t);s.x=a.x,s.y=a.y,this.instance[n][e]=null,this.instance[a.y][a.x]=s}}let ct=class{constructor(e){this.map=new st(e)}get neko(){return this.map.neko}operate(e){const n=this.map.getNextItem(this.neko,e);if(n===!1)return!1;if(n===null&&this.map.moveItem(this.neko,e),n instanceof B){if(this.map.getNextItem(n,e)!==null)return!1;this.map.moveItem(n,e)}}check(){return!this.map.targets.some(e=>!(this.map.getItem(e)instanceof B))}};const rt={components:{AsyncButtom:oe},props:{map:{type:String,default:()=>""}},setup(o){const e=g(null),n=g(50),t=g(!1),s=function(){let r=[];const l=[];for(const p of o.map.split(","))p==="n"?(l.push(r),r=[]):r.push(p);e.value=O(new ct(l)),t.value=!1};s();const a=function(r){r.preventDefault();const l={38:"8",104:"8",39:"6",102:"6",37:"4",100:"4",40:"2",98:"2"}[String(r.keyCode)];e.value.operate(l),t.value=e.value.check()},c=function(r,l){const p=e.value.neko;r-p.x===0&&l-p.y===1&&e.value.operate("2"),r-p.x===0&&l-p.y===-1&&e.value.operate("8"),r-p.x===1&&l-p.y===0&&e.value.operate("6"),r-p.x===-1&&l-p.y===0&&e.value.operate("4"),t.value=e.value.check()},i=M(()=>{var r,l;return((l=(r=e.value)==null?void 0:r.map)==null?void 0:l.targets)||[]}),d=function(r,l){return i.value.some(p=>p.x===r&&p.y===l)};return{mapInstance:M(()=>{var r,l;return((l=(r=e.value)==null?void 0:r.map)==null?void 0:l.instance)||[]}),isTarget:d,size:n,reset:s,congratulations:t,keyupHandler:a,touchMove:c}}},at=o=>(Y("data-v-3a079840"),o=o(),Z(),o),it={class:"sokoban-box"},lt=["onClick"],ut={key:0,class:"congratulations"},dt=at(()=>m("div",{class:"mask"}," 点击开始 ",-1)),_t={class:"buttons"};function pt(o,e,n,t,s,a){const c=w("AsyncButtom");return u(),_("div",it,[m("div",{class:"sokoban",tabIndex:"-1",onKeydown:e[0]||(e[0]=$(i=>{i.preventDefault()},["stop"])),onKeypress:e[1]||(e[1]=$(i=>{i.preventDefault()},["stop"])),onKeyup:e[2]||(e[2]=$((...i)=>t.keyupHandler&&t.keyupHandler(...i),["stop"]))},[(u(!0),_(v,null,A(t.mapInstance,(i,d)=>(u(),_("div",{key:d,class:"row"},[(u(!0),_(v,null,A(i,(r,l)=>(u(),_("div",{key:(r==null?void 0:r.key)||l+d,class:S(["col",{[(r==null?void 0:r.itemType)||"empty"]:!0,target:t.isTarget(l,d)}]),style:W({width:`${t.size}px`,height:`${t.size}px`}),onClick:()=>{t.touchMove(l,d)}},[(r==null?void 0:r.itemType)==="neko"?(u(),_(v,{key:0},[L(" 😾 ")],64)):(r==null?void 0:r.itemType)==="box"?(u(),_(v,{key:1},[L(" 📦 ")],64)):I("",!0)],14,lt))),128))]))),128)),t.congratulations?(u(),_("div",ut," 通关 ")):I("",!0),dt],32),m("div",_t,[T(c,{type:"primary",onLoadingClick:t.reset},{default:K(()=>[L(" 重置 ")]),_:1},8,["onLoadingClick"])])])}const mt=h(rt,[["render",pt],["__scopeId","data-v-3a079840"]]),gt={components:{Sokoban:mt},props:{content:{type:Array,default:()=>[]}}},ft={key:1};function ht(o,e,n,t,s,a){const c=w("Sokoban");return u(),_("div",null,[n.content[0]==="sokoban"?(u(),V(c,{key:0,map:n.content[1]},null,8,["map"])):(u(),_("span",ft,"[component "+y(n.content)+" not found]",1))])}const yt=h(gt,[["render",ht]]);function j(o,e){return function(n){const{tokens:t}=n;for(const s of t){if(s.type!=="inline")continue;const a=[],c=[];for(const i of s.children){if(i.type.endsWith("_open")){const d=i.type.slice(0,i.type.indexOf("_open"));c.push(d)}if(i.type.endsWith("_close")&&c.pop(),i.type==="text"&&o.test(i.content)){const d=i.content;let r=0;if(d.replace(new RegExp(o,"g"),function(...l){const[p]=l,b=e(p,c);if(b!==!1){const k=l[l.length-2];if(k>r){const N=new x("text","",0);N.content=d.slice(r,k),a.push(N)}r=k+p.length,a.push(b)}}),r<d.length){const l=new x("text","",0);l.content=d.slice(r),a.push(l)}}else a.push(i)}s.children=a}}}function bt(o){return j(/(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/,n=>{const t=new x("emoji","",0);return t.markup=n,t.content=n,t})}function kt(o,e){o.core.ruler.after("linkify","emoji",bt())}function vt(o){const e=/\[((music)|(youtube)|(bilibili)|(emoji)|(video)) (.*?)\]/;return j(e,n=>{const t=n.match(e),s=new x("media","",0);return s.markup=n,s.content=n,s.block=!0,s.info=t[1],s})}function wt(o,e){o.core.ruler.after("text_join","media",vt())}function xt(o){return j(/#(\S*)/,(n,t)=>{if(t[t.length-1]==="link")return!1;const s=new x("hashtag","",0);return s.markup=n,s.content=n,s})}function $t(o,e){o.core.ruler.after("linkify","hashtag",xt())}function It(o){const e=/\[component (.*?) (.*?)\]/;return j(e,n=>{const t=n.match(e),s=new x("component","",0);return s.markup=n,s.content=n,s.block=!0,s.info=t.slice(1),s})}function St(o,e){o.core.ruler.after("text_join","component",It())}const C=new Q({breaks:!0});C.use(kt);C.use(wt);C.use($t);C.use(St);const Ct={props:{modelValue:{type:String,default:()=>""}},emits:["hashtag-click"],setup(o,e){const n=function(a){const c=[],i=[];for(let d=0;d<a.length;d++){const r=a[d];if(r.type.endsWith("_open")){const l=r.type.slice(0,r.type.indexOf("_open"));i.push({type:l,tag:r.tag,block:r.block,content:"",attrs:r.attrs,children:[]});continue}if(r.type.endsWith("_close")){if(i.length>1){const l=i.pop();i[i.length-1].children.push(l)}else c.push(i.pop());continue}if(i.length>0){const l=i[i.length-1];l.content=r.content,r.type==="inline"?l.children.push(...n(r.children)):l.children.push(r)}else c.push(r)}return c},t=function(a){return a.map(c=>{var d,r;const i=((d=c.attrs)==null?void 0:d.reduce((l,p)=>{const[b,k]=p;return l[b]?Array.isArray(l[b])?l[b].push(k):l[b]=[l[b],k]:l[b]=k,l},{}))||{};switch(c.type){case"text":return c.content;case"emoji":return f(Me,{...i,emoji:c.content,key:c.content},"");case"hashtag":return f(e.slots.hashtag??tt,{...i,hashtag:c.content,key:c.content,onHashtagClick:l=>{e.emit("hashtag-click",l)}},"");case"media":{switch(c.info){case"bilibili":return f(Ae,{...i,content:c.content,key:c.content},"");case"youtube":return f(He,{...i,content:c.content,key:c.content},"");case"music":return f(Ye,{...i,content:c.content,key:c.content},"");case"emoji":return f(Je,{...i,content:c.content,key:c.content},"");case"video":return f(_e,{...i,content:c.content,key:c.content},"")}break}case"link":return f(c.tag,{...i,target:"_blank"},t(c.children));case"image":return f(ae,{src:i.src,alt:c.content,key:c.content},"");case"fence":return f(ke,{...i,lang:c.info||"text",content:c.content,key:c.content},"");case"component":return f(yt,{...i,content:c.info,key:c.content},"");default:return f(c.tag||"span",i,((r=c.children)==null?void 0:r.length)>0?t(c.children):c.content)}})},s=X(o,"modelValue");return()=>{const a=n(C.parse(s.value,{}));return f("div",{class:"markdown-body"},t(a))}}},Lt=h(Ct,[["__scopeId","data-v-2ee9615e"]]);export{Lt as M};
