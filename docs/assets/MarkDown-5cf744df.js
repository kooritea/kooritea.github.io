import{cd as w,aL as g,aM as p,br as x,bs as L,aU as u,aS as D,ce as R,aN as d,bt as f,bm as C,bP as V,bj as I,bn as S,bk as T,bl as E,bo as P,cx as k,cy as F,a$ as O,c4 as m}from"./vendor-c051abc1.js";import{I as B}from"./ImageCon-659f1a01.js";import{_ as y,S as H,o as W,u as N,h as U,w as q,p as z,L as A,q as Y}from"./index-b2eba1b7.js";const Z={components:{ImageCon:B},props:{src:{type:String,default:()=>""},alt:{type:String,default:()=>""},srcPreFix:{type:[Array,String],default:()=>["https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://fastly.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://raw.githubusercontent.com/kooritea/kooritea.github.io/img"]}}},G={class:"md-image"};function J(s,n,t,e,r,i){const o=w("ImageCon");return g(),p("div",G,[x(o,{ref:"ImageCon",src:t.src,prefix:t.srcPreFix,alt:t.alt||t.src,onClick:n[0]||(n[0]=c=>s.$imagePreview(s.$refs.ImageCon.applySrc)),onDragstart:n[1]||(n[1]=L(()=>{},["prevent"]))},null,8,["src","prefix","alt"])])}const K=y(Z,[["render",J],["__scopeId","data-v-0e70f206"]]);const Q={components:{SvgIcon:H},directives:{"safe-html":W},props:{content:{type:String,required:!0},lang:{type:String,default:""}},setup(s){const{darkMode:n}=N(),t=u(!1);let e=null;return U(()=>import("./highlightjs-4914df6f.js").then(r=>r.i),[],import.meta.url).then(r=>{t.value=!0,e=r.default}),{darkMode:n,highlightCode:D(()=>{if(t.value&&e.getLanguage(s.lang.toLowerCase()))return e.highlight(s.content,{language:s.lang.toLowerCase()}).value;{const r=document.createElement("div");return r.innerHTML=s.content,r.innerText}}),lineCount:D(()=>s.content.split(`
`).length-1)}},methods:{writeTextToClipboard(){q(this.content),this.$msgBox.success("复制成功")}}},X={class:"code-block"},ee={class:"code-meta"},te={class:"lang"},ne={class:"code"},oe={class:"line-numbers"};function se(s,n,t,e,r,i){const o=w("SvgIcon"),c=R("safe-html");return g(),p("div",X,[d("div",ee,[d("span",te,f(`${t.lang.slice(0,1).toUpperCase()}${t.lang.slice(1)}`),1),d("span",{class:"copy",onClick:n[0]||(n[0]=(..._)=>i.writeTextToClipboard&&i.writeTextToClipboard(..._))},[x(o,{name:"icon-copy"})])]),d("div",ne,[d("div",oe,[(g(!0),p(C,null,V(new Array(e.lineCount).fill(""),(_,a)=>(g(),p("div",{key:a,class:"number"},f(a+1),1))),128))]),I(d("pre",{class:S(["hljs",{dark:e.darkMode,light:!e.darkMode}])},null,2),[[c,e.highlightCode]])])])}const re=y(Q,[["render",se],["__scopeId","data-v-6f8d75a1"]]);const ce=String.fromCharCode(8205),ie=/\uFE0F/g,ae=(s,n="-")=>{const t=[];let e=0,r=0,i=0;for(;i<s.length;)e=s.charCodeAt(i++),r?(t.push((65536+(r-55296<<10)+(e-56320)).toString(16)),r=0):e>=55296&&e<=56319?r=e:t.push(e.toString(16));return t.join(n)};function le(s){return ae(s.indexOf(ce)<0?s.replace(ie,""):s)}const de={components:{ImageCon:B},props:{emoji:{type:String,default:""}},setup(s){const n=u(!1),e=`/${le(s.emoji)}.png`;return{showEmojiImg:n,imgSrc:e}}},ue={key:0};function _e(s,n,t,e,r,i){const o=w("ImageCon");return g(),p(C,null,[I(x(o,{class:"emoji",src:e.imgSrc,prefix:["https://cdn.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://fastly.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://raw.githubusercontent.com/twitter/twemoji/assets/72x72"],alt:t.emoji,onLoad:n[0]||(n[0]=c=>e.showEmojiImg=!0)},null,8,["src","prefix","alt"]),[[T,e.showEmojiImg]]),e.showEmojiImg?E("",!0):(g(),p("span",ue,f(t.emoji),1))],64)}const ge=y(de,[["render",_e],["__scopeId","data-v-2dd6e819"]]);const pe={props:{content:{type:String,default:""}},setup(s){const n=s.content.match(/\[bilibili ((av|bv|AV|BV)[a-zA-Z0-9]+)?( p.*?)?\]/),t=n[1],e=((n?n[3]:"")||"").slice(2),r=u(`https://player.bilibili.com/player.html?bvid=${t}${e?"?page="+e:""}`),i=u(`https://www.bilibili.com/video/${t}${e?"?p="+e:""}`),o=u(!0);return{playerSrc:r,webSiteSrc:i,loading:o,id:u(t)}}},me=["href"],he=["src"];function fe(s,n,t,e,r,i){return g(),p("div",null,[d("p",null,[d("a",{class:"link",href:e.webSiteSrc,target:"_blank"},f(e.id),9,me)]),d("iframe",{src:e.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:S(["bilibili-player",{loading:e.loading}]),onLoad:n[0]||(n[0]=o=>e.loading=!1)},null,42,he)])}const ye=y(pe,[["render",fe],["__scopeId","data-v-c2f21cd0"]]);const ve={props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[youtube (.*?)\]/)[1],e=u(`https://www.youtube.com/embed/${t}`),r=u(`https://www.youtube.com/watch?v=${t}`),i=u(!0);return{playerSrc:e,webSiteSrc:r,loading:i,id:u(t)}}},be=["href"],ke=["src"];function we(s,n,t,e,r,i){return g(),p("div",null,[d("p",null,[d("a",{class:"link",href:e.webSiteSrc,target:"_blank"},f(e.id),9,be)]),d("iframe",{src:e.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:S(["youtube-player",{loading:e.loading}]),onLoad:n[0]||(n[0]=o=>e.loading=!1)},null,42,ke)])}const Se=y(ve,[["render",we],["__scopeId","data-v-40b9d9a4"]]);function $e(s){return z({url:`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/music/${s}.mp3`,responseType:"arraybuffer"}).then(n=>{const[t,e]=s.split("-");return U(()=>import("./vendor-c051abc1.js").then(r=>r.i),["https://kooritea.moe/assets/vendor-c051abc1.js","https://kooritea.moe/assets/highlightjs-4914df6f.js"],import.meta.url).then(r=>{const i=r.default,c=new i(n).ID3V2.findLabel("APIC");return{picUrl:c?URL.createObjectURL(new Blob([c.content.pictureBuffer])):"",name:t,singer:e,id:s,getPlayUrl:async()=>URL.createObjectURL(new Blob([n],{type:"audio/mp3"}))}})})}const xe={components:{LoadingIcon:A},props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[music (.*?)\]/)[1],e=u({}),r=u(!0),i=u("");return(t.startsWith("private")?$e(t.slice(8)):Y(t)).then(o=>{e.value=o}).catch(o=>{i.value=o.message}).finally(()=>{r.value=!1}),{loading:r,error:i,id:u(t),music:e}},methods:{onClick(){this.loading||this.error||this.music.getPlayUrl().then(s=>{window.open(s,"_blank")})}}},Ce={key:1,class:"error-msg"},Ie=["src"],je={class:"info"},Me=["title"],De=["title"];function Le(s,n,t,e,r,i){const o=w("LoadingIcon");return g(),p("div",{class:"music-player-simple",onClick:n[0]||(n[0]=(...c)=>i.onClick&&i.onClick(...c))},[e.loading?(g(),P(o,{key:0})):e.error?(g(),p("div",Ce,f(e.error),1)):(g(),p(C,{key:2},[d("img",{class:"music-player-simple-pic",src:e.music.picUrl},null,8,Ie),d("div",je,[d("p",{class:"song-name",title:e.music.name},"🎶"+f(e.music.name),9,Me),d("p",{class:"singer-name",title:e.music.singer},f(e.music.singer),9,De)])],64))])}const Te=y(xe,[["render",Le],["__scopeId","data-v-e934a6f1"]]);const Ee={components:{LoadingIcon:A},props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[emoji (.*?)\]/)[1],e=u(`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/emoji/${t}.png`),r=u(!0);return{id:u(t),loading:r,imageSrc:e}}},Pe={class:"md-sticker"},Be=["src","alt"];function Ue(s,n,t,e,r,i){const o=w("LoadingIcon");return g(),p("div",Pe,[e.loading?(g(),P(o,{key:0,class:"loading"})):E("",!0),I(d("img",{class:S(["sticker-image",{"sticker-image-loading":e.loading}]),src:e.imageSrc,alt:e.id||s.src,onLoad:n[0]||(n[0]=c=>e.loading=!1),onDragstart:n[1]||(n[1]=L(()=>{},["prevent"]))},null,42,Be),[[T,!e.loading]])])}const Ae=y(Ee,[["render",Ue],["__scopeId","data-v-d3b6fa8d"]]),Re={props:{hashtag:{type:String,default:""}},emits:["hashtag-click"],methods:{onClick(s){this.$emit("hashtag-click",{event:s,hashtag:this.hashtag.slice(1)})}}};function Ve(s,n,t,e,r,i){return g(),p("a",{href:"#",onClick:n[0]||(n[0]=(...o)=>i.onClick&&i.onClick(...o))},f(t.hashtag),1)}const Fe=y(Re,[["render",Ve]]);function j(s,n){return function(t){const{tokens:e}=t;for(const r of e){if(r.type!=="inline")continue;const i=[],o=[];for(const c of r.children){if(c.type.endsWith("_open")){const _=c.type.slice(0,c.type.indexOf("_open"));o.push(_)}if(c.type.endsWith("_close")&&o.pop(),c.type==="text"&&s.test(c.content)){const _=c.content;let a=0;if(_.replace(new RegExp(s,"g"),function(...l){const[b]=l,h=n(b,o);if(h!==!1){const v=l[l.length-2];if(v>a){const M=new k("text","",0);M.content=_.slice(a,v),i.push(M)}a=v+b.length,i.push(h)}}),a<_.length){const l=new k("text","",0);l.content=_.slice(a),i.push(l)}}else i.push(c)}r.children=i}}}function Oe(s){return j(/(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/,t=>{const e=new k("emoji","",0);return e.markup=t,e.content=t,e})}function He(s,n){s.core.ruler.after("linkify","emoji",Oe())}function We(s){const n=/\[((music)|(youtube)|(bilibili)|(emoji)) (.*?)\]/;return j(n,t=>{const e=t.match(n),r=new k("media","",0);return r.markup=t,r.content=t,r.block=!0,r.info=e[1],r})}function Ne(s,n){s.core.ruler.after("text_join","media",We())}function qe(s){return j(/#(\S*)/,(t,e)=>{if(e[e.length-1]==="link")return!1;const r=new k("hashtag","",0);return r.markup=t,r.content=t,r})}function ze(s,n){s.core.ruler.after("linkify","hashtag",qe())}const $=new F({breaks:!0});$.use(He);$.use(Ne);$.use(ze);const Ye={props:{modelValue:{type:String,default:()=>""}},emits:["hashtag-click"],setup(s,n){const t=function(i){const o=[],c=[];for(let _=0;_<i.length;_++){const a=i[_];if(a.type.endsWith("_open")){const l=a.type.slice(0,a.type.indexOf("_open"));c.push({type:l,tag:a.tag,block:a.block,content:"",attrs:a.attrs,children:[]});continue}if(a.type.endsWith("_close")){if(c.length>1){const l=c.pop();c[c.length-1].children.push(l)}else o.push(c.pop());continue}if(c.length>0){const l=c[c.length-1];l.content=a.content,a.type==="inline"?l.children.push(...t(a.children)):l.children.push(a)}else o.push(a)}return o},e=function(i){return i.map(o=>{var _,a;const c=((_=o.attrs)==null?void 0:_.reduce((l,b)=>{const[h,v]=b;return l[h]?Array.isArray(l[h])?l[h].push(v):l[h]=[l[h],v]:l[h]=v,l},{}))||{};switch(o.type){case"text":return o.content;case"emoji":return m(ge,{...c,emoji:o.content,key:o.content},"");case"hashtag":return m(n.slots.hashtag??Fe,{...c,hashtag:o.content,key:o.content,onHashtagClick:l=>{n.emit("hashtag-click",l)}},"");case"media":{switch(o.info){case"bilibili":return m(ye,{...c,content:o.content,key:o.content},"");case"youtube":return m(Se,{...c,content:o.content,key:o.content},"");case"music":return m(Te,{...c,content:o.content,key:o.content},"");case"emoji":return m(Ae,{...c,content:o.content,key:o.content},"")}break}case"link":return m(o.tag,{...c,target:"_blank"},e(o.children));case"image":return m(K,{src:c.src,alt:o.content,key:o.content},"");case"fence":return m(re,{...c,lang:o.info||"text",content:o.content,key:o.content},"");default:return m(o.tag||"span",c,((a=o.children)==null?void 0:a.length)>0?e(o.children):o.content)}})},r=O(s,"modelValue");return()=>{const i=t($.parse(r.value,{}));return m("div",{class:"markdown-body"},e(i))}}},Ke=y(Ye,[["__scopeId","data-v-dd808ed6"]]);export{Ke as M};
