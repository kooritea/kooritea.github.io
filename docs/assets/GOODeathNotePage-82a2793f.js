import{_ as V,B as D,L,A as E,a as M}from"./index-ef7d5979.js";import{P as O}from"./PageHeader-bc91e2a8.js";import{g as A,h as T,e as z,f as H}from"./element-plus-a60f317a.js";import{f as R,h as w,i as U}from"./GreatOldOne-b7c1b0b9.js";import{aU as y,bx as C,aS as k,aX as Q,cd as r,aL as B,aM as X,br as n,bp as s,bo as G,bl as I,bQ as x,aN as N,bt as S}from"./vendor-d6409d70.js";import"./highlightjs-4914df6f.js";const j={components:{ButtonBox:D,LoadingIcon:L,AsyncButtom:E,PageHeader:O,ElTable:A,ElTableColumn:T,ElRadioGroup:z,ElRadio:H},setup(){const a=y("/"),l=y("kooritea.github.io"),h=C({}),t=C({}),i=k(()=>l.value==="kooritea.github.io"?h:t),d=y(!1),u=C([]),{devMode:_}=M(),c=k(()=>({repo:_.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),b=e=>{u.splice(0,u.length),u.push(...e)},p=k(()=>{const e=[...i.value[a.value]||[]];return!d.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),o=(e,m)=>{if(a.value=e,!i.value[e]||m)return i.value[e]=void 0,d.value=!0,R({...c.value,path:e}).then(v=>{v.type==="dir"&&(i.value[e]=[...v.children.filter(g=>g.type==="dir"),...v.children.filter(g=>g.type==="file")])}).finally(()=>{d.value=!1})};o("/"),Q(l,()=>{o("/")});const f=e=>w({...c.value,files:e.map(m=>({isDel:!0,path:m.path}))}).then(()=>o(a.value,!0));return{onSelectionChange:b,repoConfig:c,tableData:p,loadPath:o,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>U({...c.value,branch:void 0,file:e[0]}).then(({sha:m})=>w({...c.value,files:[{sha:m,path:`${a.value}/${e[0].name}`}]}).then(()=>o(a.value,!0)))},{name:"删除选中的项",type:"danger",disabled:()=>u.length===0,handler:()=>f(u)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in i.value)delete i.value[e];return o("/")}}],deleteItem:f,database:l}},methods:{onCellClick(a,l,h,t){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},q={class:"page"};function F(a,l,h,t,i,d){const u=r("PageHeader"),_=r("el-radio"),c=r("el-radio-group"),b=r("LoadingIcon"),p=r("el-table-column"),o=r("AsyncButtom"),f=r("el-table"),P=r("ButtonBox");return B(),X("div",q,[n(u),n(c,{modelValue:t.database,"onUpdate:modelValue":l[0]||(l[0]=e=>t.database=e)},{default:s(()=>[n(_,{label:"kooritea.github.io",size:"large"},{default:s(()=>[x("公开库")]),_:1}),n(_,{label:"private-database",size:"large"},{default:s(()=>[x("私有库")]),_:1})]),_:1},8,["modelValue"]),n(f,{border:"",data:t.tableData,style:{width:"100%"},onCellClick:d.onCellClick,onSelectionChange:t.onSelectionChange},{empty:s(()=>[N("div",null,[n(b)])]),default:s(()=>[n(p,{type:"selection",selectable:e=>e.type==="file"},null,8,["selectable"]),n(p,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{default:s(e=>[N("span",null,S(e.row.type==="dir"?"📁":"📄")+S(e.row.name),1)]),_:1}),n(p,{label:"操作",width:"120px"},{default:s(e=>[e.row.type==="file"?(B(),G(o,{key:0,type:"danger",size:"mini","on-click":()=>t.deleteItem([e.row])},{default:s(()=>[x("删除")]),_:2},1032,["on-click"])):I("",!0)]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),t.handlers.length>0?(B(),G(P,{key:0,handlers:t.handlers},null,8,["handlers"])):I("",!0)])}const ee=V(j,[["render",F],["__scopeId","data-v-011f7821"]]);export{ee as default};
