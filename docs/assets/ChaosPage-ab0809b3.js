import{_ as I,L as b,a as P,S as C,u as N,b as w,f as O,e as H,s as T,c as K,h as V,i as U}from"./index-3e281d45.js";import{P as W}from"./PageHeader-b568aee9.js";import{k as j,r as h,p as G,v as Y,ai as y,o as i,e as r,ag as q,Z as k,f as v,a0 as E,V as B,J as z,T as L,X as S,$ as M,W as g,aB as A,U as F,as as J}from"./vendor-eddec4a0.js";import{M as R}from"./MarkDown-5ceeeb93.js";import{a as X}from"./element-plus-e4e3d2c3.js";import{u as Z}from"./GreatOldOne-ff416370.js";import"./highlightjs-b0208cd2.js";import"./ImageCon-d6be41bb.js";const Q={components:{LoadingIcon:b},props:{hasNext:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},onClick:{type:Function,required:!0}},setup(s,{emit:o}){const{computedHasNext:n,computedLoading:e}=P(s,o),m=j(()=>!s.hasNext||e.value),u=()=>{if(!m.value)try{e.value=!0;const a=s.onClick(e.value);a instanceof Promise?a.then(d=>{typeof(d==null?void 0:d.hasNext)=="boolean"&&(n.value=d.hasNext)}).finally(()=>{e.value=!1}):(typeof(a==null?void 0:a.hasNext)=="boolean"&&(n.value=a.hasNext),e.value=!1)}catch{e.value=!1}},l=h(30);let c=null;const _=a=>{if(m.value)return;const{scrollTop:d,clientHeight:x,scrollHeight:D}=document.documentElement;if(a>0&&Math.abs(D-(d+x))<60){if(l.value--,l.value===0){l.value=30,u();return}c&&clearTimeout(c),c=setTimeout(()=>{l.value=30},500)}},p=a=>{_(a.deltaY)};let f=null;const t=a=>{if(a.touches.length===1){const d=a.touches[0];if(!f){f=d.pageY;return}_((d.pageY-f)/5)}};return G(()=>{window.addEventListener("wheel",p),window.addEventListener("touchmove",t)}),Y(()=>{window.removeEventListener("wheel",p),window.addEventListener("touchmove",t)}),{computedLoading:e,nextOffset:l,clickHandler:u,disabled:m}}},$={key:0,class:"loading"},ee={key:1},se={key:2};function oe(s,o,n,e,m,u){const l=y("LoadingIcon");return i(),r("div",{class:B(["next-button",{disabled:e.disabled,loading:e.computedLoading}]),onClick:o[0]||(o[0]=(...c)=>e.clickHandler&&e.clickHandler(...c))},[e.computedLoading?(i(),r("span",$,[q(" 加载中 "),k(l)])):n.hasNext?(i(),r("span",ee,"下滑加载更多")):(i(),r("span",se,"没有更多")),v("div",{class:"next-mask",style:E({top:`${e.nextOffset}px`})},[v("span",{class:"next-mask-text",style:E({top:`-${e.nextOffset}px`})}," 下滑加载更多 ",4)],4)],2)}const te=I(Q,[["render",oe],["__scopeId","data-v-8ec8db8a"]]);const ne={components:{SvgIcon:C},setup(){return{isSimplifty:h(!1)}},mounted(){this.$el.offsetHeight>600&&(this.isSimplifty=!0)}},ae={key:0,class:"simplifty-mask"};function ie(s,o,n,e,m,u){const l=y("SvgIcon");return i(),r("div",{class:B(["simplifty-box",{"is-simplifty":e.isSimplifty}])},[z(s.$slots,"default",{},void 0,!0),e.isSimplifty?(i(),r("div",ae,[k(l,{name:"icon-zhankai",class:"expend-button",onClick:o[0]||(o[0]=c=>e.isSimplifty=!1)})])):L("",!0)],2)}const le=I(ne,[["render",ie],["__scopeId","data-v-72bf6d9a"]]);const de={components:{Markdown:R,SimpliftyBox:le,LoadingIcon:b,"el-popover":X},props:{essay:{type:Object,required:!0},essayMap:{type:Object,required:!0},inPopover:{type:Boolean,default:!1}},emits:["set-search-key-word","load-essay-by-id"],setup(){const{darkMode:s}=N(),{darkModeDecodeKey:o}=w();return{darkMode:s,decodeHide:e=>H(e,o.value),formatDate:O,Error}}},ce={class:"essay"},re=["onClick"],ue={class:"hashtag"},ye={key:0,class:"loading-box"},_e={key:1},me={class:"info"},fe={class:"essay-id"};function pe(s,o,n,e,m,u){const l=y("LoadingIcon"),c=y("ChaosItem",!0),_=y("el-popover"),p=y("Markdown"),f=y("SimpliftyBox");return i(),r("div",ce,[v("article",{class:B(["article",{"in-popover":n.inPopover}])},[k(f,null,{default:S(()=>[k(p,{"model-value":e.darkMode&&n.essay.hide?e.decodeHide(n.essay.hide):n.essay.content},{hashtag:S(({hashtag:t})=>[!/^#\d+$/.test(t)||n.inPopover?(i(),r("span",{key:0,class:"hashtag",onClick:a=>s.$emit("set-search-key-word",t)},M(t),9,re)):(i(),g(_,{key:1,width:"",trigger:"click","popper-class":"popper-essay",effect:e.darkMode?"dark":"light",onShow:()=>{n.essayMap[t.slice(1)]||s.$emit("load-essay-by-id",t.slice(1))}},{reference:S(()=>[v("span",ue,M(t),1)]),default:S(()=>[!n.essayMap[t.slice(1)]||n.essayMap[t.slice(1)]instanceof e.Error?(i(),r("div",ye,[n.essayMap[t.slice(1)]?(i(),r("span",_e,M(n.essayMap[t.slice(1)].message),1)):(i(),g(l,{key:0}))])):(i(),g(c,{key:1,essay:n.essayMap[t.slice(1)],"essay-map":n.essayMap,"in-popover":!0,onSetSearchKeyWord:o[0]||(o[0]=a=>{s.$emit("set-search-key-word",a)})},null,8,["essay","essay-map"]))]),_:2},1032,["effect","onShow"]))]),_:1},8,["model-value"])]),_:1})],2),v("div",me,[v("span",fe,"#"+M(n.essay.id),1),v("span",null,M(e.formatDate(n.essay.time,`yyyy-MM-dd HH:mm:ss UTC ${e.darkMode?"NDD":"DD"}`)),1)])])}const he=I(de,[["render",pe],["__scopeId","data-v-4ba51001"]]);const ve={components:{ChaosItem:he,PageHeader:W,NextButton:te,SvgIcon:C,MDEditor:A({loader:()=>U(()=>import("./MDEditor-57342940.js"),["https://kooritea.moe/assets/MDEditor-57342940.js","https://kooritea.moe/assets/vendor-eddec4a0.js","https://kooritea.moe/assets/highlightjs-b0208cd2.js","https://kooritea.moe/assets/highlightjs-5f5db245.css","https://kooritea.moe/assets/index-3e281d45.js","https://kooritea.moe/assets/element-plus-e4e3d2c3.js","https://kooritea.moe/assets/element-plus-738b1dab.css","https://kooritea.moe/assets/index-c5ecc729.css","https://kooritea.moe/assets/MarkDown-5ceeeb93.js","https://kooritea.moe/assets/ImageCon-d6be41bb.js","https://kooritea.moe/assets/ImageCon-7d9a0f92.css","https://kooritea.moe/assets/MarkDown-3376e058.css","https://kooritea.moe/assets/GreatOldOne-ff416370.js","https://kooritea.moe/assets/MDEditor-14b2419b.css"],import.meta.url),loadingComponent:b})},setup(){const s=h({}),{darkMode:o,isGreatOldOne:n}=N(),{offlineMode:e,darkModeDecodeKey:m}=w(),u=h(""),l=h([]),c=h(!1),_=h(!1),p=h(null),f=a=>H(a,m.value),t=a=>(_.value=!0,V(a).then(d=>{d=d.map(x=>(s.value[x.id]=x,{...x,expend:!1})),c.value=d.length===10,l.value.push(...d)}).finally(()=>{_.value=!1}));return t(),{loading:_,searchBlogEssays:t,essays:l,searchKeyWord:u,offlineMode:e,hasNext:c,darkMode:o,essayMap:s,setScorllGotoTop:T,isGreatOldOne:n,editing:p,decodeHide:f}},methods:{search(s){if(this.essays=[],this.offlineMode&&s&&!/^#\d+$/.test(s)){this.$msgBox.error("离线模式下仅可以使用id搜索");return}return this.searchBlogEssays({keyword:s})},onNext(){var o;const s=(o=this.essays[this.essays.length-1])==null?void 0:o.id;return this.searchBlogEssays({keyword:this.searchKeyWord,start:s?s-1:void 0})},loadEssayById(s){if(this.essayMap[s]!==null)return this.essayMap[s]=null,K({id:s}).then(o=>{this.essayMap[s]=o}).catch(o=>{this.essayMap[s]=new Error(o)})},onSubmitUpdateEssay(s,o,n){return Z(s.id,{content:o?void 0:n,hide:o?n:void 0}).then(e=>{Object.assign(s,e),this.editing=null})}}},ge={class:"page"};function ke(s,o,n,e,m,u){const l=y("PageHeader"),c=y("ChaosItem"),_=y("MDEditor"),p=y("SvgIcon"),f=y("NextButton");return i(),r("div",ge,[k(l,{modelValue:e.searchKeyWord,"onUpdate:modelValue":o[0]||(o[0]=t=>e.searchKeyWord=t),"show-search-input":!0,"on-change":u.search},null,8,["modelValue","on-change"]),v("ul",null,[(i(!0),r(F,null,J(e.essays,t=>(i(),r("li",{key:t.id,class:"essay-box"},[e.editing!==t?(i(),g(c,{key:0,essay:t,"essay-map":e.essayMap,onSetSearchKeyWord:o[1]||(o[1]=a=>{e.searchKeyWord=a,e.setScorllGotoTop()}),onLoadEssayById:u.loadEssayById},null,8,["essay","essay-map","onLoadEssayById"])):(i(),g(_,{key:1,"model-value":e.darkMode?e.decodeHide(t.hide):t.content,cache:!1,"ex-handlers":[{name:"取消",handler:()=>{e.editing=null}}],"on-submit":a=>u.onSubmitUpdateEssay(t,e.darkMode,a)},null,8,["model-value","ex-handlers","on-submit"])),e.isGreatOldOne&&e.editing!==t?(i(),g(p,{key:2,name:"icon-bianji",onClick:a=>e.editing=t},null,8,["onClick"])):L("",!0)]))),128))]),k(f,{hasNext:e.hasNext,"onUpdate:hasNext":o[2]||(o[2]=t=>e.hasNext=t),loading:e.loading,"onUpdate:loading":o[3]||(o[3]=t=>e.loading=t),"on-click":u.onNext},null,8,["hasNext","loading","on-click"])])}const Ne=I(ve,[["render",ke],["__scopeId","data-v-c94f001e"]]);export{Ne as default};
