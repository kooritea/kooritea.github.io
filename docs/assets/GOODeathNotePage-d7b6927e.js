import{_ as S,B as E,L as A,A as N,a as O,E as M,x as B,F as G,G as T,H as z}from"./index-6dfeff5e.js";import{P as R}from"./PageHeader-e97f8a21.js";import{h as F,i as Z,f as $,g as Q}from"./element-plus-88343e01.js";import{b7 as k,bH as w,a$ as x,b1 as U,cf as s,aQ as b,aR as I,bC as i,bw as p,bv as L,bz as j,aZ as q,bZ as J,bA as V,bB as P,aS as H}from"./vendor-23d2f8cc.js";import"./highlightjs-4914df6f.js";const K={components:{ButtonBox:E,LoadingIcon:A,AsyncButtom:N,PageHeader:R,ElTable:F,ElTableColumn:Z,ElRadioGroup:$,ElRadio:Q},setup(){const a=k("/"),l=k("kooritea.github.io"),h=w({}),n=w([{label:"公开库",value:"kooritea.github.io"},{label:"私有库",value:"private-database"},{label:"媒体库",value:"media-database"}]);for(const e of n)h[e.value]={};const u=x(()=>h[l.value]),f=k(!1),d=w([]),{devMode:g}=O(),o=x(()=>({repo:g.value?"api-test":l.value,username:"kooritea",branch:"master",useConfigToken:"1"})),y=e=>{d.splice(0,d.length),d.push(...e)},v=x(()=>{const e=[...u.value[a.value]||[]];return!f.value&&a.value!=="/"&&a.value!==""&&e.unshift({type:"dir",name:"..",path:a.value.includes("/")?a.value.slice(0,a.value.lastIndexOf("/")):"/"}),e}),r=(e,c)=>{if(a.value=e,!u.value[e]||c)return u.value[e]=void 0,f.value=!0,M({...o.value,path:e}).then(m=>{m.type==="dir"&&(u.value[e]=[...m.children.filter(C=>C.type==="dir"),...m.children.filter(C=>C.type==="file")])}).finally(()=>{f.value=!1})};r("/"),U(l,()=>{r("/")});const _=e=>{B({title:"提示",message:`确认删除${e.length>1?`选中的${e.length}个文件`:e[0].name}`,type:"warning",confirmHandlerPromise:c=>G({...o.value,files:e.map(m=>({isDel:!0,path:m.path}))}).then(()=>r(a.value,!0))})};return{dataBaseList:n,onSelectionChange:y,repoConfig:o,tableData:v,loadPath:r,currentPath:a,handlers:[{name:"上传",type:"primary",upload:!0,handler:({files:e})=>B({title:`[${o.value.repo}]上传文件`,message:"输入上传路径",type:"info",inputValue:`${a.value}${a.value==="/"?"":"/"}${e[0].name}`,confirmHandlerPromise:c=>z({...o.value,branch:void 0,file:e[0]}).then(({sha:m})=>G({...o.value,files:[{sha:m,path:c.inputValue}]}).then(()=>r(a.value,!0))),inputValidator:c=>!!c,inputErrorMessage:"请输入上传路径",showInput:!0})},{name:"删除选中的项",type:"danger",confirm:!1,disabled:()=>d.length===0,handler:()=>_(d)},{name:"刷新",type:"default",handler:()=>{a.value="/";for(const e in u.value)delete u.value[e];return r("/")}}],deleteItem:_,deleteDir:e=>{B({title:"提示",message:`确认删除${e}`,type:"warning",confirmHandlerPromise:c=>T({...o.value,dir:e}).then(()=>r(a.value,!0))})},database:l}},methods:{onCellClick(a,l,h,n){l.property==="name"&&(a.type==="dir"&&this.loadPath(a.path),a.type==="file"&&window.open(a.download_url,"_blank"))}}},W={class:"page"};function X(a,l,h,n,u,f){const d=s("PageHeader"),g=s("el-radio"),o=s("el-radio-group"),y=s("LoadingIcon"),v=s("el-table-column"),r=s("AsyncButtom"),_=s("el-table"),D=s("ButtonBox");return b(),I("div",W,[i(d),i(o,{modelValue:n.database,"onUpdate:modelValue":l[0]||(l[0]=t=>n.database=t)},{default:p(()=>[(b(!0),I(q,null,J(n.dataBaseList,t=>(b(),L(g,{key:t.value,value:t.value,size:"large"},{default:p(()=>[V(P(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(_,{border:"",data:n.tableData,style:{width:"100%"},onCellClick:f.onCellClick,onSelectionChange:n.onSelectionChange},{empty:p(()=>[H("div",null,[i(y)])]),default:p(()=>[i(v,{type:"selection",selectable:t=>t.type==="file"},null,8,["selectable"]),i(v,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{default:p(t=>[H("span",null,P(t.row.type==="dir"?"📁":"📄")+P(t.row.name),1)]),_:1}),i(v,{label:"操作",width:"120px"},{default:p(t=>[i(r,{type:"danger",size:"mini",confirm:!1,onLoadingClick:()=>t.row.type==="dir"?n.deleteDir(t.row.path):n.deleteItem([t.row])},{default:p(()=>[V(" 删除 ")]),_:2},1032,["onLoadingClick"])]),_:1})]),_:1},8,["data","onCellClick","onSelectionChange"]),n.handlers.length>0?(b(),L(D,{key:0,handlers:n.handlers},null,8,["handlers"])):j("",!0)])}const le=S(K,[["render",X],["__scopeId","data-v-6d252e1f"]]);export{le as default};
