import{ch as v,aP as d,aQ as p,bo as T,bH as I,b2 as m,aW as C,ci as z,aR as _,bz as f,bp as k,b_ as A,bF as E,bl as S,bG as U,bA as j,bv as P,bx as O,by as L,bu as W,bj as K,cq as q,cr as Y,cE as w,cF as G,bg as Q,cd as g}from"./vendor-b07f99b0.js";import{I as N}from"./ImageCon-8e34f222.js";import{_ as h,S as Z,o as J,u as X,h as F,w as ee,p as te,L as H,q as ne,A as se}from"./index-13be8594.js";const oe={components:{ImageCon:N},props:{src:{type:String,default:()=>""},alt:{type:String,default:()=>""},srcPreFix:{type:[Array,String],default:()=>["https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://fastly.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://raw.githubusercontent.com/kooritea/kooritea.github.io/img"]}}},re={class:"md-image"};function ce(s,e,n,t,o,i){const r=v("ImageCon");return d(),p("div",re,[T(r,{ref:"ImageCon",src:n.src,prefix:n.srcPreFix,alt:n.alt||n.src,onClick:e[0]||(e[0]=a=>s.$imagePreview(s.$refs.ImageCon.applySrc)),onDragstart:e[1]||(e[1]=I(()=>{},["prevent"]))},null,8,["src","prefix","alt"])])}const ie=h(oe,[["render",ce],["__scopeId","data-v-0e70f206"]]);const ae={components:{SvgIcon:Z},directives:{"safe-html":J},props:{content:{type:String,required:!0},lang:{type:String,default:""}},setup(s){const{darkMode:e}=X(),n=m(!1);let t=null;return F(()=>import("./highlightjs-4914df6f.js").then(o=>o.i),[],import.meta.url).then(o=>{n.value=!0,t=o.default}),{darkMode:e,highlightCode:C(()=>{if(n.value&&t.getLanguage(s.lang.toLowerCase()))return t.highlight(s.content,{language:s.lang.toLowerCase()}).value;{const o=document.createElement("div");return o.innerHTML=s.content,o.innerText}}),lineCount:C(()=>s.content.split(`
`).length-1)}},methods:{writeTextToClipboard(){ee(this.content),this.$msgBox.success("复制成功")}}},le={class:"code-block"},ue={class:"code-meta"},de={class:"lang"},pe={class:"code"},_e={class:"line-numbers"};function me(s,e,n,t,o,i){const r=v("SvgIcon"),a=z("safe-html");return d(),p("div",le,[_("div",ue,[_("span",de,f(`${n.lang.slice(0,1).toUpperCase()}${n.lang.slice(1)}`),1),_("span",{class:"copy",onClick:e[0]||(e[0]=(...l)=>i.writeTextToClipboard&&i.writeTextToClipboard(...l))},[T(r,{name:"copy"})])]),_("div",pe,[_("div",_e,[(d(!0),p(k,null,A(new Array(t.lineCount).fill(""),(l,c)=>(d(),p("div",{key:c,class:"number"},f(c+1),1))),128))]),E(_("pre",{class:S(["hljs",{dark:t.darkMode,light:!t.darkMode}])},null,2),[[a,t.highlightCode]])])])}const ge=h(ae,[["render",me],["__scopeId","data-v-a8e19719"]]);const he=String.fromCharCode(8205),fe=/\uFE0F/g,ye=(s,e="-")=>{const n=[];let t=0,o=0,i=0;for(;i<s.length;)t=s.charCodeAt(i++),o?(n.push((65536+(o-55296<<10)+(t-56320)).toString(16)),o=0):t>=55296&&t<=56319?o=t:n.push(t.toString(16));return n.join(e)};function be(s){return ye(s.indexOf(he)<0?s.replace(fe,""):s)}const ke={components:{ImageCon:N},props:{emoji:{type:String,default:""}},setup(s){const e=m(!1),t=`/${be(s.emoji)}.png`;return{showEmojiImg:e,imgSrc:t}}},ve={key:0};function we(s,e,n,t,o,i){const r=v("ImageCon");return d(),p(k,null,[E(T(r,{class:"emoji",src:t.imgSrc,prefix:["https://cdn.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://fastly.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://raw.githubusercontent.com/twitter/twemoji/assets/72x72"],alt:n.emoji,onLoad:e[0]||(e[0]=a=>t.showEmojiImg=!0)},null,8,["src","prefix","alt"]),[[U,t.showEmojiImg]]),t.showEmojiImg?j("",!0):(d(),p("span",ve,f(n.emoji),1))],64)}const xe=h(ke,[["render",we],["__scopeId","data-v-2dd6e819"]]);const Ie={props:{content:{type:String,default:""}},setup(s){const e=s.content.match(/\[bilibili ((av|bv|AV|BV)[a-zA-Z0-9]+)?( p.*?)?\]/),n=e[1],t=((e?e[3]:"")||"").slice(2),o=m(`https://player.bilibili.com/player.html?bvid=${n}${t?"?page="+t:""}`),i=m(`https://www.bilibili.com/video/${n}${t?"?p="+t:""}`),r=m(!0);return{playerSrc:o,webSiteSrc:i,loading:r,id:m(n)}}},Se=["href"],$e=["src"];function Ce(s,e,n,t,o,i){return d(),p("div",null,[_("p",null,[_("a",{class:"link",href:t.webSiteSrc,target:"_blank"},f(t.id),9,Se)]),_("iframe",{src:t.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:S(["bilibili-player",{loading:t.loading}]),onLoad:e[0]||(e[0]=r=>t.loading=!1)},null,42,$e)])}const je=h(Ie,[["render",Ce],["__scopeId","data-v-c2f21cd0"]]);const Te={props:{content:{type:String,default:""}},setup(s){const n=s.content.match(/\[youtube (.*?)\]/)[1],t=m(`https://www.youtube.com/embed/${n}`),o=m(`https://www.youtube.com/watch?v=${n}`),i=m(!0);return{playerSrc:t,webSiteSrc:o,loading:i,id:m(n)}}},Me=["href"],De=["src"];function Le(s,e,n,t,o,i){return d(),p("div",null,[_("p",null,[_("a",{class:"link",href:t.webSiteSrc,target:"_blank"},f(t.id),9,Me)]),_("iframe",{src:t.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:S(["youtube-player",{loading:t.loading}]),onLoad:e[0]||(e[0]=r=>t.loading=!1)},null,42,De)])}const Ae=h(Te,[["render",Le],["__scopeId","data-v-40b9d9a4"]]);function Be(s){return te({url:`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/music/${s}.mp3`,responseType:"arraybuffer"}).then(e=>{const[n,t]=s.split("-");return F(()=>import("./vendor-b07f99b0.js").then(o=>o.i),["https://kooritea.moe/assets/vendor-b07f99b0.js","https://kooritea.moe/assets/highlightjs-4914df6f.js"],import.meta.url).then(o=>{const i=o.default,a=new i(e).ID3V2.findLabel("APIC");return{picUrl:a?URL.createObjectURL(new Blob([a.content.pictureBuffer])):"",name:n,singer:t,id:s,getPlayUrl:async()=>URL.createObjectURL(new Blob([e],{type:"audio/mp3"}))}})})}const Ee={components:{LoadingIcon:H},props:{content:{type:String,default:""}},setup(s){const n=s.content.match(/\[music (.*?)\]/)[1],t=m({}),o=m(!0),i=m("");return(n.startsWith("private")?Be(n.slice(8)):ne(n)).then(r=>{t.value=r}).catch(r=>{i.value=r.message}).finally(()=>{o.value=!1}),{loading:o,error:i,id:m(n),music:t}},methods:{onClick(){this.loading||this.error||this.music.getPlayUrl().then(s=>{window.open(s,"_blank")})}}},Pe={key:1,class:"error-msg"},Re=["src"],Ve={class:"info"},Ue=["title"],Ne=["title"];function Fe(s,e,n,t,o,i){const r=v("LoadingIcon");return d(),p("div",{class:"music-player-simple",onClick:e[0]||(e[0]=(...a)=>i.onClick&&i.onClick(...a))},[t.loading?(d(),P(r,{key:0})):t.error?(d(),p("div",Pe,f(t.error),1)):(d(),p(k,{key:2},[_("img",{class:"music-player-simple-pic",src:t.music.picUrl},null,8,Re),_("div",Ve,[_("p",{class:"song-name",title:t.music.name},"🎶"+f(t.music.name),9,Ue),_("p",{class:"singer-name",title:t.music.singer},f(t.music.singer),9,Ne)])],64))])}const He=h(Ee,[["render",Fe],["__scopeId","data-v-e934a6f1"]]);const ze={components:{LoadingIcon:H},props:{content:{type:String,default:""}},setup(s){const n=s.content.match(/\[emoji (.*?)\]/)[1],t=m(`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/emoji/${n}.png`),o=m(!0);return{id:m(n),loading:o,imageSrc:t}}},Oe={class:"md-sticker"},We=["src","alt"];function Ke(s,e,n,t,o,i){const r=v("LoadingIcon");return d(),p("div",Oe,[t.loading?(d(),P(r,{key:0,class:"loading"})):j("",!0),E(_("img",{class:S(["sticker-image",{"sticker-image-loading":t.loading}]),src:t.imageSrc,alt:t.id||s.src,onLoad:e[0]||(e[0]=a=>t.loading=!1),onDragstart:e[1]||(e[1]=I(()=>{},["prevent"]))},null,42,We),[[U,!t.loading]])])}const qe=h(ze,[["render",Ke],["__scopeId","data-v-d3b6fa8d"]]),Ye={props:{hashtag:{type:String,default:""}},emits:["hashtag-click"],methods:{onClick(s){this.$emit("hashtag-click",{event:s,hashtag:this.hashtag.slice(1)})}}};function Ge(s,e,n,t,o,i){return d(),p("a",{href:"#",onClick:e[0]||(e[0]=(...r)=>i.onClick&&i.onClick(...r))},f(n.hashtag),1)}const Qe=h(Ye,[["render",Ge]]);class M{constructor(e,n){this.x=e,this.y=n,this.key=String(Math.random())}}class V extends M{constructor(e,n){super(e,n),this.itemType="kabe"}}class B extends M{constructor(e,n){super(e,n),this.itemType="box"}}class Ze extends M{constructor(e,n){super(e,n),this.itemType="target"}}class Je extends M{constructor(e,n){super(e,n),this.itemType="neko"}}class Xe{constructor(e){this.instance=[],this.neko=null,this.boxs=[],this.targets=[];for(let n=0;n<e.length;n++){const t=e[n],o=[];this.instance.push(o);for(let i=0;i<t.length;i++){const r=t[i];let a=null;for(const l of r.split(""))switch(l){case"k":{a=new V(i,n);break}case"x":{const c=new B(i,n);this.boxs.push(c),a=c;break}case"o":{this.targets.push(new Ze(i,n));break}case"s":{const c=new Je(i,n);this.neko=c,a=c;break}}o.push(a)}}}getItem({x:e,y:n}){var t;return(t=this.instance[n])==null?void 0:t[e]}getDirectionCoordinate({x:e,y:n},t){switch(t){case"2":{n=n+1;break}case"4":{e=e-1;break}case"6":{e=e+1;break}case"8":{n=n-1;break}}return{x:e,y:n}}getNextItem({x:e,y:n},t){const o=this.getItem(this.getDirectionCoordinate({x:e,y:n},t));return o===void 0||o instanceof V?!1:o}moveItem({x:e,y:n},t){const o=this.getItem({x:e,y:n}),i=this.getDirectionCoordinate({x:e,y:n},t);o.x=i.x,o.y=i.y,this.instance[n][e]=null,this.instance[i.y][i.x]=o}}let et=class{constructor(e){this.map=new Xe(e)}get neko(){return this.map.neko}operate(e){const n=this.map.getNextItem(this.neko,e);if(n===!1)return!1;if(n===null&&this.map.moveItem(this.neko,e),n instanceof B){if(this.map.getNextItem(n,e)!==null)return!1;this.map.moveItem(n,e)}}check(){return!this.map.targets.some(e=>!(this.map.getItem(e)instanceof B))}};const tt={components:{AsyncButtom:se},props:{map:{type:String,default:()=>""}},setup(s){const e=m(null),n=m(50),t=m(!1),o=function(){let l=[];const c=[];for(const u of s.map.split(","))u==="n"?(c.push(l),l=[]):l.push(u);e.value=K(new et(c)),t.value=!1};o();const i=function(l){l.preventDefault();const c={38:"8",104:"8",39:"6",102:"6",37:"4",100:"4",40:"2",98:"2"}[String(l.keyCode)];e.value.operate(c),t.value=e.value.check()},r=C(()=>{var l,c;return((c=(l=e.value)==null?void 0:l.map)==null?void 0:c.targets)||[]}),a=function(l,c){return r.value.some(u=>u.x===l&&u.y===c)};return{mapInstance:C(()=>{var l,c;return((c=(l=e.value)==null?void 0:l.map)==null?void 0:c.instance)||[]}),isTarget:a,size:n,reset:o,congratulations:t,keyupHandler:i}}},nt=s=>(q("data-v-4b7b26ab"),s=s(),Y(),s),st={class:"sokoban-box"},ot={key:0,class:"congratulations"},rt=nt(()=>_("div",{class:"mask"},"点击开始",-1)),ct={class:"buttons"};function it(s,e,n,t,o,i){const r=v("AsyncButtom");return d(),p("div",st,[_("div",{class:"sokoban",tabIndex:"-1",onKeydown:e[0]||(e[0]=I(a=>{a.preventDefault()},["stop"])),onKeypress:e[1]||(e[1]=I(a=>{a.preventDefault()},["stop"])),onKeyup:e[2]||(e[2]=I((...a)=>t.keyupHandler&&t.keyupHandler(...a),["stop"]))},[(d(!0),p(k,null,A(t.mapInstance,(a,l)=>(d(),p("div",{key:l,class:"row"},[(d(!0),p(k,null,A(a,(c,u)=>(d(),p("div",{key:(c==null?void 0:c.key)||u+l,class:S(["col",{[(c==null?void 0:c.itemType)||"empty"]:!0,target:t.isTarget(u,l)}]),style:O({width:`${t.size}px`,height:`${t.size}px`})},[(c==null?void 0:c.itemType)==="neko"?(d(),p(k,{key:0},[L(" 😾 ")],64)):(c==null?void 0:c.itemType)==="box"?(d(),p(k,{key:1},[L(" 📦 ")],64)):j("",!0)],6))),128))]))),128)),t.congratulations?(d(),p("div",ot,"通关")):j("",!0),rt],32),_("div",ct,[T(r,{type:"primary","on-click":t.reset},{default:W(()=>[L(" 重置 ")]),_:1},8,["on-click"])])])}const at=h(tt,[["render",it],["__scopeId","data-v-4b7b26ab"]]),lt={components:{Sokoban:at},props:{content:{type:Array,default:()=>[]}}},ut={key:1};function dt(s,e,n,t,o,i){const r=v("Sokoban");return d(),p("div",null,[n.content[0]==="sokoban"?(d(),P(r,{key:0,map:n.content[1]},null,8,["map"])):(d(),p("span",ut,"[component "+f(n.content)+" not found]",1))])}const pt=h(lt,[["render",dt]]);function D(s,e){return function(n){const{tokens:t}=n;for(const o of t){if(o.type!=="inline")continue;const i=[],r=[];for(const a of o.children){if(a.type.endsWith("_open")){const l=a.type.slice(0,a.type.indexOf("_open"));r.push(l)}if(a.type.endsWith("_close")&&r.pop(),a.type==="text"&&s.test(a.content)){const l=a.content;let c=0;if(l.replace(new RegExp(s,"g"),function(...u){const[x]=u,y=e(x,r);if(y!==!1){const b=u[u.length-2];if(b>c){const R=new w("text","",0);R.content=l.slice(c,b),i.push(R)}c=b+x.length,i.push(y)}}),c<l.length){const u=new w("text","",0);u.content=l.slice(c),i.push(u)}}else i.push(a)}o.children=i}}}function _t(s){return D(/(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/,n=>{const t=new w("emoji","",0);return t.markup=n,t.content=n,t})}function mt(s,e){s.core.ruler.after("linkify","emoji",_t())}function gt(s){const e=/\[((music)|(youtube)|(bilibili)|(emoji)) (.*?)\]/;return D(e,n=>{const t=n.match(e),o=new w("media","",0);return o.markup=n,o.content=n,o.block=!0,o.info=t[1],o})}function ht(s,e){s.core.ruler.after("text_join","media",gt())}function ft(s){return D(/#(\S*)/,(n,t)=>{if(t[t.length-1]==="link")return!1;const o=new w("hashtag","",0);return o.markup=n,o.content=n,o})}function yt(s,e){s.core.ruler.after("linkify","hashtag",ft())}function bt(s){const e=/\[component (.*?) (.*?)\]/;return D(e,n=>{const t=n.match(e),o=new w("component","",0);return o.markup=n,o.content=n,o.block=!0,o.info=t.slice(1),o})}function kt(s,e){s.core.ruler.after("text_join","component",bt())}const $=new G({breaks:!0});$.use(mt);$.use(ht);$.use(yt);$.use(kt);const vt={props:{modelValue:{type:String,default:()=>""}},emits:["hashtag-click"],setup(s,e){const n=function(i){const r=[],a=[];for(let l=0;l<i.length;l++){const c=i[l];if(c.type.endsWith("_open")){const u=c.type.slice(0,c.type.indexOf("_open"));a.push({type:u,tag:c.tag,block:c.block,content:"",attrs:c.attrs,children:[]});continue}if(c.type.endsWith("_close")){if(a.length>1){const u=a.pop();a[a.length-1].children.push(u)}else r.push(a.pop());continue}if(a.length>0){const u=a[a.length-1];u.content=c.content,c.type==="inline"?u.children.push(...n(c.children)):u.children.push(c)}else r.push(c)}return r},t=function(i){return i.map(r=>{var l,c;const a=((l=r.attrs)==null?void 0:l.reduce((u,x)=>{const[y,b]=x;return u[y]?Array.isArray(u[y])?u[y].push(b):u[y]=[u[y],b]:u[y]=b,u},{}))||{};switch(r.type){case"text":return r.content;case"emoji":return g(xe,{...a,emoji:r.content,key:r.content},"");case"hashtag":return g(e.slots.hashtag??Qe,{...a,hashtag:r.content,key:r.content,onHashtagClick:u=>{e.emit("hashtag-click",u)}},"");case"media":{switch(r.info){case"bilibili":return g(je,{...a,content:r.content,key:r.content},"");case"youtube":return g(Ae,{...a,content:r.content,key:r.content},"");case"music":return g(He,{...a,content:r.content,key:r.content},"");case"emoji":return g(qe,{...a,content:r.content,key:r.content},"")}break}case"link":return g(r.tag,{...a,target:"_blank"},t(r.children));case"image":return g(ie,{src:a.src,alt:r.content,key:r.content},"");case"fence":return g(ge,{...a,lang:r.info||"text",content:r.content,key:r.content},"");case"component":return g(pt,{...a,content:r.info,key:r.content},"");default:return g(r.tag||"span",a,((c=r.children)==null?void 0:c.length)>0?t(r.children):r.content)}})},o=Q(s,"modelValue");return()=>{const i=n($.parse(o.value,{}));return g("div",{class:"markdown-body"},t(i))}}},$t=h(vt,[["__scopeId","data-v-c5868561"]]);export{$t as M};
