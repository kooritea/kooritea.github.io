import{bM as oe,c1 as U,cd as V,cD as Q,aR as u,aS as y,a_ as w,bW as P,bu as D,bz as c,bC as k,aT as W,bx as p,cl as R,bw as X,bF as v,bY as O,bA as h,bE as M,bD as F,bB as B,bG as A,bv as L,c7 as z,cu as H,bH as Z,cR as ne}from"./vendor-5d98ec45.js";import{p as se}from"./element-plus-2fbd5573.js";import{_ as E}from"./index-e286ad4e.js";import"./highlightjs-4914df6f.js";const de={},ue={},j={BaseOptionsLoader:async t=>(console.warn("未设置基础库映射表加载方法，无法使用optionsBaseCode字段"),[]),ComponentCover:{}},K=function(t,l){let r=t,i=l;if(typeof l=="string"){const o=l.split(".");i=o.pop();for(const e of o)t[e]||(t[e]=T({})),r=t[e]}return[r,i]};function $(t,l){const r=[];for(const i in t){const o=(l?`${l}.`:"")+i;typeof t[i]=="object"&&t[i]!==null&&!Array.isArray(t[i])?r.push(...$(t[i],o)):r.push(o)}return r}function T(t){return t=oe(t||{}),t._isPathObject?t:new Proxy(t,{set:(l,r,i)=>{const[o,e]=K(l,r);return o[e]=i,!0},get:(l,r)=>{if(r==="_isPathObject")return!0;if(r==="_pathKeys")return $(l);const[i,o]=K(l,r);return i[o]},has:(l,r)=>{const[i,o]=K(l,r);return o in i},deleteProperty:(l,r)=>{const[i,o]=K(l,r);return delete i[o],!0}})}const q=new Set;function fe(t){q.has(t)||(console.warn(`[EasyComponent]${t}`),q.add(t))}function ee(t,l,r){for(const i of t){if(l(i))return i;if(typeof r=="number"&&(r=r-1),Array.isArray(i.children)&&(typeof r!="number"||r>0)){const o=ee(i.children,l,r);if(o)return o}}}function N(t,l,r={index:-1}){for(const i of t){if(r.index++,l(i))return r.index;if(Array.isArray(i.children)){const o=N(i.children,l,r);if(o>-1)return o}}return-1}function te(t,l,r=[]){for(const i of t)l(i)&&r.push(i),Array.isArray(i.children)&&te(i.children,l,r);return r}function J(t){return JSON.stringify(t,(l,r)=>typeof r=="function"?r.toString():r)}function x(t){if(typeof t!="object"||t===null||t instanceof File)return t;if(Array.isArray(t)){const r=[];for(const i of t)r.push(x(i));return r}const l={};for(const r in t)typeof t[r]=="object"?l[r]=x(t[r]):l[r]=t[r];return l}function le(...t){for(const l of t)if(l!==void 0)return l}const I=T({}),G=[];function re(t){if(Array.isArray(I[t]))return I[t];if(!I[t]&&!G.includes(t))if(typeof j.BaseOptionsLoader=="function"){if(I[t]=j.BaseOptionsLoader(t),Array.isArray(I[t]))return I[t];if(I[t]instanceof Promise)return I[t].then(l=>{if(Array.isArray(l))I[t]=l;else throw new Error("BaseOptionsLoader必须返回Array或Promise<Array>")}).catch(l=>{console.error(l),G.push(t),delete I[t]}),[];throw new Error("BaseOptionsLoader必须返回Array或Promise<Array>")}else throw new Error("BaseOptionsLoader必须是一个方法");return[]}const me={name:"EasyFormItem",components:{Plus:se},props:{field:{type:Object,default:()=>({})},componentScope:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},configReadOnly:{type:Boolean,default:()=>!1},configIsView:{type:Boolean,default:()=>!1},configTrim:{type:Boolean,default:()=>!0},configDisableValidates:{type:Boolean,default:()=>!1},dontValidateRequired:{type:Boolean,default:()=>!1},useSubmitValidate:{type:Boolean,default:()=>!1},itemController:{type:Object,default:()=>({})}},emits:["change","update:rules","beforeDestroy","created"],data(){return{isEasyFormItem:!0,onChangeTimer:null,onChangeIsFromUser:!1,appendModel:"",OptionsMap:I}},computed:{ComponentConfig(){return j},easyFormItemScope(){return{...this._componentScope,options:this.options,optionsLoading:this.optionsLoading,placeholder:this.placeholder,isMultipleValue:this.isMultipleValue,isView:this.isView,disabled:this._disabled,viewValue:typeof this.field.viewer=="function"?this.field.viewer(this._componentScope,this.modelValue):this.defaultViewer(),getPropValue:this.getPropValue,getFormProps:this.getFormProps}},_componentScope(){return{formData:this.formDataRef,field:this.field,getOptionValue:this.getOptionValue,fieldInstance:this,...this.componentScope}},formDataRef(){return this.formData},componentModel:{set(t){this.modelValue=this.applyComputed(t,"set")},get(){return this.applyComputed(this.modelValue,"get")}},modelValue:{set(t){this.formDataRef[this.field.prop]=t,this.callOnChange(t,!0)},get(){return this.initModelValue(),this.formDataRef[this.field.prop]}},fieldType(){return this.getPropValue(this.field.type)},placeholder(){if(this.getPropValue(this.configReadOnly))return"未录入";{const t=this.getValueByLevel(this.getPropValue(this.field.placeholder),this.getFormProps("placeholder"));return t||`${this.fieldTips}${this.getPropValue(this.field.label)||""}`}},isView(){return this.fieldType==="view"||this.getValueByLevel(this.getPropValue(this.field.isView),this.getPropValue(this.configIsView))},isMultipleValue(){return["checkbox"].includes(this.fieldType)||this.fieldType==="select"&&this.getFormProps("multiple")===!0||this.fieldType==="cascader"&&(this.getFormProps("props")||{}).multiple===!0||this.getPropValue(this.field.multiple)},fieldTips(){if(this.field.fieldTips)return this.field.fieldTips;switch(this.fieldType){case"textarea":case"input":return"请输入";case"select":case"radio":case"checkbox":case"date-picker":return"请选择";default:return"请录入"}},options(){return this.getOptions(this.field.options,this.field.optionsBaseCode)},optionsFilterShow(){return this.optionsFilterShowMethod(this.options)},rules(){let t=[];const l=this.getValueByLevel(this.getPropValue(this.field.disableValidates),this.getPropValue(this.configDisableValidates));if(this.field.prop&&!this.isView&&!l){const r={input:"blur",textarea:"blur",select:"change","date-picker":"change",radio:"change",checkbox:"change"}[this.field.type]||"submit";t=(this.getPropValue(this.field.rules)||[]).filter(i=>!!i).map(i=>{if(i.trigger===void 0&&(i.trigger=i.trigger||r),i.trigger==="submit"){const o=i.validator;i.validator=(e,f,m)=>{this.useSubmitValidate?o(e,f,m):m()}}return i}),this.getPropValue(this.field.required)&&t.push({required:!0,message:this.getPropValue(this.field.requiredMessage)||this.fieldTips+(this.getPropValue(this.field.label)||""),trigger:r,validator:(i,o,e)=>{this.dontValidateRequired&&!this.getPropValue(this.field.forceRequired)?e():this.isMultipleValue?e(Array.isArray(o)&&o.length>0?void 0:i.message):e([void 0,null,""].includes(o)?i.message:void 0)}}),t.push({trigger:"submit",validator:(i,o,e)=>{if(!this.modelValue){e();return}if(!this.useSubmitValidate){e();return}if(this.fieldType==="select"&&this.getFormProps("remote")===!0){e();return}if(this.fieldType==="select"&&this.getFormProps("allowCreate")===!0){e();return}if(this.getPropValue(this.field.dontValidateOption)){e();return}if(["radio","select","cascader"].includes(this.fieldType)&&!this.isMultipleValue){const f=this.findOption(null,{predicate:m=>{if(typeof m.value=="object"&&m.value!==null){const b=this.modelValue?this.modelValue._key:"",g=b===m.value._key;return!g&&String(b)&&String(b)===String(m.value._key)&&console.warn(`所选值[${b}](${typeof b})与选项值[${m.value._key}](${typeof m.value._key})类型不一致`),g}else{const b=this.modelValue===m.value;return!b&&String(this.modelValue)&&String(this.modelValue)===String(m.value)&&console.warn(`所选值[${this.modelValue}](${typeof this.modelValue})与选项值[${m.value}](${typeof m.value})类型不一致`),b}}});if(f){if(f.show===!1){const m=this.getPropValue(f.notFoundReason,o,f,this.options);e(m||`选择的[${this.modelValue}]不存在于选项中，请重新选择。`),this.modelValue="";return}else if(f.disabled===!0){const m=this.getPropValue(f.disabledReason,o,f,this.options);e(m||`当前选择的[${f.label}]已禁用，请重新选择。`),this.modelValue="";return}}else{let m="";this.$refs.ElComponent&&(m=this.$refs.ElComponent.selectedLabel),e(`选择的[${m||this.modelValue}]不存在于选项中，请重新选择。`),this.modelValue="";return}}else if(this.isMultipleValue&&Array.isArray(this.modelValue))for(const f of this.modelValue){const m=this.findOption(f);if(m){if(m.show===!1){e(`选择的[${m.label}]不存在于选项中，此项已重置，请重新选择。`),this.modelValue=[];return}else if(m.disabled===!0){e(`选择的[${m.label}]已禁用，此项已重置，请重新选择。`),this.modelValue=[];return}}else{e(`选择的[${f}]不存在于选项中，此项已重置，请重新选择。`),this.modelValue=[];return}}e()}})}return t},_disabled(){return this.configReadOnly||this.getFormProps("disabled")||this.getPropValue(this.field.disabled)||this.itemController.disabled},buttons(){return(this.getPropValue(this.field.buttons)||[]).filter(t=>this.getPropValue(t.show)!==!1)},optionsLoading(){if(this.itemController.userOptionsLoading)return!0;const t=this.getPropValue(this.field.optionsBaseCode);return t?this.OptionsMap[t]instanceof Promise:!1}},watch:{fieldType:{immediate:!0,handler(t){t==="cascader"&&fe("cascader为测试中的组件，建议使用type: slot 自行实现")}},modelValue(t,l){this.callOnChange(t,!1)},rules(t){this.$emit("update:rules",t)}},created(){this.initModelValue(),this.$emit("update:rules",this.rules),this.$emit("created",this),this.callOnChange(this.modelValue,!1),this.callOnCreated()},mounted(){this.callOnMounted()},beforeUnmount(){this.$emit("beforeDestroy",this)},methods:{getOptions(t,l,r){const i=l?re(this.getPropValue(l)):[],o=t?this.getPropValue(t,i)||[]:i,{labelKeyName:e="label",valueKeyName:f="value",childrenKeyName:m="children",leafKeyName:_="leaf",isLeaf:b,subLabel:g}=this.getPropValue(this.field.optionConfig)||{};return o.map(s=>typeof s=="object"?{...s,label:[void 0,null].includes(s[e])?s[f]:s[e],value:[void 0,null].includes(s[f])?s[e]:s[f],children:s[m],leaf:s[_]}:{value:s,label:s}).map(s=>{const d={};for(const n in s)d[n]=this.getPropValue(s[n]);return d}).map(s=>{const d=[];r&&(Array.isArray(r._parent)&&r._parent.length>0&&d.push(...r._parent),d.push({...r,children:void 0}));const n={...s,_parent:d};let a;return typeof b=="function"?a=b(s)?void 0:this.getOptions(s.children||[],void 0,n):a=s.children?this.getOptions(s.children,void 0,n):void 0,n.children=a,n}).map(s=>{const d=typeof s.value=="object"&&s.value!==null;return d&&!s.key&&console.error("当value为Object时，必须为Options的每一个对象设置一个key值",o),d?{...s,value:{_key:s.key,...s.value}}:{_key:s.key??s.value,...s}}).map(s=>{const d=typeof g=="function"?g(s):g;return{...s,subLabel:d===void 0&&s.subLabel===void 0?(s._parent||[]).map(n=>n.label).join(this.getFormProps("separator")||"/"):s.subLabel||d}})},optionsFilterShowMethod(t){return t.filter(l=>l.show!==!1).map(l=>({...l,children:Array.isArray(l.children)?this.optionsFilterShowMethod(l.children):void 0}))},getOptionValue(t="",l){if(t&&t!==this.field.prop)throw new Error("组件上层未提供getOptionValue，无法查询其他项的值");return this.isMultipleValue?this.modelValue.map(r=>this.findOption(r,l)).filter(r=>!!r):this.findOption(this.modelValue,l)},getFormProps(t){return(this.getPropValue(this.field.formProps)||{})[t]},initModelValue(){if(this.field.prop){if(this.formDataRef&&!(this.field.prop in this.formDataRef)&&(this.formDataRef[this.field.prop]=void 0),this.formDataRef[this.field.prop]===void 0||this.formDataRef[this.field.prop]===null)if(this.field.defaultValue!==void 0)if(typeof this.field.defaultValue=="function")try{this.formDataRef[this.field.prop]=this.field.defaultValue(this._componentScope,this.formDataRef[this.field.prop])}catch(t){console.error(t)}else this.formDataRef[this.field.prop]=this.field.defaultValue;else this.isMultipleValue?this.formDataRef[this.field.prop]=[]:this.fieldType==="date-picker"&&this.getFormProps("type")==="daterange"&&(this.formDataRef[this.field.prop]=[]);else if(this.field.praseValue)if(typeof this.field.praseValue=="function")try{this.formDataRef[this.field.prop]=this.field.praseValue(this._componentScope,this.formDataRef[this.field.prop])}catch(t){console.error(t)}else this.formDataRef[this.field.prop]=this.field.praseValue;else this.isMultipleValue&&typeof this.formDataRef[this.field.prop]=="string"&&this.getPropValue(this.field.valueSplitChar)&&(this.formDataRef[this.field.prop]=this.formDataRef[this.field.prop].split(this.getPropValue(this.field.valueSplitChar)));if(this.isMultipleValue&&Array.isArray(this.formDataRef[this.field.prop]))for(const t of te(this.options,l=>l.required))this.formDataRef[this.field.prop].includes(t.value)||this.formDataRef[this.field.prop].push(t.value)}},callButtonHandler(t){t.loading=!0;try{const l=t.handler(this._componentScope,t);l instanceof Promise?l.finally(()=>{t.loading=!1}):t.loading=!1}catch(l){console.error(l),t.loading=!1}},callOnChange(t,l){this.onChangeIsFromUser=this.onChangeIsFromUser||l,this.onChangeTimer===null&&(this.onChangeTimer=setTimeout(()=>{var r;try{if(this.fieldType==="date-picker"){if(this.getFormProps("type")==="daterange"&&Array.isArray(this.modelValue)){const i=this.getFormProps("valueFormat")||"YYYY-MM-DD HH:mm:ss",o=new Date(this.modelValue[0]);o.setHours(0,0,0,0);const e=new Date(this.modelValue[1]);e.setHours(23,59,59,999),this.modelValue[0]=U(o).format(i),this.modelValue[1]=U(e).format(i)}Array.isArray(this.modelValue)||(this.modelValue=U(this.modelValue).format(this.getFormProps("valueFormat")||"YYYY-MM-DD HH:mm:ss"))}this.field.cnProp&&(this.formDataRef[this.field.cnProp]=(r=this.options.find(i=>this.modelValue===i.value))==null?void 0:r.label),typeof this.field.onChange=="function"&&this.field.onChange(this._componentScope,this.modelValue,this.onChangeIsFromUser),this.$emit("change",this._componentScope,this.modelValue,this.onChangeIsFromUser)}catch(i){console.error(i)}this.onChangeTimer=null,this.onChangeIsFromUser=!1}))},callOnCreated(){if(typeof this.field.onCreated=="function")try{this.field.onCreated(this._componentScope)}catch(t){console.error(t)}},callOnMounted(){if(typeof this.field.onMounted=="function")try{this.field.onMounted(this._componentScope)}catch(t){console.error(t)}},getPropValue(t,...l){return typeof t=="function"?t(this._componentScope,...l):t},getPropArrayValue(t,...l){const r=this.getPropValue(t,...l);return[null,void 0].includes(r)?[]:Array.isArray(r)?r:[r]},getValueByLevel(...t){for(const l of t)if(l!==void 0)return l},defaultViewer(){if(this.isMultipleValue&&Array.isArray(this.modelValue))return this.modelValue.map(t=>{const l=this.findOption(t);return l?l.label:t}).join("、");{let t=this.modelValue;const l=this.findOption(t);if(l)return l.label;if(t&&this.fieldType==="date-picker"&&this.getFormProps("format")){const r=U(t);return r.isValid()?r.format(this.getFormProps("format")||"YYYY-MM-DD"):t}return this.getPropValue(this.field.append)&&(t=`${t}${this.getPropValue(this.field.append)}`),this.getPropValue(this.field.prepend)&&(t=`${this.getPropValue(this.field.prepend)}${t}`),t}},parseData(){let t=typeof this.modelValue=="object"?x(this.modelValue):this.modelValue;const l="value";if(this.isMultipleValue&&(t=t.sort((r,i)=>N(this.options,o=>r===o.value)-N(this.options,o=>i===o.value))),typeof this.field.valueFormat=="function")try{t=this.field.valueFormat(this._componentScope,t)}catch(r){console.error(r)}else this.isMultipleValue&&this.getPropValue(this.field.valueSplitChar)&&(t=t.join(this.getPropValue(this.field.valueSplitChar)));return t=this.trimValue(t),{value:t,type:l}},getComputer(){const t=this.getPropValue(this.field.computer);if(t)return t;{const l=this.getPropValue(this.field.autoAppend);return{get:r=>{if(l&&r)if(Array.isArray(l)){for(const i of this.getOptions(l))if(r.endsWith(i.value))return r.slice(0,r.length-i.value.length)}else return r.slice(0,r.length-l.length);return this.trimValue(r)},set:r=>l&&r?Array.isArray(l)?r+this.appendModel:r+l:this.isMultipleValue&&Array.isArray(r)?r.sort((i,o)=>N(this.options,e=>i===e.value)-N(this.options,e=>o===e.value)):this.trimValue(r)}}},applyComputed(t,l){const r=this.getComputer();if(l==="get")return r.get(t);if(l==="set")return r.set(t)},trimValue(t){return this.getValueByLevel(this.field.trim,this.configTrim)!==!1&&typeof t=="string"?t.trim():t},findOption(t,{predicate:l,deepLimit:r}={}){return ee(this.options,l||(i=>i.value===t),r||(this.fieldType==="cascader"?void 0:1))}}},he={key:0,class:"name"},ce={key:1},ge={key:0,class:"el-icon-loading"},pe={key:1,class:"el-icon-search"},ye={key:1,class:"select-option-item-label"},Ve={key:2,class:"select-option-item-subLabel"},Pe={key:16,style:{"margin-left":"10px","flex-shrink":"0"}};function be(t,l,r,i,o,e){var n;const f=V("el-option"),m=V("el-select"),_=V("el-checkbox"),b=V("Plus"),g=V("el-icon"),s=V("el-button"),d=Q("loading");return u(),y("div",null,[(u(!0),y(w,null,P(e.getPropArrayValue(r.field.beforeSlotName),a=>D(t.$slots,a,{formData:e.formDataRef,field:r.field,options:e.options,isView:e.isView,disabled:e._disabled,viewValue:typeof r.field.viewer=="function"?r.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),getPropValue:e.getPropValue},void 0,!0)),256)),(u(!0),y(w,null,P(e.getPropArrayValue(r.field.beforeSlot),a=>(u(),c(k(a),{key:a,"form-data":e.formDataRef,field:r.field,options:e.options,"is-view":e.isView,disabled:e._disabled,"view-value":typeof r.field.viewer=="function"?r.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),"get-prop-value":e.getPropValue},null,8,["form-data","field","options","is-view","disabled","view-value","get-prop-value"]))),128)),W("div",{class:L(["easy-form-item",{"default-display":!["slot","component"].includes(e.fieldType)||e.getPropValue(r.field.useDefaultDisplay),["easy-form-item-"+e.fieldType]:!0,["easy-form-item-"+(r.field.prop||r.field.key)]:!0}])},[e.fieldType==="slot"?D(t.$slots,e.getPropValue(r.field.slotName),{key:0,formData:e.formDataRef,field:r.field,options:e.options,isView:e.isView,disabled:e._disabled,viewValue:typeof r.field.viewer=="function"?r.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),getPropValue:e.getPropValue},void 0,!0):e.fieldType==="component"?(u(),c(k(e.getPropValue(r.field.is)),p({key:1,modelValue:e.componentModel,"onUpdate:modelValue":l[0]||(l[0]=a=>e.componentModel=a),easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps),R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","easyFormItemScope"])):e.isView?(u(),y("span",{key:2,class:"el-form-item-view",style:X({"white-space":e.fieldType==="textarea"?"pre-wrap":void 0})},v(typeof r.field.viewer=="function"?r.field.viewer(e._componentScope,e.modelValue):e.defaultViewer()),5)):["input","textarea"].includes(e.fieldType)?(u(),c(k(e.optionsFilterShow.length>0&&e.fieldType!=="textarea"?"el-autocomplete":"el-input"),p({key:3,modelValue:e.componentModel,"onUpdate:modelValue":l[2]||(l[2]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,type:e.getFormProps("type")||(e.fieldType==="textarea"?"textarea":void 0)},{rows:5,showWordLimit:!!e.getFormProps("maxlength"),fetchSuggestions:(a,C)=>{C(e.optionsFilterShow.filter(S=>S.filter===void 0?!a||S.label.includes(a):e.getPropValue(S.filter,a,S)))},...e.getPropValue(r.field.formProps)||{}},R(e.getPropValue(r.field.formListeners)||{})),O({default:h(a=>[a?(u(),y("div",he,v(a.item.name),1)):F("",!0)]),_:2},[e.getPropValue(r.field.prepend)?{name:"prepend",fn:h(()=>[M(v(e.getPropValue(r.field.prepend)),1)]),key:"0"}:void 0,e.getPropValue(r.field.autoAppend)||e.getPropValue(r.field.append)?{name:"append",fn:h(()=>[Array.isArray(e.getPropValue(r.field.autoAppend))?(u(),c(m,{key:0,modelValue:o.appendModel,"onUpdate:modelValue":l[1]||(l[1]=a=>o.appendModel=a),loading:e.optionsLoading,"loading-text":e.getFormProps("loadingText")||"正在加载远程数据"},{default:h(()=>[(u(!0),y(w,null,P(e.getOptions(e.getPropValue(r.field.autoAppend)).filter(a=>a.show!==!1),a=>(u(),c(f,{key:a.key||a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","loading-text"])):(u(),y("span",ce,v(e.getPropValue(r.field.autoAppend)||e.getPropValue(r.field.append)),1))]),key:"1"}:void 0]),1040,["modelValue","placeholder","disabled","type"])):e.fieldType==="number"?(u(),c(k(e.ComponentConfig.ComponentCover.number||"el-input-number"),p({key:4,ref:"ElComponent",modelValue:e.componentModel,"onUpdate:modelValue":l[3]||(l[3]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{...e.getPropValue(r.field.formProps,e.options)||{}},R(e.getPropValue(r.field.formListeners,e.options)||{})),null,16,["modelValue","placeholder","disabled","easyFormItemScope"])):e.fieldType==="select"?(u(),c(k(e.ComponentConfig.ComponentCover.select||"el-select"),p({key:5,ref:"ElComponent",modelValue:e.componentModel,"onUpdate:modelValue":l[5]||(l[5]=a=>e.componentModel=a),placeholder:e.placeholder,"value-key":"_key",disabled:e._disabled,filterable:e.getValueByLevel(e.getFormProps("filterable"),e.optionsFilterShow.length>7),"popper-class":["easy-form-item-select","easy-form-item-"+r.field.prop,e.getFormProps("popperClass")||""].join(" "),multiple:e.isMultipleValue,loading:e.optionsLoading,"loading-text":e.getFormProps("loadingText")||"正在加载远程数据",easyFormItemScope:e.easyFormItemScope},{clearable:!0,...e.getPropValue(r.field.formProps,e.options)||{}},R(e.getPropValue(r.field.formListeners,e.options)||{})),O({default:h(()=>[(u(!0),y(w,null,P(e.optionsFilterShow,a=>(u(),c(f,{key:a.key||a.value,label:a.label,value:a.value,disabled:a.disabled||e.isMultipleValue&&a.required},{default:h(()=>[W("div",p({class:"select-option-item"},R(e.getPropValue(a.listeners||r.field.optionListeners,a)||{},!0)),[e.isMultipleValue?(u(),c(_,{key:0,modelValue:e.modelValue,"onUpdate:modelValue":l[4]||(l[4]=C=>e.modelValue=C),class:"select-option-item-label",label:a.value,disabled:a.disabled||a.required},{default:h(()=>[M(v(a.label),1)]),_:2},1032,["modelValue","label","disabled"])):(u(),y("div",ye,v(a.label),1)),a.subLabel?(u(),y("div",Ve,v(a.subLabel),1)):F("",!0)],16)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.getValueByLevel(e.getFormProps("filterable"),e.optionsFilterShow.length>7)||e.optionsLoading?{name:"prefix",fn:h(()=>[e.optionsLoading?(u(),y("i",ge)):(u(),y("i",pe))]),key:"0"}:void 0]),1040,["modelValue","placeholder","disabled","filterable","popper-class","multiple","loading","loading-text","easyFormItemScope"])):e.fieldType==="cascader"?B((u(),c(k(e.ComponentConfig.ComponentCover.cascader||"el-cascader"),p({key:6,ref:"ElComponent",modelValue:e.componentModel,"onUpdate:modelValue":l[6]||(l[6]=a=>e.componentModel=a),placeholder:e.placeholder,options:e.optionsFilterShow,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{clearable:!0,filterable:!0,showAllLevels:!1,...e.getPropValue(r.field.formProps),props:{multiple:e.isMultipleValue,emitPath:!1,...e.getFormProps("props")||{}}},R(e.getPropValue(r.field.formListeners,e.options)||{})),null,16,["modelValue","placeholder","options","disabled","easyFormItemScope"])),[[d,e.optionsLoading]]):e.fieldType==="date-picker"?(u(),c(k(e.ComponentConfig.ComponentCover["date-picker"]||"el-date-picker"),p({key:7,modelValue:e.componentModel,"onUpdate:modelValue":l[7]||(l[7]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD",...e.getPropValue(r.field.formProps)},R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","placeholder","disabled","easyFormItemScope"])):e.fieldType==="time-picker"?(u(),c(k(e.ComponentConfig.ComponentCover["time-picker"]||"el-time-picker"),p({key:8,modelValue:e.componentModel,"onUpdate:modelValue":l[8]||(l[8]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},{valueFormat:"HH:mm:ss",format:"HH:mm:ss",...e.getPropValue(r.field.formProps)},R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","placeholder","disabled","easyFormItemScope"])):e.fieldType==="radio"?B((u(),c(k(e.ComponentConfig.ComponentCover.radio||"el-radio-group"),p({key:9,modelValue:e.componentModel,"onUpdate:modelValue":l[9]||(l[9]=a=>e.componentModel=a),placeholder:e.placeholder,disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps,e.options),R(e.getPropValue(r.field.formListeners,e.options)||{})),{default:h(()=>[(u(!0),y(w,null,P(e.optionsFilterShow,a=>(u(),c(k(r.field.useRadioButton?"el-radio-button":"el-radio"),{key:a.key||a.value,value:a.value,label:a.value,disabled:a.disabled,border:r.field.border},{default:h(()=>[M(v(a.label),1)]),_:2},1032,["value","label","disabled","border"]))),128))]),_:1},16,["modelValue","placeholder","disabled","easyFormItemScope"])),[[d,e.optionsLoading]]):e.fieldType==="checkbox"?B((u(),c(k(e.ComponentConfig.ComponentCover.checkbox||"el-checkbox-group"),p({key:10,modelValue:e.componentModel,"onUpdate:modelValue":l[10]||(l[10]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps,e.options),R(e.getPropValue(r.field.formListeners,e.options)||{})),{default:h(()=>[(u(!0),y(w,null,P(e.optionsFilterShow,a=>(u(),c(_,{key:a.key||a.value,label:a.value,disabled:a.disabled||a.required},{default:h(()=>[M(v(a.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},16,["modelValue","disabled","easyFormItemScope"])),[[d,e.optionsLoading]]):e.fieldType==="confirm"?(u(),c(k(e.ComponentConfig.ComponentCover.confirm||"el-checkbox"),p({key:11,modelValue:e.componentModel,"onUpdate:modelValue":l[11]||(l[11]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps),R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","disabled","easyFormItemScope"])):e.fieldType==="switch"?(u(),c(k(e.ComponentConfig.ComponentCover.switch||"el-switch"),p({key:12,modelValue:e.componentModel,"onUpdate:modelValue":l[12]||(l[12]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps),R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","disabled","easyFormItemScope"])):e.fieldType==="rate"?(u(),c(k(e.ComponentConfig.ComponentCover.rate||"el-rate"),p({key:13,modelValue:e.componentModel,"onUpdate:modelValue":l[13]||(l[13]=a=>e.componentModel=a),disabled:e._disabled,easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps),R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","disabled","easyFormItemScope"])):e.fieldType==="upload"?(u(),c(k(e.ComponentConfig.ComponentCover.upload||"el-upload"),p({key:14,class:{"el-upload-readonly":r.configReadOnly,"el-upload-limit":e.getFormProps("limit")&&Number(e.getFormProps("limit"))===((n=e.componentModel)==null?void 0:n.length)},"file-list":e.componentModel,"on-change":(a,C)=>{e.componentModel=C;const S=e.getPropValue(r.field.formProps);S&&typeof S.onChange=="function"&&S.onChange(a,C)},"on-remove":(a,C)=>{e.componentModel=C;const S=e.getPropValue(r.field.formProps);S&&typeof S.onRemove=="function"&&S.onRemove(a,C)},easyFormItemScope:e.easyFormItemScope},{action:"",autoUpload:!!e.getFormProps("action"),...e.getPropValue(r.field.formProps)||{}},R(e.getPropValue(r.field.formListeners)||{})),O({default:h(()=>[e.getFormProps("listType")==="picture-card"?(u(),c(g,{key:0},{default:h(()=>[A(b)]),_:1})):F("",!0)]),_:2},[e.getFormProps("listType")?void 0:{name:"trigger",fn:h(()=>[r.configReadOnly?F("",!0):(u(),c(s,{key:0,disabled:e._disabled,size:"small",type:"primary"},{default:h(()=>[M(" 选取文件 ")]),_:1},8,["disabled"]))]),key:"0"},!r.configReadOnly&&r.field.tips?{name:"tip",fn:h(()=>[W("span",null,v(r.field.tips),1)]),key:"1"}:void 0]),1040,["class","file-list","on-change","on-remove","easyFormItemScope"])):e.ComponentConfig.ComponentCover[e.fieldType]?(u(),c(k(e.ComponentConfig.ComponentCover[e.fieldType]),p({key:15,modelValue:e.componentModel,"onUpdate:modelValue":l[14]||(l[14]=a=>e.componentModel=a),easyFormItemScope:e.easyFormItemScope},e.getPropValue(r.field.formProps),R(e.getPropValue(r.field.formListeners)||{})),null,16,["modelValue","easyFormItemScope"])):F("",!0),e.buttons.length>0?(u(),y("div",Pe,[(u(!0),y(w,null,P(e.buttons,a=>(u(),c(s,p({key:e.getPropValue(a.label),loading:e.getPropValue(a.loading),type:e.getPropValue(a.type),size:e.getPropValue(a.size),disabled:e.getPropValue(a.disabled),icon:e.getPropValue(a.leftIcon)||e.getPropValue(a.icon)},e.getPropValue(a.buttonProps),{onClick:C=>e.callButtonHandler(a)}),{default:h(()=>[M(v(e.getPropValue(a.label))+" ",1),e.getPropValue(a.rightIcon)?(u(),y("i",{key:0,class:L(["el-icon--right",e.getPropValue(a.rightIcon)])},null,2)):F("",!0)]),_:2},1040,["loading","type","size","disabled","icon","onClick"]))),128))])):F("",!0)],2),(u(!0),y(w,null,P(e.getPropArrayValue(r.field.afterSlot),a=>(u(),c(k(a),{key:a,"form-data":e.formDataRef,field:r.field,options:e.options,"is-view":e.isView,disabled:e._disabled,"view-value":typeof r.field.viewer=="function"?r.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),"get-prop-value":e.getPropValue},null,8,["form-data","field","options","is-view","disabled","view-value","get-prop-value"]))),128)),(u(!0),y(w,null,P(e.getPropArrayValue(r.field.afterSlotName),a=>D(t.$slots,a,{formData:e.formDataRef,field:r.field,options:e.options,isView:e.isView,disabled:e._disabled,viewValue:typeof r.field.viewer=="function"?r.field.viewer(e._componentScope,e.modelValue):e.defaultViewer(),getPropValue:e.getPropValue},void 0,!0)),256))])}const Y=E(me,[["render",be],["__scopeId","data-v-5656c58f"]]);const _e={components:{EasyFormItem:Y},props:{fields:{type:Array,default:()=>[]},componentScope:{type:Object,default:()=>({})},formConfig:{type:Object,default:()=>({})},itemController:{type:Object,default:()=>({})},easyFormItemBindData:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})}},data(){return{layoutCache:{data:null,stringify:"",count:0,forceUpdate:!1}}},computed:{layout(){return this.renderLayout()},formInstance(){return this.componentScope.formInstance}},methods:{getValueByLevel:le,getField(t){return this.fields.find(l=>l.prop===t)},getPropValue(t,...l){return typeof t=="function"?t(this.componentScope,...l):t},renderLayout(){const t=this.fields.map((o,e)=>({key:o.prop||e,...o,slotName:this.getPropValue(o.slotName),keepOnForm:this.getPropValue(o.keepOnForm),showInForm:this.getPropValue(o.showInForm),formSort:this.getPropValue(o.formSort)||1/0,type:this.getPropValue(o.type),span:this.getPropValue(o.span)})).sort((o,e)=>o.formSort-e.formSort),l=[];for(const o of t)o.showInForm!==!1&&l.push(o);const r=[];let i={type:"row",cols:[]};for(const o of l)if((o.type==="divider"||o.span===void 0)&&(o.span=24),o.span===24)i.cols.length>0&&(i.cols.push({empty:!0,span:24-i.cols.reduce((e,f)=>e+f.span,0)}),r.push(i),i={type:"row",cols:[]}),o.type==="divider"?(r.length>0&&(r[r.length-1].nextIsDivider=!0),r.push(o)):r.push({type:"row",cols:[o]});else{const e=i.cols.reduce((f,m)=>f+m.span,0);e+o.span>24?(i.cols.push({empty:!0,span:24-e}),r.push(i),i={type:"row",cols:[o]}):(i.cols.push(o),i.cols.reduce((f,m)=>f+m.span,0)===24&&(r.push(i),i={type:"row",cols:[]}))}return i.cols.length>0&&(i.cols.push({empty:!0,span:24-i.cols.reduce((o,e)=>o+e.span,0)}),r.push(i),i={type:"row",cols:[]}),this.layoutCache.stringify===J({showFields:r})?this.layoutCache.count>2?this.layoutCache.data:(this.layoutCache.count++,{showFields:r,forceUpdate:this.layoutCache.forceUpdate}):(this.layoutCache.count=0,this.layoutCache.data={showFields:r,forceUpdate:this.layoutCache.forceUpdate},this.layoutCache.stringify=J({showFields:r}),this.$nextTick(()=>{this.layoutCache.forceUpdate=!this.layoutCache.forceUpdate}),{showFields:r,forceUpdate:this.layoutCache.forceUpdate})},isView(t){return t.type==="view"||this.getValueByLevel(this.getPropValue(t.isView),this.getPropValue(this.formConfig.isView))},isDisabled(t){var l;return this.easyFormItemBindData.configReadOnly||this.getFormProps(t,"disabled")||this.getPropValue(t.disabled)||((l=this.itemController[t.prop])==null?void 0:l.disabled)},getFormProps(t,l){return(this.getPropValue(t.formProps)||{})[l]},getPropArrayValue(t,...l){const r=this.getPropValue(t,...l);return[null,void 0].includes(r)?[]:Array.isArray(r)?r:[r]}}},Ce={class:"default-layout"},we={key:0},Fe={key:0,class:"el-form-item-label-inline"},ve={key:1},De={key:1};function ke(t,l,r,i,o,e){const f=V("el-divider"),m=V("EasyFormItem"),_=V("el-form-item"),b=V("el-col"),g=V("el-row");return u(),y("div",Ce,[(u(!0),y(w,null,P(e.layout.showFields,s=>(u(),y(w,null,[s.type==="divider"?D(t.$slots,s.slotName||"divider",{key:0,field:s,getPropValue:e.getPropValue,formData:r.formData},()=>[(u(),c(f,{key:s.key,"content-position":s.contentPosition},{default:h(()=>[M(v(e.getPropValue(s.label)),1)]),_:2},1032,["content-position"]))],!0):s.type==="row"?(u(),c(g,{key:s.cols.map(d=>d.key||d.prop).join(""),gutter:e.getValueByLevel(r.formConfig.gutter,20),class:L({["easy-form-row-"+s.cols.map(d=>e.getValueByLevel(d.prop,d.key,"")).join("-")]:!0,"next-is-divider":s.nextIsDivider})},{default:h(()=>[(u(!0),y(w,null,P(s.cols,d=>(u(),c(b,{key:d.key,span:d.span,style:X((e.getPropValue(d.styles)||{}).col),class:L(["easy-form-col-"+d.key,{"easy-form-col-view":e.isView(d),"easy-form-col-disbaled":e.isDisabled(d)}])},{default:h(()=>[d.empty?(u(),y("span",De," ")):(u(),c(_,p({key:0,label:(e.getPropValue(d.label)||"")+(e.getValueByLevel(d.showColon,r.formConfig.showColon)?"：":""),prop:d.prop,style:{...(e.getPropValue(d.styles)||{}).formItem},class:{"hidden-label":e.getValueByLevel(d.hiddenLabel,r.formConfig.hiddenLabel),...(d.formItemProp||{}).class,["label-position-"+(r.formConfig.labelPosition||"top")]:!0,["item-type-"+(d.type||"")]:!0,["item-type-slot-"+(d.slotName||"")]:!!d.slotName}},d.formItemProp),{label:h(()=>[e.getValueByLevel(d.hiddenLabel,r.formConfig.hiddenLabel)?(u(),y("span",we)):D(t.$slots,e.getPropValue(e.getValueByLevel(d.labelSlotName,r.formConfig.labelSlotName))||"label",{key:1,formData:r.formData,field:d,getPropValue:e.getPropValue,formConfig:r.formConfig},()=>[e.getPropValue(d.label)?(u(),y("span",Fe,v(e.getPropValue(d.label)+(e.getValueByLevel(d.showColon,r.formConfig.showColon)?"：":"")),1)):(u(),y("span",ve," "))],!0)]),default:h(()=>[A(m,p({field:d,"item-controller":r.itemController[d.prop]},r.easyFormItemBindData,{"onUpdate:rules":n=>{e.formInstance.updateRules(d.prop,n)},onCreated:n=>{e.formInstance.registerFormItem(d.prop,n)},onBeforeDestroy:n=>{e.formInstance.unRegisterFormItem(d.prop,n)},onChange:(n,a,C)=>{e.formInstance.clearValidate(d.prop),e.formInstance.callComponentOnChange(n,d,a,C)}}),O({[e.getPropValue(d.slotName)]:h(n=>[D(t.$slots,e.getPropValue(d.slotName),p({getField:e.getField,formConfig:r.formConfig,easyFormItemBindData:r.easyFormItemBindData},n),void 0,!0)]),_:2},[P(e.getPropArrayValue(d.beforeSlotName),n=>({name:n,fn:h(a=>[D(t.$slots,n,p({getField:e.getField,formConfig:r.formConfig,easyFormItemBindData:r.easyFormItemBindData},a),void 0,!0)])})),P(e.getPropArrayValue(d.afterSlotName),n=>({name:n,fn:h(a=>[D(t.$slots,n,p({getField:e.getField,formConfig:r.formConfig,easyFormItemBindData:r.easyFormItemBindData},a),void 0,!0)])}))]),1040,["field","item-controller","onUpdate:rules","onCreated","onBeforeDestroy","onChange"])]),_:2},1040,["label","prop","style","class"]))]),_:2},1032,["span","style","class"]))),128))]),_:2},1032,["gutter","class"])):F("",!0)],64))),256))])}const Se=E(_e,[["render",ke],["__scopeId","data-v-dfed336c"]]);const Re={name:"EasyForm",components:{EasyFormItem:Y,DefaultLayout:Se},props:{fields:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>({})},formConfig:{type:Object,default:()=>({})},buttons:{type:Array,default:()=>[]},meta:{type:Object,default:()=>({})},customMode:{type:Boolean,default:()=>!1}},emits:["created","beforeDestroy","cancel","submit","valid","change"],data(){return{dontValidateRequired:!1,useSubmitValidate:!1,itemController:{},formRules:{},formItemRefs:{}}},computed:{hiddenFields(){return this.fields.map((t,l)=>({key:t.prop||l,...t,slotName:this.getPropValue(t.slotName),keepOnForm:this.getPropValue(t.keepOnForm),showInForm:this.getPropValue(t.showInForm),formSort:this.getPropValue(t.formSort)||1/0,type:this.getPropValue(t.type),span:this.getPropValue(t.span)})).sort((t,l)=>t.formSort-l.formSort).filter(t=>t.showInForm===!1&&t.keepOnForm)},allSlotName(){return Object.keys(this.$slots)},componentScope(){return{formData:this.formData,formConfig:this._formConfig,formInstance:this,getOptionValue:this.getOptionValue,setOptionLoading:this.setOptionLoading,getPropValue:this.getPropValue,formRules:this.formRules,meta:this.meta,updateRules:this.updateRules,registerFormItem:this.registerFormItem,unRegisterFormItem:this.unRegisterFormItem}},formData(){return T(this.modelValue)},_formConfig(){return{...de,...this.formConfig}},_buttons(){return this.patchButtons(this.buttons),this.buttons},easyFormItemBindData(){return{componentScope:this.componentScope,configReadOnly:this.getPropValue(this._formConfig.readOnly),configIsView:this.getPropValue(this._formConfig.isView),configTrim:this.getPropValue(this._formConfig.trim),configDisableValidates:this.getPropValue(this._formConfig.disableValidates),formData:this.formData,dontValidateRequired:this.dontValidateRequired,useSubmitValidate:this.useSubmitValidate}}},watch:{modelValue(t){for(const l of Object.values(this.formItemRefs))l.callOnChange(t[l.field.prop],!1)}},created(){this.$emit("created",this)},beforeUnmount(){this.$emit("beforeDestroy",this)},methods:{patchButtons(t){for(const l of t)l.loading=l.loading===void 0?!1:l.loading},getField(t){return this.fields.find(l=>l.prop===t)},getOptionValue(t,l){if(this.formItemRefs[t])return this.formItemRefs[t].getOptionValue(t,l)},setOptionLoading(t,l){l instanceof Promise&&(this.setItemControllerValue(t,"userOptionsLoading",!0),l.finally(()=>{this.setItemControllerValue(t,"userOptionsLoading",!1)}))},getPropValue(t,...l){return typeof t=="function"?t(this.componentScope,...l):t},registerFormItem(t,l){if(l.isEasyFormItem)this.formItemRefs[t]=l;else throw console.error(l),new Error("registerFormItem 方法注册的实例并非EasyFormItem实例")},unRegisterFormItem(t,l){this.formItemRefs[t]===l&&delete this.formItemRefs[t]},updateRules(t,l){this.formRules[t]=l},callButtonHandler(t){t.loading=!0;try{const l=t.handler(this.componentScope,t);l instanceof Promise?l.finally(()=>{t.loading=!1}):t.loading=!1}catch(l){console.error(l),t.loading=!1}},setItemControllerValue(t,l,r){this.itemController[t]||(this.itemController[t]={}),this.itemController[t][l]=r},setAllItemControllerValue(t,l){for(const r in this.itemController)this.setItemControllerValue(r,t,l)},getItemControllerValue(t,l){return this.itemController[t]||(this.itemController[t]={}),this.itemController[t][l]},callComponentOnChange(t,l,r,i){const o={scope:t,field:l,value:r,isFromUser:i};typeof this._formConfig.onChange=="function"&&this._formConfig.onChange(o),this.$emit("change",o)},submitForm(t={}){return new Promise((l,r)=>{const i=this.dontValidateRequired;this.dontValidateRequired=t.dontValidateRequired,this.useSubmitValidate=!0,this.$nextTick(()=>{this.$refs.form.validate((o,e)=>{if(o){const f=this.getParseFormData(t);this.$emit("submit",f),l(f)}else{if(this.$emit("valid",e),t.cleanDisabledOnValidError!==!1)for(const f in e)this.setItemControllerValue(f,"disabled",!1);le(t.showValidMessage,this._formConfig.showValidMessage)!==!1&&this.$message({type:"warning",message:e[Object.keys(e)[0]][0].message,duration:5e3});try{this.formItemRefs[Object.keys(e)[0]].$el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}catch(f){console.error(f)}r(e)}this.dontValidateRequired=i,this.useSubmitValidate=!1})})})},getParseFormData(t={}){const l=T(x(t.fieldOnly?{}:this.formData)),r=[];for(const i of this.fields)try{const o=this.getPropValue(i.formDataProp)||i.prop;if(this.getPropValue(i.showInForm)===!1&&!this.getPropValue(i.keepOnForm)&&!r.includes(i.prop))delete l[i.prop];else if(this.formItemRefs[i.prop]){r.push(i.prop);const{value:e,type:f}=this.formItemRefs[i.prop].parseData();f==="delete"?delete l[i.prop]:f==="value"&&(l[o]=e)}}catch(o){console.error(o)}return l},resetFormData(t={}){return this.updateValue(t).then(()=>{this.$nextTick(()=>{this.$refs.form&&this.$refs.form.clearValidate()})})},async setFieldValue(t={},l={}){l={setDisabled:!1,setDisabledForce:!1,dontUpdate:!1,...l},l={...l,disabledExclude:(Array.isArray(l.disabledExclude)?l.disabledExclude:[l.disabledExclude]).filter(e=>!!e),fieldExclude:(Array.isArray(l.fieldExclude)?l.fieldExclude:[l.fieldExclude]).filter(e=>!!e),restDisabledMap:l.restDisabledMap===void 0?l.setDisabled||l.setDisabledForce:l.restDisabledMap,copyAllData:typeof l.copyAllData=="boolean"?l.copyAllData:!1};const r=T(t),i=this.getParseFormData(),o=new Set;l.restDisabledMap&&this.setAllItemControllerValue("disabled",!1);for(const e of this.fields)e.prop&&o.add(e.prop),e.prop in r&&!l.fieldExclude.includes(e.prop)&&((l.setDisabledForce||l.setDisabled&&!["",void 0,null].includes(r[e.prop]))&&(l.disabledExclude.includes(e.prop)||(l.dontUpdate&&i[e.prop]!==r[e.prop]?this.setItemControllerValue(e.prop,"disabled",!1):this.setItemControllerValue(e.prop,"disabled",!0))),l.dontUpdate?([null,void 0,""].includes(this.formData[e.prop])&&(this.formData[e.prop]=r[e.prop]),this.formItemRefs[e.prop]&&this.formItemRefs[e.prop].isMultipleValue&&this.formData[e.prop].length===0&&(this.formData[e.prop]=r[e.prop])):this.formData[e.prop]=r[e.prop]);if(l.copyAllData)for(const e of r._pathKeys)!o.has(e)&&!l.fieldExclude.includes(e)&&(this.formData[e]=r[e]);return this.updateValue(this.formData).then(()=>{this.$nextTick(()=>{this.$refs.form&&this.$refs.form.clearValidate()})})},clearValidate(t){this.$refs.form&&this.$refs.form.clearValidate(t)},validateField(t){this.$refs.form&&this.$refs.form.validateField(t)},updateValue(t){let l=this,r=this.$parent,i="modelValue";for(;r;){for(const e in r.$props)if(r.$props[e]===this.modelValue){l=r,i=e;break}r=r.$parent}const o=[`update:${i}`];Object.keys(l.$listeners||{}).some(e=>o.includes(e))||console.warn(`[EasyForm] 祖辈组件未声明[${i}]监听器，表单值可能更新失效`);for(const e of o)l.$emit(e,t);return new Promise(e=>{this.$nextTick(()=>{e()})})}}},Ie={class:"easy-form"};function Me(t,l,r,i,o,e){const f=V("DefaultLayout"),m=V("el-form"),_=V("el-button"),b=V("EasyFormItem");return u(),y("div",Ie,[A(m,{ref:"form",model:e.formData,"label-position":e._formConfig.labelPosition,"label-width":e._formConfig.labelWidth||(["left","right"].includes(e._formConfig.labelPosition)?"100px":void 0),disabled:e.getPropValue(e._formConfig.readOnly),"validate-on-rule-change":!1,rules:o.formRules,class:L({"read-only":e.getPropValue(e._formConfig.readOnly),"is-view":e.getPropValue(e._formConfig.isView)})},{default:h(()=>[r.customMode?D(t.$slots,"default",p({key:0,easyFormItemBindData:e.easyFormItemBindData},e.componentScope),void 0,!0):(u(),c(f,{key:1,ref:"DefaultLayout",fields:r.fields,"component-scope":e.componentScope,"form-config":e._formConfig,"item-controller":o.itemController,"easy-form-item-bind-data":e.easyFormItemBindData,"form-data":e.formData},O({_:2},[P(e.allSlotName,g=>({name:g,fn:h(s=>[D(t.$slots,g,z(H(s)),void 0,!0)])}))]),1032,["fields","component-scope","form-config","item-controller","easy-form-item-bind-data","form-data"]))]),_:3},8,["model","label-position","label-width","disabled","rules","class"]),!r.customMode&&(e._formConfig.showSubmit||e._formConfig.showCancel||e._buttons.filter(g=>e.getPropValue(g.show)!==!1).length>0)?(u(),y("div",{key:0,class:L(["btns",{"btn-position-center":e._formConfig.buttonPosition==="center","btn-position-left":e._formConfig.buttonPosition==="left","btn-position-right":e._formConfig.buttonPosition==="right"}])},[e._formConfig.showSubmit?(u(),c(_,{key:0,type:"primary",onClick:e.submitForm},{default:h(()=>[M(" 提交 ")]),_:1},8,["onClick"])):F("",!0),e._formConfig.showCancel?(u(),c(_,{key:1,onClick:l[0]||(l[0]=g=>t.$emit("cancel"))},{default:h(()=>[M(" 取消 ")]),_:1})):F("",!0),(u(!0),y(w,null,P(e._buttons.filter(g=>e.getPropValue(g.show)!==!1),g=>(u(),c(_,p({key:e.getPropValue(g.label),loading:e.getPropValue(g.loading),type:e.getPropValue(g.type),size:e.getPropValue(g.size),disabled:e.getPropValue(g.disabled),icon:e.getPropValue(g.leftIcon)||e.getPropValue(g.icon)},e.getPropValue(g.buttonProps),{onClick:s=>e.callButtonHandler(g)}),{default:h(()=>[M(v(e.getPropValue(g.label))+" ",1),e.getPropValue(g.rightIcon)?(u(),y("i",{key:0,class:L(["el-icon--right",e.getPropValue(g.rightIcon)])},null,2)):F("",!0)]),_:2},1040,["loading","type","size","disabled","icon","onClick"]))),128))],2)):F("",!0),(u(!0),y(w,null,P(e.hiddenFields,g=>B((u(),c(b,p({key:g.prop,field:g},e.easyFormItemBindData,{"onUpdate:rules":s=>{e.updateRules(g.prop,s)},onCreated:s=>{e.registerFormItem(g.prop,s)},onBeforeDestroy:s=>{e.unRegisterFormItem(g.prop,s)},onChange:(s,d,n)=>{e.clearValidate(g.prop),e.callComponentOnChange(s,g,d,n)}}),{[e.getPropValue(g.slotName)]:h(s=>[D(t.$slots,e.getPropValue(g.slotName),p({getField:e.getField,formConfig:r.formConfig,easyFormItemBindData:e.easyFormItemBindData},s),void 0,!0)]),_:2},1040,["field","onUpdate:rules","onCreated","onBeforeDestroy","onChange"])),[[Z,!1]])),128))])}const ae=E(Re,[["render",Me],["__scopeId","data-v-4484ec43"]]);const Oe={name:"EasyTable",props:{fields:{type:Array,default:()=>[]},tableConfig:{type:Object,default:()=>({})},buttons:{type:Array,default:()=>[]},emitLoadOnCreate:{type:Boolean,default:()=>!1},onLoad:{type:Function,default(t,l){return{tableData:this.tableData,total:this.total}}},modelValue:{type:Array,default:()=>[]},selected:{type:Array,default:()=>[]},meta:{type:Object,default:()=>({})},slotMode:{type:Boolean,default:()=>!1}},emits:["update:selected","update:modelValue"],data(){return{pageParam:{current:1,size:10},total:0,loading:!1,onPaginationChangeId:null,OptionsMap:I}},computed:{tableData:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},componentScope(){return{tableData:this.tableData,tableConfig:this._tableConfig,pageParam:this.pageParam,total:this.total,tableInstance:this,meta:this.meta}},_fields(){return this.fields.filter(t=>this.getPropValue(t.showInTable)!==!1).sort((t,l)=>t.tableSort-l.tableSort)},autoColWidthTotal(){let t=0;if(this.getPropValue(this._tableConfig.showIndex)){const l=this.getPropValue(this._tableConfig.indexAutoColWidth,[],0);t+=l}if(this.getPropValue(this._tableConfig.selection)){const l=this.getPropValue(this._tableConfig.selectionAutoColWidth,[],0);t+=l}if(this.buttons.length>0&&this.getPropValue(this._tableConfig.showHandler)!==!1){const l=this.getPropValue(this._tableConfig.handlerAutoColWidth,[],0);t+=l}return this._fields.map(l=>this.getPropValue(l.autoColWidth,[],0)).reduce((l,r)=>l+r,t)},_tableConfig(){return{...ue,...this.tableConfig}},_buttons(){return this.patchButtons(this.buttons),this.buttons}},watch:{selected:{handler(t){this.setSelected(t,!0)}}},created(){if(this.emitLoadOnCreate&&this.onPaginationChange(),this.tableData.length===0&&this._tableConfig.createRandomData){const t=typeof this._tableConfig.createRandomData=="number"?this._tableConfig.createRandomData:5;for(let l=0;l<t;l++){const r={};for(const i of this._fields)i.type==="date-picker"?r[i.prop]="2233-12-13":r[i.prop]=`${this.getPropValue(i.label)}-${l}`;this.tableData.push(r)}}},mounted(){this.setSelected(this.selected)},methods:{getDefaultFieldStyle(t,l){var r,i;return this.getPropValue((i=(r=this.fields.find(o=>o.prop===l.column.property))==null?void 0:r.styles)==null?void 0:i[t],[l])},patchButtons(t){for(const l of t)l.loading=l.loading===void 0?!1:l.loading},getPropValue(t,l=[],r){const i=typeof t=="function"?t(this.componentScope,...l):t;return i!==void 0?i:r},getAutoColWidth(t){if(t)return t/this.autoColWidthTotal*100},getFormProps(t,l){return(this.getPropValue(t.formProps)||{})[l]},createFormatter(t,l,r){const i=o=>{var b,g;if((b=t.tableProps)!=null&&b.formatter)return(g=t.tableProps)==null?void 0:g.formatter(r.row,r.column,o,r.$index);const e=t.optionsBaseCode?re(this.getPropValue(t.optionsBaseCode)):[],f=t.options?this.getPropValue(t.options,[r,e])||[]:e,m=f.find(s=>s.value===o);if(m)return m.label;if(o&&this.getPropValue(t.type,[r])==="date-picker"){const s=U(o);return s.isValid()?s.format(this.getFormProps(t,"format")||"YYYY-MM-DD"):o}const _=this.getPropValue(t.valueSplitChar);return Array.isArray(o)||_&&typeof o=="string"?(Array.isArray(o)?o:o.split(_)).map(d=>(f.find(n=>n.value===d)||{}).label||d).join("、"):o};return l==="el-table"?(o,e,f,m)=>i(f):i},defaultIndexMethod(t){return(this.pageParam.current-1)*this.pageParam.size+t+1},onPaginationChange(){const t=new Date().valueOf();return this.onPaginationChangeId=t,this.loading=!0,Promise.resolve(this.onLoad(this.pageParam,this)).then(l=>l&&Array.isArray(l.tableData)||Array.isArray(l)?l:(console.warn("[EasyTable] onLoad参数指定的方法未返回有效数据: { tableData: Array, total?: number } | Array",l),{tableData:[],total:0})).then(l=>{if(t===this.onPaginationChangeId)if(this.tableData.splice(0,this.tableData.length),Array.isArray(l))this.tableData.push(...l),this.total=l.length;else{const{tableData:r=[],total:i}=l;this.tableData.push(...r),this.total=typeof i=="number"?i:r.length}}).catch(l=>{this.tableData.splice(0,this.tableData.length),this.total=0,console.error(l)}).finally(()=>{t===this.onPaginationChangeId&&(this.loading=!1)})},callButtonHandler(t,l){l.row&&(l.row._easytableLoading=!0),t.loading=!0;try{const r=t.handler(this.componentScope,l,t);r instanceof Promise?r.finally(()=>{l.row&&(l.row._easytableLoading=!1),t.loading=!1}):(l.row&&(l.row._easytableLoading=!1),t.loading=!1)}catch(r){console.error(r),l.row&&(l.row._easytableLoading=!1),t.loading=!1}},callFieldListeners(t,l,r,i,o){var e,f;for(const m of this.fields)m.prop===r.rawColumnKey&&((f=(e=m.tableListeners)==null?void 0:e[t])==null||f.call(e,l,r,i,o))},reset(){return this.pageParam={current:1,size:10},this.onPaginationChange()},setSelected(t,l=!1){var r,i;(r=this.$refs)==null||r.table.clearSelection(),l||this.$emit("update:selected",t);for(const o of this.modelValue)(i=this.$refs)==null||i.table.toggleRowSelection(o,t.includes(o))},getSelected(){return x(this.selected)}}},Ae={class:"easy-table"},Le={key:0},Te={class:"page-info"};function Be(t,l,r,i,o,e){const f=V("el-table-column"),m=V("el-button"),_=V("el-table"),b=V("el-pagination"),g=V("el-col"),s=V("el-row"),d=Q("loading");return u(),y("div",Ae,[B((u(),c(_,p({ref:"table",data:e.tableData,"row-key":e._tableConfig.rowKey},{cellStyle:n=>e.getDefaultFieldStyle("cell",n),headerCellStyle:n=>e.getDefaultFieldStyle("headerCell",n),...e.getPropValue(e._tableConfig.tableProps)||{},class:{...(e.getPropValue(e._tableConfig.tableProps)||{}).class||{},"disable-select-all":e.getPropValue(e._tableConfig.disableSelectAll)}},{onSelect:l[0]||(l[0]=n=>{t.$emit("update:selected",n)}),onSelectAll:l[1]||(l[1]=n=>{t.$emit("update:selected",n)}),onCellClick:l[2]||(l[2]=(n,a,C,S)=>{e.callFieldListeners("click",n,a,C,S)}),onCellDblclick:l[3]||(l[3]=(n,a,C,S)=>{e.callFieldListeners("dblclick",n,a,C,S)}),onCellContextmenu:l[4]||(l[4]=(n,a,C,S)=>{e.callFieldListeners("contextmenu",n,a,C,S)})},R(e.getPropValue(e._tableConfig.tableListeners)||{})),O({default:h(()=>[(u(!0),y(w,null,P(e._tableConfig.sortCol||["selection","index"],n=>(u(),y(w,null,[n==="selection"&&e.getPropValue(e._tableConfig.selection)?(u(),c(f,p({key:n,type:"selection","min-width":e.getPropValue(e._tableConfig.tableSelectionProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(e._tableConfig.selectionAutoColWidth,[],0))},{width:e._tableConfig.selectionWidth,align:"center",headerAlign:"center",...e._tableConfig.publicTableProps,...e._tableConfig.tableSelectionProps}),null,16,["min-width"])):F("",!0),n==="index"&&e.getPropValue(e._tableConfig.showIndex)?(u(),c(f,p({key:n,index:a=>{const C=e.defaultIndexMethod(a);return typeof e._tableConfig.indexMethod=="function"?e._tableConfig.indexMethod(a,e.componentScope,C):C},type:"index","min-width":e.getPropValue(e._tableConfig.tableIndexProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(e._tableConfig.indexAutoColWidth,[],0))},{width:e._tableConfig.indexWidth,align:"center",headerAlign:"center",label:"序号",...e._tableConfig.publicTableProps,...e._tableConfig.tableIndexProps}),null,16,["index","min-width"])):F("",!0)],64))),256)),t.$slots["el-expand"]||t.$slots["el-expand"]?(u(),c(f,{key:0,type:"expand"},{default:h(n=>[D(t.$slots,"el-expand",p({...e.componentScope,...n},{isSelected:r.selected.includes(n.row)}),void 0,!0)]),_:3})):F("",!0),(u(!0),y(w,null,P(e._fields,n=>(u(),c(f,p({key:n.prop,prop:n.prop,label:e.getPropValue(n.label),"min-width":e.getPropValue(n.tableProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(n.autoColWidth,[],0))||e.getPropValue(e._tableConfig.publicTableProps,[],{}).minWidth},{showOverflowTooltip:e.getPropValue(n.type)==="textarea",...e._tableConfig.publicTableProps,...e.getPropValue(n.tableProps,[],{})}),{header:h(a=>[e.getPropValue(n.headerSlotName)?D(t.$slots,e.getPropValue(n.headerSlotName),p({key:0,field:n,componentScope:e.componentScope,formatter:e.createFormatter(n,"",a)},a),void 0,!0):(u(),y("span",{key:1,class:L(`easy-table-header-cell-${n.prop}`)},v(e.getPropValue(n.label)),3))]),default:h(a=>[e.getPropValue(n.type)==="slot"||r.slotMode?D(t.$slots,r.slotMode?n.prop:e.getPropValue(n.slotName)||n.prop,p({key:0},a,{field:n,componentScope:e.componentScope,isSelected:r.selected.includes(a.row),formatter:e.createFormatter(n,"",a)}),void 0,!0):e.getPropValue(n.type)==="component"?(u(),c(k(e.getPropValue(n.is)),p({key:1,value:e.createFormatter(n,"el-table",a)(a.row,a.column,a.row[n.prop],a.$index)},e.getPropValue(n.formProps),R(e.getPropValue(n.formListeners)||{})),null,16,["value"])):(u(),y("span",{key:2,class:L(`easy-table-cell-${n.prop}`)},v(e.createFormatter(n,"el-table",a)(a.row,a.column,a.row[n.prop],a.$index)),3))]),_:2},1040,["prop","label","min-width"]))),128)),r.buttons.length>0&&e.getPropValue(e._tableConfig.showHandler)!==!1?(u(),c(f,p({key:1,"min-width":e.getPropValue(e._tableConfig.tableHandlerProps,[],{}).minWidth||e.getAutoColWidth(e.getPropValue(e._tableConfig.handlerAutoColWidth,[],0))},{className:"table-handler",fixed:"right",width:e.getPropValue(e._tableConfig.handlerWidth),...e.getPropValue(e._tableConfig.tableHandlerProps)||{}}),{header:h(n=>[(u(!0),y(w,null,P(e._buttons.filter(a=>a.position==="header"),a=>(u(),y(w,null,[e.getPropValue(a.show,[n])!==!1?(u(),c(m,p({key:e.getPropValue(a.label,[n]),loading:e.getPropValue(a.loading,[n]),type:e.getPropValue(a.type,[n]),size:e.getPropValue(a.size,[n]),disabled:e.getPropValue(a.disabled,[n])},e.getPropValue(a.buttonProps),{onClick:C=>e.callButtonHandler(a,n)}),{default:h(()=>[M(v(e.getPropValue(a.label,[n])),1)]),_:2},1040,["loading","type","size","disabled","onClick"])):F("",!0)],64))),256)),r.buttons.filter(a=>a.position==="header").length===0?(u(),y("span",Le,v(e.getPropValue(e._tableConfig.tableHandlerProps,[],{}).label||"操作"),1)):F("",!0)]),default:h(n=>[(u(!0),y(w,null,P(e._buttons.filter(a=>a.position!=="header"),a=>(u(),y(w,null,[e.getPropValue(a.show,[n])!==!1?(u(),c(m,p({key:e.getPropValue(a.label,[n]),loading:a.loading&&n.row._easytableLoading,type:e.getPropValue(a.type,[n]),size:e.getPropValue(a.size,[n]),disabled:e.getPropValue(a.disabled,[n])},e.getPropValue(a.buttonProps),{onClick:C=>e.callButtonHandler(a,n)}),{default:h(()=>[M(v(e.getPropValue(a.label,[n])),1)]),_:2},1040,["loading","type","size","disabled","onClick"])):F("",!0)],64))),256))]),_:1},16,["min-width"])):F("",!0)]),_:2},[t.$slots["el-empty"]||t.$slots["el-empty"]?{name:"empty",fn:h(()=>[D(t.$slots,"el-empty",z(H(e.componentScope)),void 0,!0)]),key:"0"}:void 0]),1040,["data","row-key"])),[[d,o.loading]]),e._tableConfig.showPagination?(u(),c(s,{key:0,class:"pagination-con"},{default:h(()=>[A(g,{span:24,class:"pagination-con-col"},{default:h(()=>[D(t.$slots,e._tableConfig.paginationSlotName||"pagination",p({pageParam:o.pageParam,total:o.total,onPaginationChange:e.onPaginationChange},e.componentScope),()=>[A(b,{"page-size":o.pageParam.size,"current-page":o.pageParam.current,total:o.total,"page-sizes":[10,20,30,40,50,100,200],layout:"slot, total, sizes, prev, pager, next, jumper",onSizeChange:l[5]||(l[5]=n=>{o.pageParam.size=n,e.onPaginationChange()}),onCurrentChange:l[6]||(l[6]=n=>{o.pageParam.current=n,e.onPaginationChange()})},{default:h(()=>[W("span",Te," 第 "+v(o.pageParam.current)+" 页 / 共 "+v(o.total!==0?parseInt((o.total+o.pageParam.size-1)/o.pageParam.size):1)+" 页 ",1)]),_:1},8,["page-size","current-page","total"])],!0)]),_:3})]),_:3})):F("",!0)])}const ie=E(Oe,[["render",Be],["__scopeId","data-v-d1cfd138"]]);const xe={name:"EditTable",version:"3",components:{EasyTable:ie,EasyForm:ae,EasyFormItem:Y},props:{fields:{type:Array,default:()=>[]},tableProp:{type:Object,default:()=>({})},formProp:{type:Object,default:()=>({})},searchFormProp:{type:Object,default:()=>({})},dialogProp:{type:Object,default:()=>({})},meta:{type:Object,default:()=>({})},modelValue:{type:Array,default:()=>[]},rowKey:{type:String,default:()=>"id"},inlineMode:{type:Boolean,default:()=>!1},showSearchForm:{type:Boolean,default:()=>!1},searchLoader:{type:Function,default:void 0},alwaysEdit:{type:Boolean,default:!1}},emits:["update:selected","update:modelValue"],data(){return{dialogFormData:{},dialogVisible:!1,parseSearchFormData:{},searchForm:{},selected:[],virtualFormMap:{}}},computed:{valueRef(){return this.modelValue},tableFields(){return[...this.fields,{type:"slot",slotName:"virtualForm",label:"virtualForm",prop:"virtualForm",tableProps:{width:"1px",minWidth:"1px"}}]},componentScope(){return{searchForm:this.searchForm,selected:this.selected}},_selected:{set(t){this.$emit("update:selected",t),this.selected=t},get(){return this.selected}},_meta(){return{_editTable:{submitForm:(t,l)=>{const r=this.findRow(t);if(r)return this.virtualFormMap[r.row[this.rowKey]||r.row._virtualForm].submitForm(l);throw new Error("无法找到对应的表单实例")},editTableInstance:this},...this.meta}},allSlotName(){return Object.keys({...this.$slots})},that(){return this}},methods:{createPathObject(...t){return T(...t)},getPropValue(t,...l){return typeof t=="function"?t(this.componentScope,...l):t},onTableLoad(t,l){return this.searchLoader(t,this.parseSearchFormData,l)},editReady(t={}){!t[this.rowKey]&&!t._tsid&&(t._tsid=new Date().valueOf());const l=!this.valueRef.some(i=>t._tsid?t._tsid===i._tsid:t[this.rowKey]?t[this.rowKey]===i[this.rowKey]:t===i),r={};for(const i in t)["_isEditing","_editRowClone"].includes(i)||(r[i]=t[i]);try{t._editRowClone=T(x(r))}catch(i){console.warn("深拷贝对象失败，将使用浅拷贝",i),t._editRowClone=T({...r})}t._editRowClone._isAdd=l,t._isEditing=!0,this.inlineMode?l&&(t._isNoSave=!0,this.valueRef.push(t),this.$emit("update:modelValue",this.valueRef)):(this.dialogVisible=!0,this.dialogFormData=t._editRowClone),this.$nextTick(()=>{this.$refs.EasyForm&&this.$refs.EasyForm.clearValidate()})},editConfirm(t){!t[this.rowKey]&&!t._tsid&&(t._tsid=new Date().valueOf());const l=this.valueRef.findIndex(i=>t._tsid?t._tsid===i._tsid:t[this.rowKey]?t[this.rowKey]===i[this.rowKey]:t===i),r={...t};for(const i in this.value[l])i.startsWith("_")&&(r[i]=this.value[l][i]);delete r._editRowClone,delete r._isNoSave,delete r._isEditing,l>-1?this.valueRef.splice(l,1,r):this.inlineMode||this.valueRef.push(r),this.$emit("update:modelValue",this.valueRef),this.dialogVisible=!1},deleteRow(t){const{index:l}=this.findRow(t);this.valueRef.splice(l,1),this.$emit("update:modelValue",this.valueRef)},cancelEdit(t){this.dialogVisible=!1;const{row:l}=this.findRow(t);delete l._isEditing,delete l._editRowClone,l._isNoSave&&this.deleteRow(l),delete l._isNoSave},findRow(t){for(let l=0;l<this.valueRef.length;l++){const r=this.valueRef[l];if(t._tsid&&t._tsid===r._tsid)return{row:t,index:l};if(t[this.rowKey]&&t[this.rowKey]===r[this.rowKey])return{row:t,index:l};if(t===r)return{row:t,index:l}}},setSelected(t){this.$refs.EasyTable.setSelected(t)},search(t={reset:!1,resetData:{}}){return this.showSearchForm?(t.reset&&this.$refs.SearchEasyForm.resetFormData(t.resetData),this.$refs.SearchEasyForm.submitForm({showValidMessage:!1}).then(l=>(this.parseSearchFormData=l,this.$refs.EasyTable.reset()))):(this.parseSearchFormData={},this.$refs.EasyTable.reset())}}},Ee={class:"edit-table"};function Ue(t,l,r,i,o,e){const f=V("EasyForm"),m=V("el-form-item"),_=V("EasyFormItem"),b=V("EasyTable"),g=V("el-dialog");return u(),y("div",Ee,[r.showSearchForm?(u(),c(f,p({key:0,ref:"SearchEasyForm",modelValue:o.searchForm,"onUpdate:modelValue":l[0]||(l[0]=s=>o.searchForm=s),class:"edit-table-search",meta:{isSearchForm:!0,...e._meta},fields:r.fields},r.searchFormProp),O({_:2},[P(e.allSlotName,s=>({name:s,fn:h(d=>[D(t.$slots,s,z(H(d)),void 0,!0)])}))]),1040,["modelValue","meta","fields"])):F("",!0),D(t.$slots,"table-top",{instance:e.that},void 0,!0),A(b,p({ref:"EasyTable",modelValue:e.valueRef,"slot-mode":r.inlineMode,"on-load":r.tableProp.onLoad||(r.searchLoader?e.onTableLoad:void 0)},r.tableProp,{meta:{isTable:!0,...e._meta},fields:e.tableFields,"onUpdate:selected":l[1]||(l[1]=s=>{e._selected=s}),"onUpdate:modelValue":l[2]||(l[2]=s=>{t.$emit("update:modelValue",s)})}),O({virtualForm:h(s=>[(u(),c(f,{key:s.row[r.rowKey],value:s.row._editRowClone||s.row,class:"virtual-form","custom-mode":!0,fields:r.fields,onCreated:d=>{if(!s.row._virtualForm||!o.virtualFormMap[s.row[r.rowKey]||s.row._virtualForm]){const n=s.row[r.rowKey]||Math.random().toString();s.row._virtualForm=n,o.virtualFormMap[n]=d}},onBeforeDestroy:d=>{delete o.virtualFormMap[s.row[r.rowKey]||s.row._virtualForm]}},{default:h(()=>[(u(!0),y(w,null,P(r.fields,d=>B((u(),c(m,{key:d.prop,"show-message":!1,prop:d.prop},null,8,["prop"])),[[Z,!1]])),128))]),_:2},1032,["value","fields","onCreated","onBeforeDestroy"]))]),_:2},[P(e.allSlotName,s=>({name:s,fn:h(d=>[D(t.$slots,s,p({isEdit:d.row._isEditing||r.alwaysEdit,editFormData:d.row._editRowClone||d.row},d),void 0,!0)])})),P(r.fields,s=>({name:s.prop,fn:h(d=>[o.virtualFormMap[d.row[r.rowKey]||d.row._virtualForm]?(u(),c(_,p({key:s.prop,field:d.field,"config-is-view":!(d.row._isEditing||r.alwaysEdit)},{...o.virtualFormMap[d.row[r.rowKey]||d.row._virtualForm].easyFormItemBindData,formData:d.row._editRowClone||d.row,componentScope:{...o.virtualFormMap[d.row[r.rowKey]||d.row._virtualForm].easyFormItemBindData.componentScope,...d.componentScope}},{"onUpdate:rules":n=>{o.virtualFormMap[d.row[r.rowKey]||d.row._virtualForm].updateRules(d.field.prop,n)},onCreated:n=>{o.virtualFormMap[d.row[r.rowKey]||d.row._virtualForm].registerFormItem(d.field.prop,n)},onBeforeDestroy:n=>{const a=o.virtualFormMap[d.row[r.rowKey]||d.row._virtualForm];a&&a.unRegisterFormItem(d.field.prop,n)}}),O({_:2},[P(e.allSlotName,n=>({name:n,fn:h(a=>[D(t.$slots,n,p({isEdit:d.row._isEditing||r.alwaysEdit,editFormData:d.row._editRowClone||d.row},{...a,...d}),void 0,!0)])}))]),1040,["field","config-is-view","onUpdate:rules","onCreated","onBeforeDestroy"])):F("",!0)])}))]),1040,["modelValue","slot-mode","on-load","meta","fields"]),A(g,p({modelValue:o.dialogVisible,"onUpdate:modelValue":l[4]||(l[4]=s=>o.dialogVisible=s)},{closeOnClickModal:!1,appendToBody:!0,...r.dialogProp,title:e.getPropValue(r.dialogProp.title,o.dialogFormData,r.formProp)}),{default:h(()=>[A(f,p({ref:"EasyForm",modelValue:o.dialogFormData,"onUpdate:modelValue":l[3]||(l[3]=s=>o.dialogFormData=s)},r.formProp,{meta:{isForm:!0,...e._meta},fields:r.fields}),O({_:2},[P(e.allSlotName,s=>({name:s,fn:h(d=>[D(t.$slots,s,p({editFormData:o.dialogFormData,isEdit:!0},d),void 0,!0)])}))]),1040,["modelValue","meta","fields"])]),_:3},16,["modelValue"])])}const Ne=E(xe,[["render",Ue],["__scopeId","data-v-0a6e9667"]]),Ke={props:{options:{type:Object,default:()=>({})}},data(){return{visible:!0,lockClose:!1}},computed:{lockBind(){return this.lockClose?{closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1}:{}}}};function We(t,l,r,i,o,e){var m;const f=V("el-dialog");return u(),c(f,p({modelValue:o.visible,"onUpdate:modelValue":l[0]||(l[0]=_=>o.visible=_)},{closeOnClickModal:!1,closeOnPressEscape:!1,appendToBody:!0,destroyOnClose:!0,width:"50vw",...r.options.dialog,class:"easy-dialog "+((m=r.options.dialog)==null?void 0:m.customClass),...e.lockBind}),{default:h(()=>{var _;return[(u(),c(k((_=r.options.component)==null?void 0:_.is),z(H(r.options.component)),null,16))]}),_:1},16,["modelValue"])}const je=E(Ke,[["render",We]]),ze=(t={},l)=>{const r=A(je,{options:t});return r.appContext=l,ne(r,document.createElement("div")),r.component.proxy},He={install(t,l={}){t.config.globalProperties.$EasyDialog=(r,i)=>ze(r,i||t._context)}},Qe={install(t,l={}){t.component("EasyForm",ae),t.component("EasyFormItem",Y),t.component("EasyTable",ie),t.component("EditTable",Ne),t.use(He);const r=l.config||{};for(const i in r)j[i]=r[i]}};export{Qe as default};
