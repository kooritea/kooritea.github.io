import{_ as I,S as b,L as B,u as E,a as C,f as w,e as N,s as H,b as L,c as K,h as O}from"./index-525673ee.js";import{P as V}from"./PageHeader-eb44f00f.js";import{N as W}from"./NextButton-c6af2f38.js";import{M as U}from"./MarkDown-6d92e8ec.js";import{r as m,aN as d,o as t,h as r,L as j,$ as g,V as D,X as P,j as u,Z as x,a1 as v,Y as p,b0 as G,W as T,an as A}from"./vendor-3b101320.js";import{a as q}from"./element-plus-e4ab5447.js";import{u as z}from"./GreatOldOne-26964f9a.js";import"./highlightjs-b0208cd2.js";import"./ImageCon-493cba7f.js";const F={components:{SvgIcon:b},setup(){return{isSimplifty:m(!1)}},mounted(){this.$el.offsetHeight>600&&(this.isSimplifty=!0)}},R={key:0,class:"simplifty-mask"};function X(o,n,a,e,k,l){const c=d("SvgIcon");return t(),r("div",{class:P(["simplifty-box",{"is-simplifty":e.isSimplifty}])},[j(o.$slots,"default",{},void 0,!0),e.isSimplifty?(t(),r("div",R,[g(c,{name:"icon-zhankai",class:"expend-button",onClick:n[0]||(n[0]=y=>e.isSimplifty=!1)})])):D("",!0)],2)}const Y=I(F,[["render",X],["__scopeId","data-v-72bf6d9a"]]);const Z={components:{Markdown:U,SimpliftyBox:Y,LoadingIcon:B,"el-popover":q},props:{essay:{type:Object,required:!0},essayMap:{type:Object,required:!0},inPopover:{type:Boolean,default:!1}},emits:["set-search-key-word","load-essay-by-id"],setup(){const{darkMode:o}=E(),{darkModeDecodeKey:n}=C();return{darkMode:o,decodeHide:e=>N(e,n.value),formatDate:w,Error}}},J={class:"essay"},Q=["onClick"],$={class:"hashtag"},ee={key:0,class:"loading-box"},se={key:1},oe={class:"info"},ne={class:"essay-id"};function ae(o,n,a,e,k,l){const c=d("LoadingIcon"),y=d("ChaosItem",!0),_=d("el-popover"),f=d("Markdown"),h=d("SimpliftyBox");return t(),r("div",J,[u("article",{class:P(["article",{"in-popover":a.inPopover}])},[g(h,null,{default:x(()=>[g(f,{"model-value":e.darkMode&&a.essay.hide?e.decodeHide(a.essay.hide):a.essay.content},{hashtag:x(({hashtag:s})=>[!/^#\d+$/.test(s)||a.inPopover?(t(),r("span",{key:0,class:"hashtag",onClick:i=>o.$emit("set-search-key-word",s)},v(s),9,Q)):(t(),p(_,{key:1,width:"",trigger:"click","popper-class":"popper-essay",effect:e.darkMode?"dark":"light",onShow:()=>{a.essayMap[s.slice(1)]||o.$emit("load-essay-by-id",s.slice(1))}},{reference:x(()=>[u("span",$,v(s),1)]),default:x(()=>[!a.essayMap[s.slice(1)]||a.essayMap[s.slice(1)]instanceof e.Error?(t(),r("div",ee,[a.essayMap[s.slice(1)]?(t(),r("span",se,v(a.essayMap[s.slice(1)].message),1)):(t(),p(c,{key:0}))])):(t(),p(y,{key:1,essay:a.essayMap[s.slice(1)],"essay-map":a.essayMap,"in-popover":!0,onSetSearchKeyWord:n[0]||(n[0]=i=>{o.$emit("set-search-key-word",i)})},null,8,["essay","essay-map"]))]),_:2},1032,["effect","onShow"]))]),_:1},8,["model-value"])]),_:1})],2),u("div",oe,[u("span",ne,"#"+v(a.essay.id),1),u("span",null,v(e.formatDate(a.essay.time,`yyyy-MM-dd HH:mm:ss UTC ${e.darkMode?"NDD":"DD"}`)),1)])])}const te=I(Z,[["render",ae],["__scopeId","data-v-4ba51001"]]);const ie={components:{ChaosItem:te,PageHeader:V,NextButton:W,SvgIcon:b,MDEditor:G({loader:()=>O(()=>import("./MDEditor-c9eec8c1.js"),["https://kooritea.moe/assets/MDEditor-c9eec8c1.js","https://kooritea.moe/assets/vendor-3b101320.js","https://kooritea.moe/assets/highlightjs-b0208cd2.js","https://kooritea.moe/assets/highlightjs-5f5db245.css","https://kooritea.moe/assets/index-525673ee.js","https://kooritea.moe/assets/element-plus-e4ab5447.js","https://kooritea.moe/assets/element-plus-cca30648.css","https://kooritea.moe/assets/index-2969e101.css","https://kooritea.moe/assets/MarkDown-6d92e8ec.js","https://kooritea.moe/assets/ImageCon-493cba7f.js","https://kooritea.moe/assets/ImageCon-7200ecbe.css","https://kooritea.moe/assets/MarkDown-8f8332f9.css","https://kooritea.moe/assets/GreatOldOne-26964f9a.js","https://kooritea.moe/assets/MDEditor-65f66bbd.css"],import.meta.url),loadingComponent:B})},setup(){const o=m({}),{darkMode:n,isGreatOldOne:a}=E(),{offlineMode:e,darkModeDecodeKey:k}=C(),l=m(""),c=m([]),y=m(!1),_=m(!1),f=m(null),h=i=>N(i,k.value),s=i=>(_.value=!0,K(i).then(M=>{M=M.map(S=>(o.value[S.id]=S,{...S,expend:!1})),y.value=M.length===10,c.value.push(...M)}).finally(()=>{_.value=!1}));return s(),{loading:_,searchBlogEssays:s,essays:c,searchKeyWord:l,offlineMode:e,hasNext:y,darkMode:n,essayMap:o,setScorllGotoTop:H,isGreatOldOne:a,editing:f,decodeHide:h}},methods:{search(o){if(this.essays=[],this.offlineMode&&o&&!/^#\d+$/.test(o)){this.$msgBox.error("离线模式下仅可以使用id搜索");return}return this.searchBlogEssays({keyword:o})},onNext(){var n;const o=(n=this.essays[this.essays.length-1])==null?void 0:n.id;return this.searchBlogEssays({keyword:this.searchKeyWord,start:o?o-1:void 0})},loadEssayById(o){if(this.essayMap[o]!==null)return this.essayMap[o]=null,L({id:o}).then(n=>{this.essayMap[o]=n}).catch(n=>{this.essayMap[o]=new Error(n)})},onSubmitUpdateEssay(o,n,a){return z(o.id,{content:n?void 0:a,hide:n?a:void 0}).then(e=>{Object.assign(o,e),this.editing=null})}}},de={class:"page"};function re(o,n,a,e,k,l){const c=d("PageHeader"),y=d("ChaosItem"),_=d("MDEditor"),f=d("SvgIcon"),h=d("NextButton");return t(),r("div",de,[g(c,{modelValue:e.searchKeyWord,"onUpdate:modelValue":n[0]||(n[0]=s=>e.searchKeyWord=s),"show-search-input":!0,"on-input":l.search},null,8,["modelValue","on-input"]),u("ul",null,[(t(!0),r(T,null,A(e.essays,s=>(t(),r("li",{key:s.id,class:"essay-box"},[e.editing!==s?(t(),p(y,{key:0,essay:s,"essay-map":e.essayMap,onSetSearchKeyWord:n[1]||(n[1]=i=>{e.searchKeyWord=i,e.setScorllGotoTop()}),onLoadEssayById:l.loadEssayById},null,8,["essay","essay-map","onLoadEssayById"])):(t(),p(_,{key:1,"model-value":e.darkMode?e.decodeHide(s.hide):s.content,cache:!1,"ex-handlers":[{name:"取消",handler:()=>{e.editing=null}}],"on-submit":i=>l.onSubmitUpdateEssay(s,e.darkMode,i)},null,8,["model-value","ex-handlers","on-submit"])),e.isGreatOldOne&&e.editing!==s?(t(),p(f,{key:2,name:"icon-bianji",onClick:i=>e.editing=s},null,8,["onClick"])):D("",!0)]))),128))]),g(h,{hasNext:e.hasNext,"onUpdate:hasNext":n[2]||(n[2]=s=>e.hasNext=s),loading:e.loading,"onUpdate:loading":n[3]||(n[3]=s=>e.loading=s),"on-click":l.onNext},null,8,["hasNext","loading","on-click"])])}const ve=I(ie,[["render",re],["__scopeId","data-v-ea313bb0"]]);export{ve as default};
