import{P as M}from"./PageHeader-281174f9.js";import{_ as k,u as E,j as z,f as v}from"./index-13be8594.js";import{u as H,i as B,a as L,b as S,c as G,d as V,e as q,f as g}from"./echarts-443ca982.js";import{b2 as y,a_ as N,bh as T,aY as b,aP as x,aQ as C,bA as O,bq as $,ch as w,bo as A,bv as Y,bx as K}from"./vendor-b07f99b0.js";import{o as Q}from"./GreatOldOne-3e9ecca7.js";import"./element-plus-20d21a73.js";import"./highlightjs-4914df6f.js";H([B,L,S,G,V,q]);const U={props:{option:{type:Object,default:()=>({})}},setup(p,{emit:l}){const r=y(!0),{darkMode:e}=E(),{computedOption:n}=z(p,l),o=y(null);let t;const i=()=>{t&&n.value&&t.resize()};return N(()=>{t=g(o.value,e.value?"dark":void 0),n.value&&t.setOption(n.value),window.addEventListener("resize",i)}),T(()=>{window.removeEventListener("resize",i)}),b(n,()=>{t&&n.value&&t.setOption(n.value)}),b(e,()=>{r.value=!1,$(()=>{r.value=!0,$(()=>{t=g(o.value,e.value?"dark":void 0),t.setOption(n.value)})})}),{echars:o,refreshCache:r}}},X={key:0,ref:"echars",style:{height:"500px"}};function j(p,l,r,e,n,o){return e.refreshCache?(x(),C("div",X,null,512)):O("",!0)}const F=k(U,[["render",j]]);const J={components:{PageHeader:M,EChars:F},setup(){const p=c=>{let s="";for(const a in c)s?c[a]>c[s]&&(s=a):s=a;return s},l=new Date;l.setHours(0,0,0,0);const r=new Array(7).fill(null).map((c,s)=>{const a=new Date(l.valueOf()-s*1e3*60*60*24);return v(a,"yyyy-MM-dd")}).reverse(),e=[],n=y(null),o=[],t=[],i=y(null);return Q().then(c=>{const s=c.sort((a,d)=>a.accessInfo.length-d.accessInfo.length);for(const{uuid:a,accessInfo:d,tagCount:D}of s){o.push(p(D));for(const{date:I,requestInfo:f}of d){const P=new Date(I),h=r.findIndex(_=>v(P,"yyyy-MM-dd")===_);e[h]||(e[h]=[]),e[h].includes(a)||e[h].push(a);const m=o.length-1;let u=t.find(_=>_.name===`${f.method} ${f.url}`);u||(u={name:`${f.method} ${f.url}`,type:"bar",stack:"total",label:{show:!0},emphasis:{focus:"series"},data:[]},t.push(u)),u.data[m]||(u.data[m]=0),u.data[m]++}}n.value={title:{text:"独立访客人数"},tooltip:{trigger:"axis",confine:!0},xAxis:{type:"category",boundaryGap:!1,data:r},yAxis:{type:"value"},series:[{name:"人数",type:"line",data:e.map(a=>a.length)}]},i.value={title:{text:"各访客访问情况"},tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"shadow"},extraCssText:"width:300px;white-space: break-spaces;"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:o,axisLabel:{formatter:function(a,d){return a.slice(0,6)}}},series:t}}),{option1:n,option2:i}}},R={class:"page"};function W(p,l,r,e,n,o){const t=w("PageHeader"),i=w("EChars");return x(),C("div",R,[A(t),A(i,{option:e.option1,style:{height:"500px"}},null,8,["option"]),e.option2?(x(),Y(i,{key:0,option:e.option2,style:K({height:`${e.option2.yAxis.data.length*50+100}px`})},null,8,["option","style"])):O("",!0)])}const re=k(J,[["render",W],["__scopeId","data-v-b92fde3d"]]);export{re as default};
