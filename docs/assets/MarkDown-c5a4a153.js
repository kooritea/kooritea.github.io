import{az as w,o as p,e as g,_ as S,$ as T,r as u,l as M,f as d,a0 as f,V as x,aB as R,S as D,T as L,U as E,W as I,X as V,aU as k,aV as U,x as F,ap as m}from"./vendor-dfc99adc.js";import{I as B}from"./ImageCon-1c7c2093.js";import{_ as y,S as H,i as A,w as O,n as W,L as P,o as z}from"./index-2066ac77.js";import"./highlightjs-b0208cd2.js";const N={components:{ImageCon:B},props:{src:{type:String,default:()=>""},alt:{type:String,default:()=>""},srcPreFix:{type:[Array,String],default:()=>["https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://fastly.jsdelivr.net/gh/kooritea/kooritea.github.io/img","https://raw.githubusercontent.com/kooritea/kooritea.github.io/img"]}}},Y={class:"md-image"};function q(s,o,t,e,r,i){const n=w("ImageCon");return p(),g("div",Y,[S(n,{ref:"ImageCon",src:t.src,prefix:t.srcPreFix,alt:t.alt||t.src,onClick:o[0]||(o[0]=c=>s.$imagePreview(s.$refs.ImageCon.applySrc)),onDragstart:o[1]||(o[1]=T(()=>{},["prevent"]))},null,8,["src","prefix","alt"])])}const X=y(N,[["render",q],["__scopeId","data-v-33168729"]]);const Z={components:{SvgIcon:H},props:{content:{type:String,required:!0},lang:{type:String,default:""}},setup(s){const o=u(!1);let t=null;return A(()=>import("./highlightjs-b0208cd2.js").then(e=>e.i),["https://kooritea.moe/assets/highlightjs-b0208cd2.js","https://kooritea.moe/assets/highlightjs-5f5db245.css"],import.meta.url).then(e=>{o.value=!0,t=e.default}),{highlightCode:M(()=>{if(o.value&&t.getLanguage(s.lang.toLowerCase()))return t.highlight(s.content,{language:s.lang.toLowerCase()}).value;{const e=document.createElement("div");return e.innerHTML=s.content,e.innerText}}),lineCount:M(()=>s.content.split(`
`).length-1)}},methods:{writeTextToClipboard(){O(this.content),this.$msgBox.success("复制成功")}}},G={class:"code-block"},J={class:"code-meta"},K={class:"lang"},Q={class:"code"},ee={class:"line-numbers"},te=["innerHTML"];function ne(s,o,t,e,r,i){const n=w("SvgIcon");return p(),g("div",G,[d("div",J,[d("span",K,f(`${t.lang.slice(0,1).toUpperCase()}${t.lang.slice(1)}`),1),d("span",{class:"copy",onClick:o[0]||(o[0]=(...c)=>i.writeTextToClipboard&&i.writeTextToClipboard(...c))},[S(n,{name:"icon-copy"})])]),d("div",Q,[d("div",ee,[(p(!0),g(x,null,R(new Array(e.lineCount).fill(""),(c,_)=>(p(),g("div",{key:_,class:"number"},f(_+1),1))),128))]),d("pre",{innerHTML:e.highlightCode},null,8,te)])])}const oe=y(Z,[["render",ne],["__scopeId","data-v-8f787fc5"]]);const se=String.fromCharCode(8205),re=/\uFE0F/g,ce=(s,o="-")=>{const t=[];let e=0,r=0,i=0;for(;i<s.length;)e=s.charCodeAt(i++),r?(t.push((65536+(r-55296<<10)+(e-56320)).toString(16)),r=0):e>=55296&&e<=56319?r=e:t.push(e.toString(16));return t.join(o)};function ie(s){return ce(s.indexOf(se)<0?s.replace(re,""):s)}const ae={components:{ImageCon:B},props:{emoji:{type:String,default:""}},setup(s){const o=u(!1),e=`/${ie(s.emoji)}.png`;return{showEmojiImg:o,imgSrc:e}}},le={key:0};function de(s,o,t,e,r,i){const n=w("ImageCon");return p(),g(x,null,[D(S(n,{class:"emoji",src:e.imgSrc,prefix:["https://cdn.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://fastly.jsdelivr.net/gh/twitter/twemoji/assets/72x72","https://raw.githubusercontent.com/twitter/twemoji/assets/72x72"],alt:t.emoji,onLoad:o[0]||(o[0]=c=>e.showEmojiImg=!0)},null,8,["src","prefix","alt"]),[[L,e.showEmojiImg]]),e.showEmojiImg?E("",!0):(p(),g("span",le,f(t.emoji),1))],64)}const ue=y(ae,[["render",de],["__scopeId","data-v-2dd6e819"]]);const _e={props:{content:{type:String,default:""}},setup(s){const o=s.content.match(/\[bilibili ((av|bv|AV|BV)[a-zA-Z0-9]+)?( p.*?)?\]/),t=o[1],e=((o?o[3]:"")||"").slice(2),r=u(`https://player.bilibili.com/player.html?bvid=${t}${e?"?page="+e:""}`),i=u(`https://www.bilibili.com/video/${t}${e?"?p="+e:""}`),n=u(!0);return{playerSrc:r,webSiteSrc:i,loading:n,id:u(t)}}},pe=["href"],ge=["src"];function me(s,o,t,e,r,i){return p(),g("div",null,[d("p",null,[d("a",{class:"link",href:e.webSiteSrc,target:"_blank"},f(e.id),9,pe)]),d("iframe",{src:e.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:I(["bilibili-player",{loading:e.loading}]),onLoad:o[0]||(o[0]=n=>e.loading=!1)},null,42,ge)])}const he=y(_e,[["render",me],["__scopeId","data-v-c2f21cd0"]]);const fe={props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[youtube (.*?)\]/)[1],e=u(`https://www.youtube.com/embed/${t}`),r=u(`https://www.youtube.com/watch?v=${t}`),i=u(!0);return{playerSrc:e,webSiteSrc:r,loading:i,id:u(t)}}},ye=["href"],ve=["src"];function be(s,o,t,e,r,i){return p(),g("div",null,[d("p",null,[d("a",{class:"link",href:e.webSiteSrc,target:"_blank"},f(e.id),9,ye)]),d("iframe",{src:e.playerSrc,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",class:I(["youtube-player",{loading:e.loading}]),onLoad:o[0]||(o[0]=n=>e.loading=!1)},null,42,ve)])}const ke=y(fe,[["render",be],["__scopeId","data-v-40b9d9a4"]]);function we(s){return W({url:`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/music/${s}.mp3`,responseType:"arraybuffer"}).then(o=>{const[t,e]=s.split("-");return A(()=>import("./vendor-dfc99adc.js").then(r=>r.i),["https://kooritea.moe/assets/vendor-dfc99adc.js","https://kooritea.moe/assets/highlightjs-b0208cd2.js","https://kooritea.moe/assets/highlightjs-5f5db245.css"],import.meta.url).then(r=>{const i=r.default,c=new i(o).ID3V2.findLabel("APIC");return{picUrl:c?URL.createObjectURL(new Blob([c.content.pictureBuffer])):"",name:t,singer:e,id:s}})})}const $e={components:{LoadingIcon:P},props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[music (.*?)\]/)[1],e=u({}),r=u(!0),i=u("");return(t.startsWith("private")?we(t.slice(8)):z(t)).then(n=>{e.value=n}).catch(n=>{i.value=n.message}).finally(()=>{r.value=!1}),{loading:r,error:i,id:u(t),music:e}}},Se={class:"music-player-simple"},xe={key:1,class:"error-msg"},Ie=["src"],Ce={class:"info"},je={class:"song-name"},Me={class:"singer-name"};function Te(s,o,t,e,r,i){const n=w("LoadingIcon");return p(),g("div",Se,[e.loading?(p(),V(n,{key:0})):e.error?(p(),g("div",xe,f(e.error),1)):(p(),g(x,{key:2},[d("img",{class:"music-player-simple-pic",src:e.music.picUrl},null,8,Ie),d("div",Ce,[d("p",je,"🎶"+f(e.music.name),1),d("p",Me,f(e.music.singer),1)])],64))])}const De=y($e,[["render",Te],["__scopeId","data-v-4d341720"]]);const Le={components:{LoadingIcon:P},props:{content:{type:String,default:""}},setup(s){const t=s.content.match(/\[emoji (.*?)\]/)[1],e=u(`https://cdn.jsdelivr.net/gh/kooritea/kooritea.github.io/emoji/${t}.png`),r=u(!0);return{id:u(t),loading:r,imageSrc:e}}},Ee={class:"md-sticker"},Ve=["src","alt"];function Be(s,o,t,e,r,i){const n=w("LoadingIcon");return p(),g("div",Ee,[e.loading?(p(),V(n,{key:0,class:"loading"})):E("",!0),D(d("img",{class:I(["sticker-image",{"sticker-image-loading":e.loading}]),src:e.imageSrc,alt:e.id||s.src,onLoad:o[0]||(o[0]=c=>e.loading=!1),onDragstart:o[1]||(o[1]=T(()=>{},["prevent"]))},null,42,Ve),[[L,!e.loading]])])}const Ae=y(Le,[["render",Be],["__scopeId","data-v-a9f4fe05"]]),Pe={props:{hashtag:{type:String,default:""}},emits:["hashtag-click"],methods:{onClick(s){this.$emit("hashtag-click",{event:s,hashtag:this.hashtag.slice(1)})}}};function Re(s,o,t,e,r,i){return p(),g("a",{href:"#",onClick:o[0]||(o[0]=(...n)=>i.onClick&&i.onClick(...n))},f(t.hashtag),1)}const Ue=y(Pe,[["render",Re]]);function C(s,o){return function(t){const{tokens:e}=t;for(const r of e){if(r.type!=="inline")continue;const i=[],n=[];for(const c of r.children){if(c.type.endsWith("_open")){const _=c.type.slice(0,c.type.indexOf("_open"));n.push(_)}if(c.type.endsWith("_close")&&n.pop(),c.type==="text"&&s.test(c.content)){const _=c.content;let l=0;if(_.replace(new RegExp(s,"g"),function(...a){const[b]=a,h=o(b,n);if(h!==!1){const v=a[a.length-2];if(v>l){const j=new k("text","",0);j.content=_.slice(l,v),i.push(j)}l=v+b.length,i.push(h)}}),l<_.length){const a=new k("text","",0);a.content=_.slice(l),i.push(a)}}else i.push(c)}r.children=i}}}function Fe(s){return C(/(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f\ude80-\udeff])|[\u2600-\u2B55]/,t=>{const e=new k("emoji","",0);return e.markup=t,e.content=t,e})}function He(s,o){s.core.ruler.after("linkify","emoji",Fe())}function Oe(s){const o=/\[((music)|(youtube)|(bilibili)|(emoji)) (.*?)\]/;return C(o,t=>{const e=t.match(o),r=new k("media","",0);return r.markup=t,r.content=t,r.block=!0,r.info=e[1],r})}function We(s,o){s.core.ruler.after("text_join","media",Oe())}function ze(s){return C(/#(\S*)/,(t,e)=>{if(e[e.length-1]==="link")return!1;const r=new k("hashtag","",0);return r.markup=t,r.content=t,r})}function Ne(s,o){s.core.ruler.after("linkify","hashtag",ze())}const $=new U({breaks:!0});$.use(He);$.use(We);$.use(Ne);const Ye={props:{modelValue:{type:String,default:()=>""}},emits:["hashtag-click"],setup(s,o){const t=function(i){const n=[],c=[];for(let _=0;_<i.length;_++){const l=i[_];if(l.type.endsWith("_open")){const a=l.type.slice(0,l.type.indexOf("_open"));c.push({type:a,tag:l.tag,block:l.block,content:"",attrs:l.attrs,children:[]});continue}if(l.type.endsWith("_close")){if(c.length>1){const a=c.pop();c[c.length-1].children.push(a)}else n.push(c.pop());continue}if(c.length>0){const a=c[c.length-1];a.content=l.content,l.type==="inline"?a.children.push(...t(l.children)):a.children.push(l)}else n.push(l)}return n},e=function(i){return i.map(n=>{var _,l;const c=((_=n.attrs)==null?void 0:_.reduce((a,b)=>{const[h,v]=b;return a[h]?Array.isArray(a[h])?a[h].push(v):a[h]=[a[h],v]:a[h]=v,a},{}))||{};switch(n.type){case"text":return n.content;case"emoji":return m(ue,{...c,emoji:n.content,key:n.content},"");case"hashtag":return m(o.slots.hashtag??Ue,{...c,hashtag:n.content,key:n.content,onHashtagClick:a=>{o.emit("hashtag-click",a)}},"");case"media":{switch(n.info){case"bilibili":return m(he,{...c,content:n.content,key:n.content},"");case"youtube":return m(ke,{...c,content:n.content,key:n.content},"");case"music":return m(De,{...c,content:n.content,key:n.content},"");case"emoji":return m(Ae,{...c,content:n.content,key:n.content},"")}break}case"link":return m(n.tag,{...c,target:"_blank"},e(n.children));case"image":return m(X,{src:c.src,alt:n.content,key:n.content},"");case"fence":return m(oe,{...c,lang:n.info||"text",content:n.content,key:n.content},"");default:return m(n.tag||"span",c,((l=n.children)==null?void 0:l.length)>0?e(n.children):n.content)}})},r=F(s,"modelValue");return()=>{const i=t($.parse(r.value,{}));return m("div",{class:"markdown-body"},e(i))}}},Je=y(Ye,[["__scopeId","data-v-dd808ed6"]]);export{Je as M};
