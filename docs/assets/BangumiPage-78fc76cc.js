import{P as $}from"./PageHeader-572ec18b.js";import{_ as D,ad as L,A as S,ae as A,m as O,u as E,r as k,b as v,af as P,d as i,e as c,R as U,h as d,s as V,t as u,f as w,g as p,w as K,l as b,a as x,ag as N,c as W,F as y,aa as h,n as f,ah as B}from"./index-91089e9d.js";import{I as j}from"./ImageCon-3c0b7ee0.js";import{a as C,g as F}from"./GreatOldOne-fe62750b.js";const G={components:{ImageCon:j,SwitchButton:L,AsyncButtom:S},directives:{mask:A},props:{bangumi:{type:Object,required:!0}},setup(r,{emit:s}){const{computedBangumi:_}=O(r,s),{mobileMode:e,isGreatOldOne:g}=E(),m=k(!1);return{cancel:()=>{e.value&&!m.value&&(_.value=null)},computedBangumi:_,isGreatOldOne:g,globalLoading:m}},methods:{onSwitchBangumiState(r,s){return C(r.id,{state:s})},onUpdateBangumiInfo(r){return F(r.subject).then(s=>{const _={...r,...s};return delete _.deletedAt,delete _.id,C(r.id,_).then(e=>{Object.assign(r,e)})})}}},H={class:"bangumi-viewer-container"},M={class:"preview"},R={class:"name"},q={class:"nname"},z={class:"switch-time-episode"},T={class:"time-episode"};function Y(r,s,_,e,g,m){const o=v("ImageCon"),l=v("SwitchButton"),n=v("AsyncButtom"),t=P("mask");return i(),c("div",{class:"bangumi-viewer",onClick:s[2]||(s[2]=(...a)=>e.cancel&&e.cancel(...a))},[U((i(),c("div",H,[d("div",M,[V(o,{src:e.computedBangumi.img,prefix:["https://lain.bgm.tv/pic/cover/l"]},null,8,["src","prefix"])]),d("div",R,u(e.computedBangumi.name),1),d("div",q,u(e.computedBangumi.nname),1),d("div",z,[e.isGreatOldOne?(i(),w(l,{key:0,modelValue:e.computedBangumi.state,"onUpdate:modelValue":s[0]||(s[0]=a=>e.computedBangumi.state=a),loading:e.globalLoading,"onUpdate:loading":s[1]||(s[1]=a=>e.globalLoading=a),"on-click":a=>m.onSwitchBangumiState(e.computedBangumi,a)},null,8,["modelValue","loading","on-click"])):p("",!0),e.isGreatOldOne?(i(),w(n,{key:1,type:"primary","on-click":()=>m.onUpdateBangumiInfo(e.computedBangumi)},{default:K(()=>[b(" 更新信息 ")]),_:1},8,["on-click"])):p("",!0),d("span",T," ("+u(e.computedBangumi.episode)+"话)"+u(e.computedBangumi.time),1)])])),[[t,!0]])])}const J=D(G,[["render",Y],["__scopeId","data-v-10173923"]]);const Q={components:{PageHeader:$,BangumiViewer:J},setup(){const r=k(""),s=x([]),_=k(null),e=x({notExistDate:[],year:[]});e.notExistDate.open=!1,N().then(m=>{const o={};for(const l of m)if(!l.time)e.notExistDate.push(l);else{const n=new Date(l.time),t=n.getFullYear(),a=n.getMonth()+1;o[t]||(o[t]=[],o[t].year=t,o[t].open=!1,o[t].total=0,o[t].complete=0,e.year.push(o[t])),o[`${t}-${a}`]||(o[`${t}-${a}`]=[],o[`${t}-${a}`].month=`${t}-${a}`,o[`${t}-${a}`].open=!1,o[`${t}-${a}`].total=0,o[`${t}-${a}`].complete=0,o[t].push(o[`${t}-${a}`])),o[t].total++,o[`${t}-${a}`].total++,l.state&&(o[t].complete++,o[`${t}-${a}`].complete++),o[`${t}-${a}`].push(l)}e.year=e.year.sort((l,n)=>n.year-l.year);for(const l in e.year){e.year[l]=e.year[l].sort((n,t)=>n.month-t.month);for(const n in e.year[l])Array.isArray(e.year[l][n])&&(e.year[l][n]=e.year[l][n].sort((t,a)=>new Date(t.time)-new Date(a.time)))}s.value=m});const g=W(()=>r.value?s.value.filter(m=>{var o,l;return((o=m.name)==null?void 0:o.includes(r.value))||((l=m.nname)==null?void 0:l.includes(r.value))}):[]);return{selectedBangumi:_,bangumiDateList:e,bangumiSearchList:g,searchKeyWord:r}},methods:{}},X={class:"page"},Z={class:"container"},I={key:0,class:"list"},ee={key:0,class:"year-item"},te={key:0},ne=["title"],oe=["onClick"],ae={class:"item-info"},se={key:0},ie=["onClick"],le={class:"item-info"},ce={key:0},re=["title","onClick"],de={key:1,class:"list search-list"},ue=["title","onClick"];function me(r,s,_,e,g,m){const o=v("PageHeader"),l=v("BangumiViewer");return i(),c("div",X,[V(o,{modelValue:e.searchKeyWord,"onUpdate:modelValue":s[0]||(s[0]=n=>e.searchKeyWord=n),"show-search-input":!0},null,8,["modelValue"]),d("div",Z,[e.searchKeyWord?(i(),c("div",de,[d("ul",null,[(i(!0),c(y,null,h(e.bangumiSearchList,n=>(i(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:t=>e.selectedBangumi=n},u(n.name),11,ue))),128))])])):(i(),c("div",I,[d("ul",null,[e.bangumiDateList.notExistDate.length>0?(i(),c("li",ee,[b(" 放送时间未确认 "),e.bangumiDateList.notExistDate.open?(i(),c("ul",te,[(i(!0),c(y,null,h(e.bangumiDateList.notExistDate,n=>(i(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:s[1]||(s[1]=B(()=>{},["stop"]))},u(n.name),11,ne))),128))])):p("",!0)])):p("",!0),(i(!0),c(y,null,h(e.bangumiDateList.year,n=>(i(),c("li",{key:n.year,class:"year-item",onClick:t=>n.open=!n.open},[d("div",ae,[d("span",null,u(n.year),1),d("span",null,u(n.complete)+"/"+u(n.total),1)]),n.open?(i(),c("ul",se,[(i(!0),c(y,null,h(n,t=>(i(),c("li",{key:t.month,class:"month-item",onClick:B(a=>t.open=!t.open,["stop"])},[d("div",le,[d("span",null,u(t.month),1),d("span",null,u(t.complete)+"/"+u(t.total),1)]),t.open?(i(),c("ul",ce,[(i(!0),c(y,null,h(t,a=>(i(),c("li",{key:a.id,class:f(["bangumi-item",{complete:a.state}]),title:a.nname,onClick:B(_e=>e.selectedBangumi=a,["stop"])},u(a.name),11,re))),128))])):p("",!0)],8,ie))),128))])):p("",!0)],8,oe))),128))])])),e.selectedBangumi?(i(),w(l,{key:2,bangumi:e.selectedBangumi,"onUpdate:bangumi":s[2]||(s[2]=n=>e.selectedBangumi=n)},null,8,["bangumi"])):p("",!0)])])}const ve=D(Q,[["render",me],["__scopeId","data-v-618dcee7"]]);export{ve as default};
