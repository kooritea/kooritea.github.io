import{_ as S,A as B,ab as b,a5 as C,Z as k,a9 as F,L as I,ac as D}from"./index-6dfeff5e.js";import{cf as d,aQ as r,aR as p,bC as h,bw as i,bA as v,aS as u,aZ as V,bZ as w,bv as m,bB as g,br as T,b$ as A,bz as y}from"./vendor-23d2f8cc.js";const R={components:{AsyncButtom:B},props:{modelValue:{type:String,default:()=>"00:00:00"},sourcePath:{type:String,default:()=>""}},emits:["update:modelValue"],data(){return{images:[],timeControllers:[{label:"-1m",value:-60},{label:"-10s",value:-10},{label:"-1s",value:-1},{label:"+1s",value:1},{label:"+10s",value:10},{label:"+1m",value:60}]}},methods:{updateTimestring(e){this.$emit("update:modelValue",`${b(C(this.modelValue.split(".")[0])+e)}.${this.modelValue.split(".")[1]}`)},async refreshScreenshots(e){if(!this.sourcePath){this.$msgBox.warning("请先选择视频源");return}for(const n of this.images)n.originSrc&&URL.revokeObjectURL(n.originSrc),URL.revokeObjectURL(n.src);this.images=[{ts:this.modelValue,src:await this.getScreenshots(this.modelValue,e)}];const l=C(this.modelValue),s=b(k.subtract(l,.1),!0);this.images.unshift({ts:s,src:await this.getScreenshots(s,e)});for(const n in new Array(3).fill(null)){const a=b(k.add(l,(Number(n)+1)*.1),!0);this.images.push({ts:a,src:await this.getScreenshots(a,e)})}},getScreenshots(e,l){return F(this.sourcePath,e,l).then(s=>URL.createObjectURL(s))}}},U={class:"preview-screenshots"},M={class:"screenshots-box"},N={class:"btn-box"},O={class:"image-box"},j={class:"ts"},z=["src","onClick"];function Z(e,l,s,n,a,c){const _=d("AsyncButtom");return r(),p("div",U,[h(_,{type:"primary",size:"mini",onLoadingClick:()=>c.refreshScreenshots("jpg")},{default:i(()=>[v(" 获取截图 ")]),_:1},8,["onLoadingClick"]),u("div",M,[u("div",N,[(r(!0),p(V,null,w(a.timeControllers,t=>(r(),m(_,{key:t.label,size:"mini",onLoadingClick:()=>{c.updateTimestring(t.value)}},{default:i(()=>[v(g(t.label),1)]),_:2},1032,["onLoadingClick"]))),128))]),u("div",O,[(r(!0),p(V,null,w(a.images,t=>(r(),p("div",{key:t.src,class:T(["item-box",{active:t.ts===s.modelValue}])},[u("div",j,g(t.ts),1),u("img",{class:"image",src:t.src,onClick:()=>{t.ts===s.modelValue?e.$imagePreview(()=>t.originSrc?t.originSrc:c.getScreenshots(t.ts,"png").then(f=>(t.originSrc=f,f)),{fileName:s.sourcePath.slice(s.sourcePath.lastIndexOf("/")+1).split(".")[0]}):e.$emit("update:modelValue",t.ts)}},null,8,z)],2))),128))])])])}const J=S(R,[["render",Z],["__scopeId","data-v-cc20387d"]]),E={components:{LoadingIcon:I},props:{modelValue:{type:[String,Array],default:void 0},checkMode:{type:String,default:()=>""}},emits:["update:modelValue"],data(){return{loading:!1,useFileFilter:!0,tableData:[],currentPath:"/"}},computed:{filterTableData(){return this.tableData.filter(e=>this.fileFilter&&this.useFileFilter&&e.type==="file"?this.fileFilter(e):!0)}},watch:{modelValue:{immediate:!0,handler(e){if(e){const l=e.slice(0,e.lastIndexOf("/"))||"/";this.currentPath!==l&&this.load(l)}}}},created(){this.load(this.currentPath)},methods:{onCellClick(e,l,s,n){l.property==="name"&&(e.type==="dir"?this.load(e.path):e.type==="file"&&this.$emit("update:modelValue",e.path))},onSelectionChange(){},load(e){this.loading=!0,this.loader(e).then(l=>{this.tableData=[...l].sort((s,n)=>{const a=s.type.localeCompare(n.type);return a!==0?a:s.name.localeCompare(n.name)}),e!=="/"&&this.tableData.unshift({type:"dir",name:"..",path:e.slice(0,e.slice(0,e.length-1).lastIndexOf("/"))||"/"}),this.currentPath=e}).finally(()=>{this.loading=!1})},loader(){throw new Error("loader需实现")}}};function Q(e,l,s,n,a,c){const _=d("LoadingIcon"),t=d("el-table-column"),f=d("el-radio"),x=d("el-radio-group"),L=d("el-switch"),P=d("el-table");return r(),m(P,{border:"",data:c.filterTableData,style:{width:"100%"},onCellClick:c.onCellClick,onSelectionChange:c.onSelectionChange},A({default:i(()=>[s.checkMode==="multiple"?(r(),m(t,{key:0,type:"selection",selectable:o=>o.type==="file"},null,8,["selectable"])):y("",!0),s.checkMode==="single"?(r(),m(t,{key:1,width:"40px"},{default:i(o=>[o.row.path===s.modelValue?(r(),m(x,{key:0,"model-value":o.row.path},{default:i(()=>[h(f,{value:o.row.path},null,8,["value"])]),_:2},1032,["model-value"])):y("",!0)]),_:1})):y("",!0),h(t,{"class-name":"filename-cell","show-overflow-tooltip":"",prop:"name",label:"文件名"},{header:i(()=>[v(" 文件名 "),h(L,{modelValue:a.useFileFilter,"onUpdate:modelValue":l[0]||(l[0]=o=>a.useFileFilter=o),"active-text":"打开文件过滤"},null,8,["modelValue"])]),default:i(o=>[u("span",null,g(o.row.type==="dir"?"📁":"📄")+g(o.row.name),1)]),_:1})]),_:2},[a.loading?{name:"empty",fn:i(()=>[u("div",null,[h(_)])]),key:"0"}:void 0]),1032,["data","onCellClick","onSelectionChange"])}const $=S(E,[["render",Q]]);const q={extends:$,methods:{loader(e){return D(e).then(l=>l.children)},fileFilter(e){return["mkv","mp4","mov"].includes(e.extname)}}},K=S(q,[["__scopeId","data-v-fbd94c47"]]);export{K as M,J as P};
