import{P as $}from"./PageHeader-00e3dd43.js";import{_ as D,ai as b,aj as V,u as L,Z as S,r as B,e as y,ak as E,o as s,c,F as P,h as r,g as x,Y as d,J as C,k as p,al as w,am as O,a as H,f as K,H as v,a4 as h,i as f,a8 as k}from"./index-587b2b83.js";import{I as N}from"./ImageCon-39530ba3.js";import{a as U}from"./GreatOldOne-9440431b.js";const W={components:{ImageCon:N,SwitchButton:b},directives:{mask:V},props:{bangumi:{type:Object,required:!0}},setup(m,{emit:i}){const{computedBangumi:_}=L(m,i),{mobileMode:t,isGreatOldOne:g}=S(),u=B(!1);return{cancel:()=>{t.value&&!u.value&&(_.value=null)},computedBangumi:_,isGreatOldOne:g,globalLoading:u}},methods:{onSwitchBangumiState(m,i){return U(m.id,{state:i})}}},A={class:"bangumi-viewer-container"},F={class:"preview"},M={class:"name"},j={class:"nname"},G={class:"switch-time-episode"},Y={class:"time-episode"};function q(m,i,_,t,g,u){const o=y("ImageCon"),a=y("SwitchButton"),n=E("mask");return s(),c("div",{class:"bangumi-viewer",onClick:i[2]||(i[2]=(...e)=>t.cancel&&t.cancel(...e))},[P((s(),c("div",A,[r("div",F,[x(o,{src:t.computedBangumi.img,prefix:["https://lain.bgm.tv/pic/cover/l"]},null,8,["src","prefix"])]),r("div",M,d(t.computedBangumi.name),1),r("div",j,d(t.computedBangumi.nname),1),r("div",G,[t.isGreatOldOne?(s(),C(a,{key:0,modelValue:t.computedBangumi.state,"onUpdate:modelValue":i[0]||(i[0]=e=>t.computedBangumi.state=e),loading:t.globalLoading,"onUpdate:loading":i[1]||(i[1]=e=>t.globalLoading=e),"on-click":e=>u.onSwitchBangumiState(t.computedBangumi,e)},null,8,["modelValue","loading","on-click"])):p("",!0),r("span",Y," ("+d(t.computedBangumi.episode)+"话)"+d(t.computedBangumi.time),1)])])),[[n,!0]])])}const z=D(W,[["render",q],["__scopeId","data-v-a681fc7b"]]);const J={components:{PageHeader:$,BangumiViewer:z},setup(){const m=B(""),i=w([]),_=B(null),t=w({notExistDate:[],year:[]});t.notExistDate.open=!1,O().then(u=>{const o={};for(const a of u)if(!a.time)t.notExistDate.push(a);else{const n=new Date(a.time),e=n.getFullYear(),l=n.getMonth()+1;o[e]||(o[e]=[],o[e].year=e,o[e].open=!1,o[e].total=0,o[e].complete=0,t.year.push(o[e])),o[`${e}-${l}`]||(o[`${e}-${l}`]=[],o[`${e}-${l}`].month=`${e}-${l}`,o[`${e}-${l}`].open=!1,o[`${e}-${l}`].total=0,o[`${e}-${l}`].complete=0,o[e].push(o[`${e}-${l}`])),o[e].total++,o[`${e}-${l}`].total++,a.state&&(o[e].complete++,o[`${e}-${l}`].complete++),o[`${e}-${l}`].push(a)}t.year=t.year.sort((a,n)=>n.year-a.year);for(const a in t.year){t.year[a]=t.year[a].sort((n,e)=>n.month-e.month);for(const n in t.year[a])Array.isArray(t.year[a][n])&&(t.year[a][n]=t.year[a][n].sort((e,l)=>new Date(e.time)-new Date(l.time)))}i.value=u});const g=H(()=>m.value?i.value.filter(u=>{var o,a;return((o=u.name)==null?void 0:o.includes(m.value))||((a=u.nname)==null?void 0:a.includes(m.value))}):[]);return{selectedBangumi:_,bangumiDateList:t,bangumiSearchList:g,searchKeyWord:m}},methods:{}},T={class:"page"},Z={class:"container"},Q={key:0,class:"list"},R={key:0,class:"year-item"},X={key:0},I=["title"],ee=["onClick"],te={class:"item-info"},ne={key:0},oe=["onClick"],ae={class:"item-info"},se={key:0},ie=["title","onClick"],le={key:1,class:"list search-list"},ce=["title","onClick"];function re(m,i,_,t,g,u){const o=y("PageHeader"),a=y("BangumiViewer");return s(),c("div",T,[x(o,{modelValue:t.searchKeyWord,"onUpdate:modelValue":i[0]||(i[0]=n=>t.searchKeyWord=n),"show-search-input":!0},null,8,["modelValue"]),r("div",Z,[t.searchKeyWord?(s(),c("div",le,[r("ul",null,[(s(!0),c(v,null,h(t.bangumiSearchList,n=>(s(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:e=>t.selectedBangumi=n},d(n.name),11,ce))),128))])])):(s(),c("div",Q,[r("ul",null,[t.bangumiDateList.notExistDate.length>0?(s(),c("li",R,[K(" 放送时间未确认 "),t.bangumiDateList.notExistDate.open?(s(),c("ul",X,[(s(!0),c(v,null,h(t.bangumiDateList.notExistDate,n=>(s(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:i[1]||(i[1]=k(()=>{},["stop"]))},d(n.name),11,I))),128))])):p("",!0)])):p("",!0),(s(!0),c(v,null,h(t.bangumiDateList.year,n=>(s(),c("li",{key:n.year,class:"year-item",onClick:e=>n.open=!n.open},[r("div",te,[r("span",null,d(n.year),1),r("span",null,d(n.complete)+"/"+d(n.total),1)]),n.open?(s(),c("ul",ne,[(s(!0),c(v,null,h(n,e=>(s(),c("li",{key:e.month,class:"month-item",onClick:k(l=>e.open=!e.open,["stop"])},[r("div",ae,[r("span",null,d(e.month),1),r("span",null,d(e.complete)+"/"+d(e.total),1)]),e.open?(s(),c("ul",se,[(s(!0),c(v,null,h(e,l=>(s(),c("li",{key:l.id,class:f(["bangumi-item",{complete:l.state}]),title:l.nname,onClick:k(de=>t.selectedBangumi=l,["stop"])},d(l.name),11,ie))),128))])):p("",!0)],8,oe))),128))])):p("",!0)],8,ee))),128))])])),t.selectedBangumi?(s(),C(a,{key:2,bangumi:t.selectedBangumi,"onUpdate:bangumi":i[2]||(i[2]=n=>t.selectedBangumi=n)},null,8,["bangumi"])):p("",!0)])])}const ge=D(J,[["render",re],["__scopeId","data-v-62202696"]]);export{ge as default};
