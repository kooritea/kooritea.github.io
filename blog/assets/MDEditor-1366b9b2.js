import{_ as R,S as P,an as F,r as b,u as L,al as O,ad as x,b as N,d as W,w as j,a as T,e as S,o as m,c as D,h as i,Y as B,g as E,k as A,i as q,F as z,ao as G,ab as J,J as K,H as Y,ap as $}from"./index-4395e62e.js";import{M as Q}from"./MarkDown-bae9dc59.js";import{b as X}from"./GreatOldOne-f312c89e.js";import"./ImageCon-8d9cc4aa.js";const I={},Z={components:{SvgIcon:P,Markdown:Q,ButtonBox:F},props:{modelValue:{type:String,default:()=>""},title:{type:String,default:""},autoHeight:{type:Boolean,default:!0},cache:{type:[String,Boolean],default:""},onSubmit:{type:Function,default:()=>{}},showDefaultHandlers:{type:[Boolean,Array],default:()=>!0},exHandlers:{type:Array,default:()=>[]}},setup(l,{emit:s}){const v=b(!0),{computedModelValue:e}=L(l,s),g=b(!1),M=b(null);if(l.cache){const t=O();if(I[t.fullPath]&&l.cache===!0)x.error("当前页面存在两个需要缓存的编辑器,需要为编辑器传入缓存唯一标识缓存功能才会工作！");else{const o="MDEditorCache."+(l.cache===!0?t.fullPath:`${t.fullPath}.${l.cache}`);e.value=localStorage.getItem(o);let n=null;N(()=>{I[o]=!0,n=setInterval(()=>{g.value=!0,localStorage.setItem(o,e.value||"")},1e3)}),W(()=>{I[o]=!1,clearInterval(n)}),j(e,()=>{g.value=!1})}}const d=b(e.value),w=()=>{const t=l.onSubmit(e.value);return t instanceof Promise?t.then(()=>{e.value="",d.value=""}):(e.value="",d.value=""),t},p=()=>{e.value=""},r=()=>{e.value=d.value},U=[{name:"提交",type:"primary",handler:w,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("submit"):l.showDefaultHandlers},{name:"清除",type:"danger",handler:p,show:()=>Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("clean"):l.showDefaultHandlers},{name:"重置",type:"default",handler:r,show:()=>(Array.isArray(l.showDefaultHandlers)?l.showDefaultHandlers.includes("reset"):l.showDefaultHandlers)&&!!d.value}],V=T(()=>[...U,...l.exHandlers]),y=t=>{const o=$(URL.createObjectURL(t),{handlers:[{name:"上传",type:"primary",handler:()=>{const n=M.value.selectionStart,c=new Date().valueOf().toString(),a=e.value.slice(0,n),u=e.value.slice(n);e.value=`${a}![${c}](--------------------)${u}`,X(t,h=>{const f=Math.round(100*event.loaded/event.total)/10*2;e.value=e.value.replace(new RegExp(`\\!\\[${c}]\\((#*?)(-*?)\\)`),`![${c}](${"#".repeat(f)}${"-".repeat(20-f)})`)}).then(h=>{e.value=e.value.replace(new RegExp(`\\!\\[${c}]\\((#*?)(-*?)\\)`),`![${h.keyname}](${h.local})`)}).catch(()=>{e.value=e.value.replace(new RegExp(`\\!\\[${c}]\\((#*?)(-*?)\\)`),"")}),o.callClose()}},{name:"裁剪为16:9",type:"default",show:()=>{},handler:()=>{const n=document.createElement("canvas"),c=n.getContext("2d"),a=new Image;a.onload=async()=>{if(a.height*16===a.width*9)return;const u=a.height*16/9;if(u>a.width){const H=.5625*a.width;n.width=a.width,n.height=H,c.drawImage(a,0,(a.height-H)/2,a.width,H,0,0,a.width,H)}else n.width=u,n.height=a.height,c.drawImage(a,(a.width-u)/2,0,u,a.height,0,0,u,a.height);const h=n.toDataURL(t.type).split(","),k=h[0].match(/:(.*?);/)[1],f=atob(h[1]);let _=f.length;const C=new Uint8Array(_);for(;_--;)C[_]=f.charCodeAt(_);o.callClose(),y(new File([C],t.name,{type:k}))},a.src=URL.createObjectURL(t)}},{name:"取消",type:"default",handler:()=>{o.callClose()}}]})};return{isEditMode:v,computedModelValue:e,resetCache:d,isSave:g,handlers:V,submitHandler:w,cleanHandler:p,resetHandler:r,previewImageBeforeUpload:y,pasteHandler:t=>{if(!(t.clipboardData&&t.clipboardData.items))return;const o=Array.from(t.clipboardData.items).filter(n=>n.kind==="file");if(o.length>0){t.preventDefault();for(const n of o)if(n.type.startsWith("image/")){y(n.getAsFile());return}else x.warning(`不支持的文件类型: ${n.type}`)}},dropHandler:t=>{for(const o of t.dataTransfer.files)if(t.preventDefault(),o.type.startsWith("image/")){y(o);return}else x.warning(`不支持的文件类型: ${o.type}`)},textarea:M}}},ee={class:"md-editor"},te={class:"bar"},ae={class:"bar-left"},ne={class:"title"},le={class:"uploader"},oe={class:"bar-right"},se={key:0,class:"is-save info"},re={class:"fill"},ie={key:1,class:"preview"};function de(l,s,v,e,g,M){const d=S("SvgIcon"),w=S("Markdown"),p=S("ButtonBox");return m(),D(Y,null,[i("div",ee,[i("div",te,[i("div",ae,[i("div",ne,B(v.title),1),i("label",le,[E(d,{class:"button",name:"icon-14"}),i("input",{type:"file",accept:"image/*",onChange:s[0]||(s[0]=r=>{e.previewImageBeforeUpload(r.srcElement.files[0]),r.srcElement.value=""})},null,32)]),E(d,{class:"button",name:"icon-biaoqing"})]),i("div",oe,[e.isSave?(m(),D("span",se,"已保存")):A("",!0),i("span",{class:"preview-switch button",onClick:s[1]||(s[1]=r=>e.isEditMode=!e.isEditMode)},B(e.isEditMode?"预览":"返回编辑"),1)])]),e.isEditMode?(m(),D("div",{key:0,class:q(["textarea-box",{"auto-height":v.autoHeight}])},[i("pre",re,B(e.computedModelValue),1),z(i("textarea",{ref:"textarea","onUpdate:modelValue":s[2]||(s[2]=r=>e.computedModelValue=r),class:"textarea",onPaste:s[3]||(s[3]=(...r)=>e.pasteHandler&&e.pasteHandler(...r)),onDragover:s[4]||(s[4]=J(()=>{},["prevent"])),onDrop:s[5]||(s[5]=(...r)=>e.dropHandler&&e.dropHandler(...r))},null,544),[[G,e.computedModelValue]])],2)):(m(),D("div",ie,[E(w,{"model-value":e.computedModelValue},null,8,["model-value"])]))]),e.handlers.length>0?(m(),K(p,{key:0,handlers:e.handlers},null,8,["handlers"])):A("",!0)],64)}const ge=R(Z,[["render",de],["__scopeId","data-v-9ffbc859"]]);export{ge as default};
