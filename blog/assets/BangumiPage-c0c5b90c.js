import{P as C}from"./PageHeader-487554da.js";import{_ as w,a8 as $,aj as V,ak as L,u as S,Z as E,r as B,e as y,al as P,o as s,c,F as O,h as r,g as D,Y as d,J as x,k as p,am as b,an as H,a as K,f as N,H as v,a4 as h,i as f,a9 as k}from"./index-d3c9560e.js";import{a as U}from"./GreatOldOne-614d670e.js";const W={components:{ImageCon:$,SwitchButton:V},directives:{mask:L},props:{bangumi:{type:Object,required:!0}},setup(m,{emit:i}){const{computedBangumi:_}=S(m,i),{mobileMode:t,isGreatOldOne:g}=E(),u=B(!1);return{cancel:()=>{t.value&&!u.value&&(_.value=null)},computedBangumi:_,isGreatOldOne:g,globalLoading:u}},methods:{onSwitchBangumiState(m,i){return U(m.id,{state:i})}}},A={class:"bangumi-viewer-container"},F={class:"preview"},M={class:"name"},j={class:"nname"},G={class:"switch-time-episode"},Y={class:"time-episode"};function q(m,i,_,t,g,u){const a=y("ImageCon"),o=y("SwitchButton"),n=P("mask");return s(),c("div",{class:"bangumi-viewer",onClick:i[2]||(i[2]=(...e)=>t.cancel&&t.cancel(...e))},[O((s(),c("div",A,[r("div",F,[D(a,{src:t.computedBangumi.img,prefix:["https://lain.bgm.tv/pic/cover/l"]},null,8,["src","prefix"])]),r("div",M,d(t.computedBangumi.name),1),r("div",j,d(t.computedBangumi.nname),1),r("div",G,[t.isGreatOldOne?(s(),x(o,{key:0,modelValue:t.computedBangumi.state,"onUpdate:modelValue":i[0]||(i[0]=e=>t.computedBangumi.state=e),loading:t.globalLoading,"onUpdate:loading":i[1]||(i[1]=e=>t.globalLoading=e),"on-click":e=>u.onSwitchBangumiState(t.computedBangumi,e)},null,8,["modelValue","loading","on-click"])):p("",!0),r("span",Y," ("+d(t.computedBangumi.episode)+"话)"+d(t.computedBangumi.time),1)])])),[[n,!0]])])}const z=w(W,[["render",q],["__scopeId","data-v-bad6d354"]]);const J={components:{PageHeader:C,BangumiViewer:z},setup(){const m=B(""),i=b([]),_=B(null),t=b({notExistDate:[],year:[]});t.notExistDate.open=!1,H().then(u=>{const a={};for(const o of u)if(!o.time)t.notExistDate.push(o);else{const n=new Date(o.time),e=n.getFullYear(),l=n.getMonth()+1;a[e]||(a[e]=[],a[e].year=e,a[e].open=!1,a[e].total=0,a[e].complete=0,t.year.push(a[e])),a[`${e}-${l}`]||(a[`${e}-${l}`]=[],a[`${e}-${l}`].month=`${e}-${l}`,a[`${e}-${l}`].open=!1,a[`${e}-${l}`].total=0,a[`${e}-${l}`].complete=0,a[e].push(a[`${e}-${l}`])),a[e].total++,a[`${e}-${l}`].total++,o.state&&(a[e].complete++,a[`${e}-${l}`].complete++),a[`${e}-${l}`].push(o)}t.year=t.year.sort((o,n)=>n.year-o.year);for(const o in t.year){t.year[o]=t.year[o].sort((n,e)=>n.month-e.month);for(const n in t.year[o])Array.isArray(t.year[o][n])&&(t.year[o][n]=t.year[o][n].sort((e,l)=>new Date(e.time)-new Date(l.time)))}i.value=u});const g=K(()=>m.value?i.value.filter(u=>{var a,o;return((a=u.name)==null?void 0:a.includes(m.value))||((o=u.nname)==null?void 0:o.includes(m.value))}):[]);return{selectedBangumi:_,bangumiDateList:t,bangumiSearchList:g,searchKeyWord:m}},methods:{}},T={class:"page"},Z={class:"container"},Q={key:0,class:"list"},R={key:0,class:"year-item"},X={key:0},I=["title"],ee=["onClick"],te={class:"item-info"},ne={key:0},ae=["onClick"],oe={class:"item-info"},se={key:0},ie=["title","onClick"],le={key:1,class:"list search-list"},ce=["title","onClick"];function re(m,i,_,t,g,u){const a=y("PageHeader"),o=y("BangumiViewer");return s(),c("div",T,[D(a,{modelValue:t.searchKeyWord,"onUpdate:modelValue":i[0]||(i[0]=n=>t.searchKeyWord=n),"show-search-input":!0},null,8,["modelValue"]),r("div",Z,[t.searchKeyWord?(s(),c("div",le,[r("ul",null,[(s(!0),c(v,null,h(t.bangumiSearchList,n=>(s(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:e=>t.selectedBangumi=n},d(n.name),11,ce))),128))])])):(s(),c("div",Q,[r("ul",null,[t.bangumiDateList.notExistDate.length>0?(s(),c("li",R,[N(" 放送时间未确认 "),t.bangumiDateList.notExistDate.open?(s(),c("ul",X,[(s(!0),c(v,null,h(t.bangumiDateList.notExistDate,n=>(s(),c("li",{key:n.id,class:f(["bangumi-item",{complete:n.state}]),title:n.nname,onClick:i[1]||(i[1]=k(()=>{},["stop"]))},d(n.name),11,I))),128))])):p("",!0)])):p("",!0),(s(!0),c(v,null,h(t.bangumiDateList.year,n=>(s(),c("li",{key:n.year,class:"year-item",onClick:e=>n.open=!n.open},[r("div",te,[r("span",null,d(n.year),1),r("span",null,d(n.complete)+"/"+d(n.total),1)]),n.open?(s(),c("ul",ne,[(s(!0),c(v,null,h(n,e=>(s(),c("li",{key:e.month,class:"month-item",onClick:k(l=>e.open=!e.open,["stop"])},[r("div",oe,[r("span",null,d(e.month),1),r("span",null,d(e.complete)+"/"+d(e.total),1)]),e.open?(s(),c("ul",se,[(s(!0),c(v,null,h(e,l=>(s(),c("li",{key:l.id,class:f(["bangumi-item",{complete:l.state}]),title:l.nname,onClick:k(de=>t.selectedBangumi=l,["stop"])},d(l.name),11,ie))),128))])):p("",!0)],8,ae))),128))])):p("",!0)],8,ee))),128))])])),t.selectedBangumi?(s(),x(o,{key:2,bangumi:t.selectedBangumi,"onUpdate:bangumi":i[2]||(i[2]=n=>t.selectedBangumi=n)},null,8,["bangumi"])):p("",!0)])])}const pe=w(J,[["render",re],["__scopeId","data-v-ce1bbcbf"]]);export{pe as default};
